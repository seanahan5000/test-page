(()=>{var t,e={2683:(t,e,i)=>{!function(t){"use strict";t.defineMode("6502",(function(t,e){let i=/^(brk|cl[cdiv]|(de|in)[xy]|nop|p[hl][ap]|rt[is]|se[cdi]|t(a[xy]|(sx|xs)|[yx]a))\b/i,s=/^(a(dc|nd)|bit|c(mp|p[xy])|dec|eor|inc|ld[axy]|ora|sbc|st[axy])\b/i,o=/^(ro[lr]|asl|lsr)\b/i,n=/^(b(pl|mi|ne|eq|c[cs]|v[cs]))\b/i,r=/^(j(mp|sr))\b/i,a=/^(.bulk|.dense|.junk|.fill|.dd1|.ds|.str)\b/i,h=/^(put|use|sav|include)\b/i;var l=new Map;return["processor","byte","word","long","seg","dc","ds","dv","hex","err","org","rorg","echo","rend","align","subroutine","equ","eqm","set","mac","endm","mexit","ifconst","ifnconst","if","else","endif","eif","repeat","repend","dw","da","db","dfb","lst","exp","do","fin","mac","eom","usr","tr","ent","dummy","dend"].forEach((function(t){l.set(t,"keyword")})),{startState:function(){return{name:"",type:""}},token:function(t,e){if(0==t.column()){if(e.name="init",e.type="",t.eat("*"))return t.skipToEnd(),"comment";if(t.match(/^[\.\:\@][\w]+/))return e.name="op-start","local";if(t.match(/^[\w]+/))return e.name="label-end","label";e.name="op-start"}if("label-end"==e.name&&(e.name="op-start",t.eat("?")))return"operator";if(t.eatSpace())return null;if("pict"!=e.type&&t.eat(";"))return t.skipToEnd(),"comment";if("op-start"==e.name){if(t.eat("="))return e.name="op-done","opcode";let c=t.eat(".");if(t.eatWhile(/\w/)){let d=t.current().toLowerCase();if(c&&a.test(d))return e.name="arg-start","keyword";if(h.test(d))return e.type="disk","keyword";if(d.startsWith("pict"))return e.name="arg-start",e.type="pict","keyword";if(l.get(d))return"dc"==d&&t.eat(".")?d+="."+t.next():"hex"==d?e.type="hex":"usr"==d&&(e.type="usr"),e.name="arg-start","keyword";if(o.test(d))return e.name="arg-start",e.type="rotshift","opcode";if(n.test(d))return e.name="arg-start",e.type="jump_bcc","opcode";if(r.test(d))return e.name="arg-start",e.type="jump_bcc","opcode";if(i.test(d))return e.name="op-done","opcode";if(s.test(d))return e.name="arg-start","opcode"}}if("arg-start"==e.name){if("rotshift"==e.type&&t.match(/^[a]/i))return e.name="arg-cont","opcode";if("pict"!=e.type&&"usr"!=e.type&&t.eat("("))return e.name="arg-cont","opcode";if(t.eat("#"))return t.match(/^[\w]+(\s+|$)/)?"number":(e.name="arg-cont","opcode");e.name="arg-cont"}if("pict"==e.type||"usr"==e.type)if("arg-cont"==e.name){if(t.eat("("))return e.name="usr-cont","operator"}else{let i=t.next();if(")"==i)return e.name="arg-cont","operator";for(;i=t.peek();){if(")"==i)return"string";t.next()}}if("disk"!=e.type&&t.match(/^[\.\:\@][\w]+/))return"local";if(t.eat('"')){let e;for(;e=t.next();)if('"'==e)return"string"}if(t.eat("'")){let e;for(;e=t.next();)if("'"==e)return"string"}return("hex"==e.type||t.eat("$"))&&t.match(/^[0-9a-f]+/i)?"hex"==e.type?null:"number":t.match(/^\%[01]+/)||t.match(/^[0-9]+/)?"number":t.match(/^\,[xy]/i)||t.match(/^\)\,y/i)||t.match(/^\,x\)/i)?"opcode":t.eatWhile(/[\+\-\*\/\>\<\|\,\{\}\(\)]/)?"operator":t.match(/^[\w]+/)?"jump_bcc"==e.type?"label":null:(t.next(),null)}}})),t.defineMIME("text/x-6502","6502")}(i(4631))},554:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(8081),o=i.n(s),n=i(3645),r=i.n(n)()(o());r.push([t.id,'\nbody {\n  margin: 0;\n}\n\n.outer-div {\n  width: 100%;\n  height: 100vh;\n  display: grid;\n  grid-template-columns: 180px 800px 1fr;\n}\n\n/* top level div for code-header and code-div */\n#code-side {\n  grid-column: 2;\n}\n\n.code-header {\n  height: 32px;\n  /* indent debugging buttons slightly */\n  margin-right: 16px;\n}\n\n.find-label {\n  float: right;\n  margin-top: 4px;\n  margin-right: 192px;\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 9pt;\n}\n\n.find-input {\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 9pt;\n  color:darkgray;\n  background-color:#222;\n  margin-top: 4px;\n}\n\n.dbg-btn {\n  float: right;\n  width: 32px;\n  height: 24px;\n  padding-top: 6px;\n  font-size: 20px !important;\n}\n\n.dbg-blue {\n  color: #64AFFF;\n}\n\n.dbg-green {\n  color: #79CA72;\n}\n\n.dgb-red {\n  color: #EF715E;\n}\n\n.code-div {\n  height: calc(100% - 32px);\n  width: 100%;\n}\n\n/* NOTE: this is the text area used by CodeMirror */\n.code-area {\n  width: 400px;\n  height: 100%;\n}\n\n.currentpc {\n  background-color: #404040;\n}\n\n.self-modified {\n  color: red !important;\n}\n\n#other-side {\n  grid-column: 3;\n}\n\n/*----------------------------------------------------------------------------*\n *  Project files view\n *----------------------------------------------------------------------------*/\n\n.files-div {\n  grid-column: 1;\n  margin-top: 32px;\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 9pt;\n  color:darkgray;\n  background-color:#222;\n  border-right: 2px solid black;\n}\n\n.proj-dir {\n  cursor: pointer;\n}\n\n.proj-dir ul {\n  padding-left: 16px;\n}\n\n.proj-dir li {\n  padding-top: 1px;\n  padding-bottom: 1px;\n}\n\n.proj-file.active {\n  background-color:#4E5A65 !important;\n}\n\n.proj-arrow {\n  font-size:  12pt;\n  margin-top: -4px;\n  margin-left: -4px;\n  vertical-align: middle;\n}\n\n/*----------------------------------------------------------------------------*\n *  Code hovering tool tips\n *----------------------------------------------------------------------------*/\n\n.hover-div {\n  display: none;\n  z-index: 100;\n  position: absolute;\n  left: 0px;\n  top: 0px;\n  height: 60px;\n  width: 60px;\n  padding: 0;\n  margin: 0;\n  font-weight: normal;\n  white-space: nowrap;\n}\n\n.tooltip-content {\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 9pt;\n}\n\n/* button descriptor tooltips */\n/* NOTE: using Arial because the Monoco shift/command characters look weird */\n.tippy-content {\n  font-family: "Arial", "Arial", monospace;\n  font-size: 10pt;\n}\n\n/*----------------------------------------------------------------------------*\n *  IntEdit and FlagEdit elements used in register and watch display\n *----------------------------------------------------------------------------*/\n\n.int-edit {\n  padding: 1px 2px;\n  cursor: pointer;\n}\n\n.int-edit-addr {\n  padding: 1px 0px;\n}\n\n/* .int-edit-stopped {\n} */\n\n.int-edit-stopped:hover {\n  background-color: #444;\n  color: lightgray;\n}\n\n.int-edit:focus {\n  background-color: #800;\n  color: lightgray;\n}\n\n\n.flag-edit {\n  padding: 0px;\n  margin: 0px;\n  cursor: pointer;\n}\n\n.flag-edit-stopped:hover {\n  background-color: #444;\n  color: lightgray;\n}\n\n/*----------------------------------------------------------------------------*\n *  CPU register display\n *----------------------------------------------------------------------------*/\n\n#reg-table {\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 10pt;\n  margin-left: 30px;\n  margin-top: 6px;\n  padding: 8px;\n  border: 2px solid #222;\n  color: gray;\n}\n\n.reg-label {\n  color: lightgray;\n}\n\n/*----------------------------------------------------------------------------*\n *  Expression watch display\n *----------------------------------------------------------------------------*/\n\n#watch-div {\n  margin-left: 30px;\n  margin-top: 10px;\n  display: none;\n}\n\n#watch-table {\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 10pt;\n  padding: 8px;\n  /* extra left padding to work around click bugs */\n  padding-left: 14px;\n  color: gray;\n  border: 2px solid #222;\n  border-spacing: 0px;\n}\n\n.watch-row {\n  cursor: pointer;\n}\n\n.watch-row:focus {\n  background-color: #222;\n}\n\n.watch-expression {\n  color:lightgray;\n  padding-right: 8px;\n}\n\n.watch-hex-table {\n  border-spacing: 0px;\n  padding-top: 2px;\n}\n\n/* expression column */\n/*#watch-table tr td:nth-child(2) {\n  color:lightgray;\n  padding-right: 8px;\n}\n*/\n/* address column */\n/*#watch-table tr td:nth-child(3) {\n  color:gray;\n}\n*/\n/* data column */\n/* #watch-table tr td:nth-child(4) {\n  padding-right: 4px;\n} */\n\n.watch-span-index {\n  background-color: #44f;\n  color: black;\n}\n\n.watch-span-changed {\n  color: red;\n}\n\n/*----------------------------------------------------------------------------*/\n\n/* .dropdown-content {\n} */\n\n.dropdown-content a {\n  display: block;\n  color: lightgray;\n  text-decoration: none;\n\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 10pt;\n  width:  76px;\n  cursor: pointer;\n}\n\n.dropdown-content a:hover {\n  color: lightgray;\n  background-color: gray;\n}\n\n.dropdown-button {\n  color: lightgray;\n  padding: 0;\n  margin: 0;\n  border: 0;\n}\n\n/* combine with .dropdown-content a */\n.dropdown-group-end {\n  border-bottom: 1px solid darkgray;\n}\n\n/*----------------------------------------------------------------------------*\n *  Screen Display, Tool Palette, and Color Palette\n *----------------------------------------------------------------------------*/\n\n/* TODO: consider moving to a separate file */\n\n/* top level display element */\n\n#display-grid {\n  display: grid;\n  grid-auto-columns: 0px 600px;\n  row-gap: 0px;\n  column-gap: 0px;\n  margin-left: 30px;\n}\n\n#display-grid.editing {\n  grid-auto-columns: 50px 600px;\n  column-gap: 4px;\n}\n\n/* display screen with tabs */\n\n.screen-tabs {\n  grid-row: 1;\n  grid-column: 2;\n  margin-top: 30px;\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 10pt;\n}\n\n.screen-tabs .tabs-list {\n  list-style: none;\n  padding: 0px;\n}\n\n.screen-tabs .tabs-list li {\n  width: 100px;\n  float: left;\n  margin: 0px;\n  padding: 5px 0px;\n  text-align: center;\n  border: 2px solid #222;\n}\n\n.screen-tabs .tabs-list li:hover {\n  cursor: pointer;\n}\n\n.screen-tabs .tabs-list li a {\n  text-decoration: none;\n  color: gray;\n}\n\n.screen-tabs .tabs-list li.active {\n  background-color:#222 !important;\n}\n\n.active a {\n  color:lightgray !important;\n}\n\n#screen-edit {\n  font-size: 20px !important;\n  float: top;\n  padding-top: 6px;\n  padding-bottom: 4px;\n  color: #EF715E;\n  margin-left: 12px;\n}\n\n.screen-tab {\n  resize: none;\n  overflow: hidden;  /* required to avoid flicker while resizing */\n  width: 560px;\n  height: 384px;\n  min-width: 568px;\n  min-height: 392px;\n}\n\n#hires-canvas {\n  border: 2px solid #444;\n}\n\n#hires-canvas:focus {\n  border-color:#888;\n}\n\n/* tool palette */\n\n#tool-palette {\n  display: none;\n  grid-column: 1;\n  grid-row-start: 1;\n  grid-row-end: 2;\n  margin-top: 78px;\n  margin-bottom: 4px;\n  width: 50px;\n  height: 196px;\n  background-color: #333;\n  /* max-height: max-content; */\n}\n\n#tool-palette.visible {\n  display: block;\n}\n\n.tool-btn {\n  width: 32px;\n  height: 32px;\n  border: 1px none #000;\n  margin: 4px;\n}\n\n.tool-btn.active {\n  width: 40px;\n  height: 40px;\n  border: 1px solid #0f0;\n}\n\n.tool-img {\n  width: 100%;\n  height: 100%;\n}\n\n/* color palette */\n\n#color-palette {\n  display: none;\n  grid-column: 2;\n  grid-row: 2;\n  background-color: #444;\n  max-width: max-content;\n  padding: 2px;\n}\n\n#color-palette.visible {\n  display: block;\n}\n\n.color-btn {\n  width: 32px;\n  height: 32px;\n  float: left;\n  margin: 4px;\n}\n\n.color-btn.active {\n  width: 40px;\n  height: 40px;\n}\n\n#xy-palette {\n  display: none;\n  grid-column: 2;\n  grid-row: 3;\n  background-color: #444;\n  max-width: max-content;\n  padding: 2px;\n  font-family: "Menlo", "Monaco", monospace;\n  font-size: 8pt;\n}\n\n#xy-palette.visible {\n  display: block;\n}\n\n/*----------------------------------------------------------------------------*/\n\n.gutter-line {\n  width: 30px;\n  color: #808080 !important;\n}\n.gutter-bytes {\n  width: 10em;\n}\n.gutter-marker {\n  width: 1em;\n  cursor: pointer;\n}\n\n.mark-error {\n  text-decoration-line: underline;\n  /* text-decoration-style: wavy; */\n  text-decoration-color: #ff6666;\n  text-decoration-thickness: 1px;\n}\n\n/* div.editor {\n  line-height:1.25;\n  font-size:12pt;\n  height:100%\n} */\n\n/* BASICS */\n\n.CodeMirror {\n  /* Set height, width, borders, and global font properties here */\n  /*font-family: "Andale Mono", "Menlo", "Lucida Console", monospace;*/\n  font-family: "Menlo", "Monaco", monospace;\n  /* font-size: 0.8em; */\n  font-size: 9pt;\n  /* line-height: 1.25; */\n  height: calc(100vh - 32px);\n  width: 100%;\n  direction: ltr;\n\n  /* div.editor */\n  /* line-height:1.25;\n  font-size:12pt; */\n}\n\n/* PADDING */\n\n/* GUTTER */\n\n.CodeMirror-gutters {\n  /*border-right: 1px solid #ddd;*/\n  background-color: #f7f7f7;\n  white-space: nowrap;\n}\n\n.CodeMirror-guttermarker { color: black; }\n.CodeMirror-guttermarker-subtle { color: #999; }\n\n/* based on SublimeText Mariana */\n.cm-s-dbug.CodeMirror { background: hsl(0, 0%, 10%); color: hsl(0, 0%, 70%); }\n\n.cm-s-dbug div.CodeMirror-selected { background: #4E5A65; } /* hsl(209, 13%, 35%) */\n.cm-s-dbug .CodeMirror-line::selection, .cm-s-dbug .CodeMirror-line > span::selection, .cm-s-dbug .CodeMirror-line > span > span::selection { background: rgba(179, 101, 57, .99); }\n.cm-s-dbug .CodeMirror-line::-moz-selection, .cm-s-dbug .CodeMirror-line > span::-moz-selection, .cm-s-dbug .CodeMirror-line > span > span::-moz-selection { background: rgba(179, 101, 57, .99); }\n.cm-s-dbug .CodeMirror-gutters { background: #444; border-right: 1px solid #aaa; }\n.cm-s-dbug .CodeMirror-guttermarker { color: #ffee80; }\n.cm-s-dbug .CodeMirror-guttermarker-subtle { color: #d0d0d0; }\n.cm-s-dbug .CodeMirror-cursor { border-left: 1px solid white; }\n\n/* based on SublimeText Mariana */\n.cm-s-dbug span.cm-comment { color: hsl(114, 30%, 40%); }\n.cm-s-dbug span.cm-string { color: hsl(32, 93%, 66%); }\n.cm-s-dbug span.cm-keyword { color: hsl(300, 50%, 68%); }\n.cm-s-dbug span.cm-opcode { color: hsl(210, 50%, 60%); }\n.cm-s-dbug span.cm-opcode { color: hsl(210, 50%, 60%); }\n.cm-s-dbug span.cm-label { color: hsl(32, 93%, 66%); }\n.cm-s-dbug span.cm-local { color: #9effff; }    /*** CHANGE THIS ***/\n.cm-s-dbug span.cm-operator { color: #845dc4; }    /*** CHANGE THIS ***/\n\n.cm-s-dbug span.cm-atom { color: #845dc4; }\n.cm-s-dbug span.cm-number, .cm-s-dbug span.cm-attribute { color: #ff80e1; }\n.cm-s-dbug span.cm-meta { color: #ff9d00; }\n.cm-s-dbug span.cm-variable-2, .cm-s-dbug span.cm-tag { color: #9effff; }\n.cm-s-dbug span.cm-variable-3, .cm-s-dbug span.cm-def { color: white; }\n.cm-s-dbug span.cm-bracket { color: #d8d8d8; }\n.cm-s-dbug span.cm-builtin, .cm-s-dbug span.cm-special { color: #ff9e59; }\n.cm-s-dbug span.cm-link { color: #845dc4; }\n.cm-s-dbug span.cm-error { color: #9d1e15; }\n\n.cm-s-dbug .CodeMirror-activeline-background { background: #003399; }\n.cm-s-dbug .CodeMirror-matchingbracket { outline:1px solid grey;color:white !important; }\n\n',""]);const a=r},8232:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>c});var s=i(7091),o=i.n(s),n=new URL(i(1024),i.b),r=new URL(i(3274),i.b),a=new URL(i(9037),i.b),h=new URL(i(7029),i.b),l=new URL(i(6576),i.b);const c='<!doctype html> <html> <head></head> <meta charset="UTF-8"> <body style="background-color:#000;color:silver"> <div class="outer-div"> <div id="files-side" class="files-div"></div> <div id="code-side"> <div class="code-header"> <div> <div class="dbg-btn codicon codicon-debug-restart dbg-green" id="restart"></div> <div class="dbg-btn codicon codicon-debug-step-out dbg-blue" id="stepout"></div> <div class="dbg-btn codicon codicon-debug-step-into dbg-blue" id="stepinto"></div> <div class="dbg-btn codicon codicon-debug-step-over dbg-blue" id="stepover"></div> <div class="dbg-btn codicon codicon-debug-start dbg-green" id="continue"></div> <div class="dbg-btn codicon codicon-debug-pause dbg-blue" id="pause" style="display:none"></div> <label class="find-label">Find:<input class="find-input" id="find-input" type="text" name="find"></label> </div> </div> </div> <div id="other-side"> <div id="display-grid"> <div id="tool-palette"> <div class="tool-btn" id="tool0"> <img class="tool-img" src="'+o()(n)+'"> </div> <div class="tool-btn" id="tool1"> <img class="tool-img" src="'+o()(r)+'"> </div> <div class="tool-btn" id="tool2"> <img class="tool-img" src="'+o()(a)+'"> </div> <div class="tool-btn" id="tool3"> <img class="tool-img" src="'+o()(h)+'"> </div> <div class="tool-btn" id="tool4"> <img class="tool-img" src="'+o()(l)+'"> </div> </div> <div id="display-div" class="screen-tabs"> <ul class="tabs-list"> <li id="li0" class="active"><a>Active(0)</a></li> <li id="li1"><a>Visible(1)</a></li> <li id="li2"><a>Primary</a></li> <li id="li3"><a>Secondary</a></li> </ul> <div class="codicon codicon-edit" id="screen-edit"></div> <div id="screen-div" class="screen-tab"> <canvas tabindex="-1" id="hires-canvas" width="560px" height="384px" style="image-rendering:pixelated"></canvas> </div> </div> <div id="color-palette"> <div class="color-btn" id="clr0"></div> <div class="color-btn" id="clr1"></div> <div class="color-btn" id="clr2"></div> <div class="color-btn" id="clr3"></div> <div class="color-btn" id="clr4"></div> <div class="color-btn" id="clr5"></div> <div class="color-btn" id="clr6"></div> <div class="color-btn" id="clr7"></div> </div> <div id="xy-palette"> <div class="coord"></div> </div> </div> <div id="regs"> <table id="reg-table"></table> </div> <div id="watch-div"> <table id="watch-table"></table> </div> </div> </div> </body> </html> '},686:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>m});var s=i(3379),o=i.n(s),n=i(7795),r=i.n(n),a=i(569),h=i.n(a),l=i(3565),c=i.n(l),d=i(9216),u=i.n(d),p=i(4589),f=i.n(p),g=i(554),b={};b.styleTagTransform=f(),b.setAttributes=c(),b.insert=h().bind(null,"head"),b.domAPI=r(),b.insertStyleElement=u(),o()(g.Z,b);const m=g.Z&&g.Z.locals?g.Z.locals:void 0},1232:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Breakpoints=void 0;const s=i(8887);class o{constructor(t,e,i,s){this.type=t,e?(this.sourceDoc=e,this.sourceLine=i,this.address=i.address):this.address=s}}class n{constructor(t){this.project=t,this.entryHash=new Array(n.hashMask+1)}setOneShotBreakpoint(t){let e=new o("once",null,null,t);this.addBreakpoint(e)}setBreakpoint(t,e,i){"user"==t&&this.clearBreakpoint(e,i);let s=new o(t,e,i);this.addBreakpoint(s)}addBreakpoint(t){let e=this.entryHash[t.address&n.hashMask];e||(e=[],this.entryHash[t.address&n.hashMask]=e),e.push(t),this.saveBreakpoints()}clearBreakpoint(t,e){let i=this.entryHash[e.address&n.hashMask];if(i){for(let s=0;s<i.length;s+=1)i[s].sourceDoc==t&&i[s].address===e.address&&"user"===i[s].type&&(i.splice(s,1),s-=1);0==i.length&&(this.entryHash[e.address&n.hashMask]=null),this.saveBreakpoints()}}checkBreakpoints(t){let e=this.entryHash[t&n.hashMask];if(e){let i=!1;for(let s=0;s<e.length;s+=1){let o=e[s];o.address==t&&(o.sourceDoc&&!o.sourceDoc.isLoaded(t)||(i=!0,"once"==o.type&&(e.splice(s,1),s-=1)))}if(i)return 0==this.entryHash[t&n.hashMask].length&&(this.entryHash[t&n.hashMask]=null),!0}return!1}saveBreakpoints(){let t=[];this.entryHash.forEach((e=>{e&&e.forEach((e=>{if("user"==e.type){let i=new s.SourceLineTemplate(e.sourceLine);t.push({sourceFile:e.sourceDoc.name,sourceLine:i})}}))}));let e=JSON.stringify(t);localStorage.setItem(this.project.name+"/breakpoints",e)}loadBreakpoints(){let t=localStorage.getItem(this.project.name+"/breakpoints");t&&JSON.parse(t).forEach((t=>{this.project.loadBreakpoint(t.sourceFile,t.sourceLine)}))}}e.Breakpoints=n,n.hashMask=256},4113:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MOS6502=void 0;var i,s=function(){var t,e=this;this.powerOn=function(){this.reset()},this.powerOff=function(){},this.clockPulse=function(){s&&(g++,i[g](),L+=1)},this.connectBus=function(e){t=e},this.setRDY=function(t){s=t},this.isRDY=function(){return s},this.reset=function(){u=1,g=-1,i=[k],o=t.read(R)|t.read(R+1)<<8,this.setRDY(!0),L=0};var i,s=!1,o=0,n=0,r=0,a=0,h=0,l=0,c=0,d=0,u=0,p=0,f=0,g=-1,b=-1,m=0,y=0,v=0,x=!1,w=0,S=0,C=0,L=0;const R=65532;this.debug=!1,this.trace=!1;var k=function(){b=t.read(o),i=kt[b],g=0,o++},B=k,D=function(){t.read(o)},P=function(){S=t.read(o),o++},j=function(){y=t.read(o),o++},O=function(){y|=t.read(o)<<8,o++},M=function(){y=t.read(v)},T=function(){y|=t.read(v)<<8},I=function(){v=t.read(o),o++},A=function(){v|=t.read(o)<<8,o++},E=function(){v=t.read(w)},V=function(){v|=t.read(w)<<8},F=function(){var t=(255&v)+a;x=t>255,v=65280&v|255&t},N=function(){var t=(255&v)+h;x=t>255,v=65280&v|255&t},z=function(){var t=1+(255&v);x=t>255,v=65280&v|255&t},H=function(){x&&(v=v+256&65535)},U=function(){w=t.read(o),o++},W=function(){w=65280&w|255&1+(255&w)},K=function(){m=t.read(o),o++},X=function(){m=t.read(y)},_=function(){m=t.read(v)},Y=function(){t.write(y,m)},$=function(){t.write(v,m)},G=function(t){p=0===t?1:0},J=function(t){l=128&t?1:0},Z=function(t){c=t?1:0},q=function(t){f=t?1:0},Q=function(){return n=n+1&255,t.read(256+n)},tt=function(){return t.read(256+n)},et=function(e){t.write(256+n,e),n=n-1&255},it=function(){return l<<7|c<<6|48|d<<3|u<<2|p<<1|f},st=function(t){l=t>>>7,c=t>>>6&1,d=t>>>3&1,u=t>>>2&1,p=t>>>1&1,f=1&t},ot=function(t){e.debug&&e.breakpoint("Illegal Opcode: "+t)},nt=function(t){return[k,D,function(){t(),B()}]},rt=function(t){return[k,K,function(){t(),B()}]},at=function(t){return[k,j,X,function(){t(),B()}]},ht=function(t){return[k,j,O,X,function(){t(),B()}]},lt=function(t){return[k,I,_,function(){F(),M()},function(){z(),T()},X,function(){t(),B()}]},ct=function(t){var e=0===t?F:N;return function(t){return[k,I,A,function(){e(),_(),H()},function(){x?_():(t(),B())},function(){t(),B()}]}},dt=function(t){var e=0===t?F:N;return function(t){return[k,I,_,function(){e(),_()},function(){t(),B()}]}},ut=function(t){return[k,U,E,function(){W(),V()},function(){N(),_(),H()},function(){x?_():(t(),B())},function(){t(),B()}]},pt=function(t){return[k,j,function(){t(),Y()},B]},ft=function(t){return[k,j,O,function(){t(),Y()},B]},gt=function(t){return[k,I,_,function(){F(),M()},function(){z(),T()},function(){t(),Y()},B]},bt=function(t){var e=0===t?F:N;return function(t){return[k,I,A,function(){e(),_(),H()},function(){t(),$()},B]}},mt=function(t){var e=0===t?F:N;return function(t){return[k,I,_,function(){e(),t(),$()},B]}},yt=function(t){return[k,U,E,function(){W(),V()},function(){N(),_(),H()},function(){t(),$()},B]},vt=function(t){return[k,j,X,Y,function(){t(),Y()},B]},xt=function(t){return[k,j,O,X,Y,function(){t(),Y()},B]},wt=function(t){var e=0===t?F:N;return function(t){return[k,I,_,function(){e(),_()},$,function(){t(),$()},B]}},St=function(t){var e=0===t?F:N;return function(t){return[k,I,A,function(){e(),_(),H()},_,$,function(){t(),$()},B]}},Ct=function(t){return[k,I,_,function(){F(),M()},function(){z(),T()},X,Y,function(){t(),Y()},B]},Lt=function(t){return[k,U,E,function(){W(),V()},function(){N(),_(),H()},_,$,function(){t(),$()},B]},Rt=new Array(256),kt=new Array(256);function Bt(){return[k,function(){ot("KIL/HLT/JAM")},function(){g--}]}function Dt(t){return t((function(){ot("NOP/DOP")}))}function Pt(t){return t((function(){if(d){var t=m,e=(15&r)+(15&t)+f;e>9&&(e+=6);var i=(r>>4)+(t>>4)+(e>15?1:0)<<4;G(r+t+f&255),J(i),Z((r^i)&~(r^t)&128),i>159&&(i+=96),q(i>255),r=255&(i|15&e)}else{var s=r+m+f;q(s>255),Z((r^s)&(m^s)&128),G(r=255&s),J(r)}}))}function jt(t){return t((function(){G(r&=m),J(r)}))}function Ot(t){return t((function(){var t=m;G(r&t),Z(64&t),J(t)}))}function Mt(t){return t((function(){var t=r-m&255;q(r>=m),G(t),J(t)}))}function Tt(t){return t((function(){var t=a-m&255;q(a>=m),G(t),J(t)}))}function It(t){return t((function(){var t=h-m&255;q(h>=m),G(t),J(t)}))}function At(t){return t((function(){G(r^=m),J(r)}))}function Et(t){return t((function(){G(r=m),J(r)}))}function Vt(t){return t((function(){G(a=m),J(a)}))}function Ft(t){return t((function(){G(h=m),J(h)}))}function Nt(t){return t((function(){G(r|=m),J(r)}))}function zt(t){return t((function(){if(d){var t=m,e=(15&r)-(15&t)-(1-f),i=(r>>4)-(t>>4)-(e<0?1:0);e<0&&(e-=6),i<0&&(i-=6);var s=r-t-(1-f);q(256&~s),Z((r^t)&(r^s)&128),G(255&s),J(s),r=255&(i<<4|15&e)}else q((s=r+(t=255&~m)+f)>255),Z((r^s)&(t^s)&128),G(r=255&s),J(r)}))}function Ht(t){return t((function(){ot("ANC"),G(r&=m),l=f=128&r?1:0}))}function Ut(t){return t((function(){ot("LAX");var t=m;r=t,a=t,G(t),J(t)}))}function Wt(t){return t((function(){m=r}))}function Kt(t){return t((function(){m=a}))}function Xt(t){return t((function(){m=h}))}function _t(t){return t((function(){ot("SAX"),m=r&a}))}function Yt(t){return t((function(){ot("SHA"),m=r&a&1+(v>>>8)&255}))}function $t(t){return t((function(){q(m>127);var t=m<<1&255;m=t,G(t),J(t)}))}function Gt(t){return t((function(){var t=m-1&255;m=t,G(t),J(t)}))}function Jt(t){return t((function(){var t=m+1&255;m=t,G(t),J(t)}))}function Zt(t){return t((function(){f=1&m,G(m>>>=1),l=0}))}function qt(t){return t((function(){var t=m>127,e=255&(m<<1|f);m=e,q(t),G(e),J(e)}))}function Qt(t){return t((function(){var t=1&m,e=m>>>1|f<<7;m=e,q(t),G(e),J(e)}))}function te(t){return t((function(){ot("DCP");var t=m-1&255;m=t,q((t=r-t)>=0),G(t),J(t)}))}function ee(t){return t((function(){if(ot("ISB"),m=m+1&255,d){var t=m,e=(15&r)-(15&t)-(1-f),i=(r>>4)-(t>>4)-(e<0?1:0);e<0&&(e-=6),i<0&&(i-=6);var s=r-t-(1-f);q(256&~s),Z((r^t)&(r^s)&128),G(255&s),J(s),r=255&(i<<4|15&e)}else q((s=r+(t=255&~m)+f)>255),Z((r^s)&(t^s)&128),G(r=255&s),J(r)}))}function ie(t){return t((function(){ot("RLA");var t=m,e=f;q(128&t),m=t=255&(t<<1|e),r&=t,G(t),J(t)}))}function se(t){return t((function(){ot("RRA");var t=m,e=f?128:0;if(q(1&t),m=t=t>>>1|e,d){var i=m,s=(15&r)+(15&i)+f;s>9&&(s+=6);var o=(r>>4)+(i>>4)+(s>15?1:0)<<4;G(r+i+f&255),J(o),Z((r^o)&~(r^i)&128),o>159&&(o+=96),q(o>255),r=255&(o|15&s)}else{var n=r+m+f;q(n>255),Z((r^n)&(m^n)&128),G(r=255&n),J(r)}}))}function oe(t){return t((function(){ot("SLO");var t=m;q(128&t),m=t=t<<1&255,r=t|=r,G(t),J(t)}))}function ne(t){return t((function(){ot("SRE");var t=m;q(1&t),m=t>>>=1,r=t=255&(r^t),G(t),J(t)}))}function re(t,e){var i;return i=1===t?function(){return p===e}:7===t?function(){return l===e}:0===t?function(){return f===e}:function(){return c===e},[k,P,function(){var t,e;i()?(D(),e=(t=255&o)+S&255,C=S>127?e>t?-256:0:e<t?256:0,o=65280&o|e):B()},function(){C?(D(),o=o+C&65535):B()},B]}Rt[0]="BRK",kt[0]=[k,K,function(){e.debug&&e.breakpoint("BRK "+m),et(o>>>8&255)},function(){et(255&o)},function(){et(it())},function(){y=t.read(65534)},function(){y|=t.read(65535)<<8},function(){o=y,u=1,B()}],Rt[1]="ORA",kt[1]=Nt(lt),Rt[2]="uKIL",kt[2]=Bt(),Rt[3]="uSLO",kt[3]=oe(Ct),Rt[4]="uNOP",kt[4]=Dt(at),Rt[5]="ORA",kt[5]=Nt(at),Rt[6]="ASL",kt[6]=$t(vt),Rt[7]="uSLO",kt[7]=oe(vt),Rt[8]="PHP",kt[8]=[k,D,function(){et(it())},B],Rt[9]="ORA",kt[9]=Nt(rt),Rt[10]="ASL",kt[10]=nt((function(){q(r>127),G(r=r<<1&255),J(r)})),Rt[11]="uANC",kt[11]=Ht(rt),Rt[12]="uNOP",kt[12]=Dt(ht),Rt[13]="ORA",kt[13]=Nt(ht),Rt[14]="ASL",kt[14]=$t(xt),Rt[15]="uSLO",kt[15]=oe(xt),Rt[16]="BPL",kt[16]=re(7,0),Rt[17]="ORA",kt[17]=Nt(ut),Rt[18]="uKIL",kt[18]=Bt(),Rt[19]="uSLO",kt[19]=oe(Lt),Rt[20]="uNOP",kt[20]=Dt(dt(0)),Rt[21]="ORA",kt[21]=Nt(dt(0)),Rt[22]="ASL",kt[22]=$t(wt(0)),Rt[23]="uSLO",kt[23]=oe(wt(0)),Rt[24]="CLC",kt[24]=nt((function(){f=0})),Rt[25]="ORA",kt[25]=Nt(ct(1)),Rt[26]="uNOP",kt[26]=Dt(nt),Rt[27]="uSLO",kt[27]=oe(St(1)),Rt[28]="uNOP",kt[28]=Dt(ct(0)),Rt[29]="ORA",kt[29]=Nt(ct(0)),Rt[30]="ASL",kt[30]=$t(St(0)),Rt[31]="uSLO",kt[31]=oe(St(0)),Rt[32]="JSR",kt[32]=[k,j,tt,function(){et(o>>>8&255)},function(){et(255&o)},O,function(){o=y,B()}],Rt[33]="AND",kt[33]=jt(lt),Rt[34]="uKIL",kt[34]=Bt(),Rt[35]="uRLA",kt[35]=ie(Ct),Rt[36]="BIT",kt[36]=Ot(at),Rt[37]="AND",kt[37]=jt(at),Rt[38]="ROL",kt[38]=qt(vt),Rt[39]="uRLA",kt[39]=ie(vt),Rt[40]="PLP",kt[40]=[k,D,tt,function(){st(Q())},B],Rt[41]="AND",kt[41]=jt(rt),Rt[42]="ROL",kt[42]=nt((function(){var t=r>127;r=255&(r<<1|f),q(t),G(r),J(r)})),Rt[43]="uANC",kt[43]=Ht(rt),Rt[44]="BIT",kt[44]=Ot(ht),Rt[45]="AND",kt[45]=jt(ht),Rt[46]="ROL",kt[46]=qt(xt),Rt[47]="uRLA",kt[47]=ie(xt),Rt[48]="BMI",kt[48]=re(7,1),Rt[49]="AND",kt[49]=jt(ut),Rt[50]="uKIL",kt[50]=Bt(),Rt[51]="uRLA",kt[51]=ie(Lt),Rt[52]="uNOP",kt[52]=Dt(dt(0)),Rt[53]="AND",kt[53]=jt(dt(0)),Rt[54]="ROL",kt[54]=qt(wt(0)),Rt[55]="uRLA",kt[55]=ie(wt(0)),Rt[56]="SEC",kt[56]=nt((function(){f=1})),Rt[57]="AND",kt[57]=jt(ct(1)),Rt[58]="uNOP",kt[58]=Dt(nt),Rt[59]="uRLA",kt[59]=ie(St(1)),Rt[60]="uNOP",kt[60]=Dt(ct(0)),Rt[61]="AND",kt[61]=jt(ct(0)),Rt[62]="ROL",kt[62]=qt(St(0)),Rt[63]="uRLA",kt[63]=ie(St(0)),Rt[64]="RTI",kt[64]=[k,D,tt,function(){st(Q())},function(){y=Q()},function(){y|=Q()<<8},function(){o=y,B()}],Rt[65]="EOR",kt[65]=At(lt),Rt[66]="uKIL",kt[66]=Bt(),Rt[67]="uSRE",kt[67]=ne(Ct),Rt[68]="uNOP",kt[68]=Dt(at),Rt[69]="EOR",kt[69]=At(at),Rt[70]="LSR",kt[70]=Zt(vt),Rt[71]="uSRE",kt[71]=ne(vt),Rt[72]="PHA",kt[72]=[k,D,function(){et(r)},B],Rt[73]="EOR",kt[73]=At(rt),Rt[74]="LSR",kt[74]=nt((function(){f=1&r,G(r>>>=1),l=0})),Rt[75]="uASR",kt[75]=rt((function(){ot("ASR");var t=r&m;f=1&t,r=t>>>=1,G(t),l=0})),Rt[76]="JMP",kt[76]=[k,j,O,function(){o=y,B()}],Rt[77]="EOR",kt[77]=At(ht),Rt[78]="LSR",kt[78]=Zt(xt),Rt[79]="uSRE",kt[79]=ne(xt),Rt[80]="BVC",kt[80]=re(6,0),Rt[81]="EOR",kt[81]=At(ut),Rt[82]="uKIL",kt[82]=Bt(),Rt[83]="uSRE",kt[83]=ne(Lt),Rt[84]="uNOP",kt[84]=Dt(dt(0)),Rt[85]="EOR",kt[85]=At(dt(0)),Rt[86]="LSR",kt[86]=Zt(wt(0)),Rt[87]="uSRE",kt[87]=ne(wt(0)),Rt[88]="CLI",kt[88]=nt((function(){u=0})),Rt[89]="EOR",kt[89]=At(ct(1)),Rt[90]="uNOP",kt[90]=Dt(nt),Rt[91]="uSRE",kt[91]=ne(St(1)),Rt[92]="uNOP",kt[92]=Dt(ct(0)),Rt[93]="EOR",kt[93]=At(ct(0)),Rt[94]="LSR",kt[94]=Zt(St(0)),Rt[95]="uSRE",kt[95]=ne(St(0)),Rt[96]="RTS",kt[96]=[k,D,tt,function(){y=Q()},function(){y|=Q()<<8},function(){o=y,K()},B],Rt[97]="ADC",kt[97]=Pt(lt),Rt[98]="uKIL",kt[98]=Bt(),Rt[99]="uRRA",kt[99]=se(Ct),Rt[100]="uNOP",kt[100]=Dt(at),Rt[101]="ADC",kt[101]=Pt(at),Rt[102]="ROR",kt[102]=Qt(vt),Rt[103]="uRRA",kt[103]=se(vt),Rt[104]="PLA",kt[104]=[k,D,tt,function(){r=Q(),G(r),J(r)},B],Rt[105]="ADC",kt[105]=Pt(rt),Rt[106]="ROR",kt[106]=nt((function(){var t=1&r;r=r>>>1|f<<7,q(t),G(r),J(r)})),Rt[107]="uARR",kt[107]=rt((function(){ot("ARR");var t=r&m;r=t=t>>>1|(f?128:0),G(t),J(t);var e=96&r;96==e?(f=1,c=0):0==e?(f=0,c=0):32==e?(f=0,c=1):64==e&&(f=1,c=1)})),Rt[108]="JMP",kt[108]=[k,U,function(){w|=t.read(o)<<8,o++},E,function(){W(),V()},function(){o=v,B()}],Rt[109]="ADC",kt[109]=Pt(ht),Rt[110]="ROR",kt[110]=Qt(xt),Rt[111]="uRRA",kt[111]=se(xt),Rt[112]="BVS",kt[112]=re(6,1),Rt[113]="ADC",kt[113]=Pt(ut),Rt[114]="uKIL",kt[114]=Bt(),Rt[115]="uRRA",kt[115]=se(Lt),Rt[116]="uNOP",kt[116]=Dt(dt(0)),Rt[117]="ADC",kt[117]=Pt(dt(0)),Rt[118]="ROR",kt[118]=Qt(wt(0)),Rt[119]="uRRA",kt[119]=se(wt(0)),Rt[120]="SEI",kt[120]=nt((function(){u=1})),Rt[121]="ADC",kt[121]=Pt(ct(1)),Rt[122]="uNOP",kt[122]=Dt(nt),Rt[123]="uRRA",kt[123]=se(St(1)),Rt[124]="uNOP",kt[124]=Dt(ct(0)),Rt[125]="ADC",kt[125]=Pt(ct(0)),Rt[126]="ROR",kt[126]=Qt(St(0)),Rt[127]="uRRA",kt[127]=se(St(0)),Rt[128]="uNOP",kt[128]=Dt(rt),Rt[129]="STA",kt[129]=Wt(gt),Rt[130]="uNOP",kt[130]=Dt(rt),Rt[131]="uSAX",kt[131]=_t(gt),Rt[132]="STY",kt[132]=Xt(pt),Rt[133]="STA",kt[133]=Wt(pt),Rt[134]="STX",kt[134]=Kt(pt),Rt[135]="uSAX",kt[135]=_t(pt),Rt[136]="DEY",kt[136]=nt((function(){G(h=h-1&255),J(h)})),Rt[137]="uNOP",kt[137]=Dt(rt),Rt[138]="TXA",kt[138]=nt((function(){G(r=a),J(r)})),Rt[139]="uANE",kt[139]=function(t){return t((function(){ot("ANE")}))}(rt),Rt[140]="STY",kt[140]=Xt(ft),Rt[141]="STA",kt[141]=Wt(ft),Rt[142]="STX",kt[142]=Kt(ft),Rt[143]="uSAX",kt[143]=_t(ft),Rt[144]="BCC",kt[144]=re(0,0),Rt[145]="STA",kt[145]=Wt(yt),Rt[146]="uKIL",kt[146]=Bt(),Rt[147]="uSHA",kt[147]=Yt(yt),Rt[148]="STY",kt[148]=Xt(mt(0)),Rt[149]="STA",kt[149]=Wt(mt(0)),Rt[150]="STX",kt[150]=Kt(mt(1)),Rt[151]="uSAX",kt[151]=_t(mt(1)),Rt[152]="TYA",kt[152]=nt((function(){G(r=h),J(r)})),Rt[153]="STA",kt[153]=Wt(bt(1)),Rt[154]="TXS",kt[154]=nt((function(){n=a})),Rt[155]="uSHS",kt[155]=function(t){return t((function(){ot("SHS");var t=r&a;n=t,m=t&1+(v>>>8)&255}))}(bt(1)),Rt[156]="uSHY",kt[156]=function(t){return t((function(){ot("SHY"),m=h&1+(v>>>8)&255}))}(bt(0)),Rt[157]="STA",kt[157]=Wt(bt(0)),Rt[158]="uSHX",kt[158]=function(t){return t((function(){ot("SHX"),m=a&1+(v>>>8)&255}))}(bt(1)),Rt[159]="uSHA",kt[159]=Yt(bt(1)),Rt[160]="LDY",kt[160]=Ft(rt),Rt[161]="LDA",kt[161]=Et(lt),Rt[162]="LDX",kt[162]=Vt(rt),Rt[163]="uLAX",kt[163]=Ut(lt),Rt[164]="LDY",kt[164]=Ft(at),Rt[165]="LDA",kt[165]=Et(at),Rt[166]="LDX",kt[166]=Vt(at),Rt[167]="uLAX",kt[167]=Ut(at),Rt[168]="TAY",kt[168]=nt((function(){G(h=r),J(h)})),Rt[169]="LDA",kt[169]=Et(rt),Rt[170]="TAX",kt[170]=nt((function(){G(a=r),J(a)})),Rt[171]="uLXA",kt[171]=function(t){return t((function(){ot("LXA");var t=r&m;r=t,a=t,G(t),J(t)}))}(rt),Rt[172]="LDY",kt[172]=Ft(ht),Rt[173]="LDA",kt[173]=Et(ht),Rt[174]="LDX",kt[174]=Vt(ht),Rt[175]="uLAX",kt[175]=Ut(ht),Rt[176]="BCS",kt[176]=re(0,1),Rt[177]="LDA",kt[177]=Et(ut),Rt[178]="uKIL",kt[178]=Bt(),Rt[179]="uLAX",kt[179]=Ut(ut),Rt[180]="LDY",kt[180]=Ft(dt(0)),Rt[181]="LDA",kt[181]=Et(dt(0)),Rt[182]="LDX",kt[182]=Vt(dt(1)),Rt[183]="uLAX",kt[183]=Ut(dt(1)),Rt[184]="CLV",kt[184]=nt((function(){c=0})),Rt[185]="LDA",kt[185]=Et(ct(1)),Rt[186]="TSX",kt[186]=nt((function(){G(a=n),J(a)})),Rt[187]="uLAS",kt[187]=function(t){return t((function(){ot("LAS");var t=n&m;r=t,a=t,n=t,G(t),J(t)}))}(ct(1)),Rt[188]="LDY",kt[188]=Ft(ct(0)),Rt[189]="LDA",kt[189]=Et(ct(0)),Rt[190]="LDX",kt[190]=Vt(ct(1)),Rt[191]="uLAX",kt[191]=Ut(ct(1)),Rt[192]="CPY",kt[192]=It(rt),Rt[193]="CMP",kt[193]=Mt(lt),Rt[194]="uNOP",kt[194]=Dt(rt),Rt[195]="uDCP",kt[195]=te(Ct),Rt[196]="CPY",kt[196]=It(at),Rt[197]="CMP",kt[197]=Mt(at),Rt[198]="DEC",kt[198]=Gt(vt),Rt[199]="uDCP",kt[199]=te(vt),Rt[200]="INY",kt[200]=nt((function(){G(h=h+1&255),J(h)})),Rt[201]="CMP",kt[201]=Mt(rt),Rt[202]="DEX",kt[202]=nt((function(){G(a=a-1&255),J(a)})),Rt[203]="uSBX",kt[203]=function(t){return t((function(){ot("SBX");var t=r&a,e=t-m&255;a=e,q(t>=m),G(e),J(e)}))}(rt),Rt[204]="CPY",kt[204]=It(ht),Rt[205]="CMP",kt[205]=Mt(ht),Rt[206]="DEC",kt[206]=Gt(xt),Rt[207]="uDCP",kt[207]=te(xt),Rt[208]="BNE",kt[208]=re(1,0),Rt[209]="CMP",kt[209]=Mt(ut),Rt[210]="uKIL",kt[210]=Bt(),Rt[211]="uDCP",kt[211]=te(Lt),Rt[212]="uNOP",kt[212]=Dt(dt(0)),Rt[213]="CMP",kt[213]=Mt(dt(0)),Rt[214]="DEC",kt[214]=Gt(wt(0)),Rt[215]="uDCP",kt[215]=te(wt(0)),Rt[216]="CLD",kt[216]=nt((function(){d=0})),Rt[217]="CMP",kt[217]=Mt(ct(1)),Rt[218]="uNOP",kt[218]=Dt(nt),Rt[219]="uDCP",kt[219]=te(St(1)),Rt[220]="uNOP",kt[220]=Dt(ct(0)),Rt[221]="CMP",kt[221]=Mt(ct(0)),Rt[222]="DEC",kt[222]=Gt(St(0)),Rt[223]="uDCP",kt[223]=te(St(0)),Rt[224]="CPX",kt[224]=Tt(rt),Rt[225]="SBC",kt[225]=zt(lt),Rt[226]="uNOP",kt[226]=Dt(rt),Rt[227]="uISB",kt[227]=ee(Ct),Rt[228]="CPX",kt[228]=Tt(at),Rt[229]="SBC",kt[229]=zt(at),Rt[230]="INC",kt[230]=Jt(vt),Rt[231]="uISB",kt[231]=ee(vt),Rt[232]="INX",kt[232]=nt((function(){G(a=a+1&255),J(a)})),Rt[233]="SBC",kt[233]=zt(rt),Rt[234]="NOP",kt[234]=nt((function(){})),Rt[235]="SBC",kt[235]=zt(rt),Rt[236]="CPX",kt[236]=Tt(ht),Rt[237]="SBC",kt[237]=zt(ht),Rt[238]="INC",kt[238]=Jt(xt),Rt[239]="uISB",kt[239]=ee(xt),Rt[240]="BEQ",kt[240]=re(1,1),Rt[241]="SBC",kt[241]=zt(ut),Rt[242]="uKIL",kt[242]=Bt(),Rt[243]="uISB",kt[243]=ee(Lt),Rt[244]="uNOP",kt[244]=Dt(dt(0)),Rt[245]="SBC",kt[245]=zt(dt(0)),Rt[246]="INC",kt[246]=Jt(wt(0)),Rt[247]="uISB",kt[247]=ee(wt(0)),Rt[248]="SED",kt[248]=nt((function(){d=1})),Rt[249]="SBC",kt[249]=zt(ct(1)),Rt[250]="uNOP",kt[250]=Dt(nt),Rt[251]="uISB",kt[251]=ee(St(1)),Rt[252]="uNOP",kt[252]=Dt(ct(0)),Rt[253]="SBC",kt[253]=zt(ct(0)),Rt[254]="INC",kt[254]=Jt(St(0)),Rt[255]="uISB",kt[255]=ee(St(0)),this.saveState=function(){return{PC:o-1&65535,A:r,X:a,Y:h,SP:n,N:l,V:c,D:d,I:u,Z:p,C:f,T:g,o:b,R:s?1:0,d:m,AD:y,BA:v,BC:x?1:0,IA:w,bo:S,boa:C}},this.loadState=function(t){o=t.PC+1&65535,r=t.A,a=t.X,h=t.Y,n=t.SP,l=t.N,c=t.V,d=t.D,u=t.I,p=t.Z,f=t.C,g=t.T,b=t.o,s=!!t.R,m=t.d,y=t.AD,v=t.BA,x=!!t.BC,w=t.IA,S=t.bo,C=t.boa,i=b<0?[k]:kt[b]},this.toString=function(){return"CPU  PC: "+o.toString(16)+"  op: "+b.toString()+"  T: "+g+"  data: "+m+"\n A: "+r.toString(16)+"  X: "+a.toString(16)+"  Y: "+h.toString(16)+"  SP: "+n.toString(16)+"     N"+l+"  V"+c+"  D"+d+"  I"+u+"  Z"+p+"  C"+f+"  "},this.breakpoint=function(t){this.trace&&this.toString()};var ae=[7,6,0,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,0,8,4,4,6,6,2,4,0,7,4,4,7,7,6,6,0,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,0,8,4,4,6,6,2,4,0,7,4,4,7,7,6,6,0,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,0,8,4,4,6,6,2,4,0,7,4,4,7,7,6,6,0,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,0,8,4,4,6,6,2,4,0,7,4,4,7,7,0,6,0,6,3,3,3,3,2,0,2,0,4,4,4,4,2,6,0,0,4,4,4,4,2,5,2,0,0,5,0,0,2,6,2,6,3,3,3,3,2,2,2,0,4,4,4,4,2,5,0,5,4,4,4,4,2,4,2,0,4,4,4,4,2,6,0,8,3,3,5,5,2,2,2,2,4,4,3,6,2,5,0,8,4,4,6,6,2,4,0,7,4,4,7,7,2,6,0,8,3,3,5,5,2,2,2,0,4,4,6,6,2,5,0,8,4,4,6,6,2,4,0,7,4,4,7,7],he=[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,0,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,0,0,0,1,0,1,0,1,1,1,0,1],le=[1,2,0,2,2,2,2,2,1,2,1,2,3,3,3,3,2,2,0,2,2,2,2,2,1,3,0,3,3,3,3,3,3,2,0,2,2,2,2,2,1,2,1,2,3,3,3,3,2,2,0,2,2,2,2,2,1,3,0,3,3,3,3,3,1,2,0,2,2,2,2,2,1,2,1,2,3,3,3,3,2,2,0,2,2,2,2,2,1,3,0,3,3,3,3,3,1,2,0,2,2,2,2,2,1,2,1,2,3,3,3,3,2,2,0,2,2,2,2,2,1,3,0,3,3,3,3,3,0,2,0,2,2,2,2,2,1,0,1,0,3,3,3,3,2,2,0,0,2,2,2,3,1,3,1,0,0,3,0,0,2,2,2,2,2,2,2,2,1,2,1,0,3,3,3,3,2,2,0,2,2,2,2,2,1,3,1,0,3,3,3,3,2,2,0,2,2,2,2,2,1,2,1,2,3,3,3,3,2,2,0,2,2,2,2,2,1,3,0,3,3,3,3,3,2,2,0,2,2,2,2,2,1,2,1,0,3,3,3,3,2,2,0,2,2,2,2,2,1,3,0,3,3,3,3,3];this.getOpcodeMetadata=function(t,e){return{opcode:t,mnenomic:Rt[t],minCycles:ae[t],maxCycles:ae[t]+he[t],insnlength:le[t]}},this.setNMI=function(){i=[k,K,function(){e.debug&&e.breakpoint("NMI "+m),et(o>>>8&255)},function(){et(255&o)},function(){et(it())},function(){y=t.read(65530)},function(){y|=t.read(65531)<<8},function(){o=y,B()}],g=1,o=o-1&65535},this.setIRQ=function(){i=[k,K,function(){e.debug&&e.breakpoint("IRQ "+m),et(o>>>8&255)},function(){et(255&o)},function(){et(it())},function(){y=t.read(65534)},function(){y|=t.read(65535)<<8},function(){o=y,B()}],g=1,o=o-1&65535},this.getSP=function(){return n},this.getPC=function(){return o-1&65535},this.getT=function(){return g},this.getA=function(){return r},this.getX=function(){return a},this.getY=function(){return h},this.getStatusBits=function(){return it()},this.getCycleCount=function(){return L},this.setStatusBits=function(t){st(t)},this.isPCStable=function(){return 0==g}};!function(t){t[t.None=0]="None",t[t.NMI=1]="NMI",t[t.IRQ=2]="IRQ"}(i||(i={})),e.MOS6502=class{constructor(){this.cpu=new s}connectMemoryBus(t){this.cpu.connectBus(t)}advanceClock(){this.cpu.clockPulse()}advanceInsn(){let t=0;do{this.advanceClock(),t+=1}while(!this.isStable());return t}reset(){this.cpu.reset()}getSP(){return this.cpu.getSP()}getPC(){return this.cpu.getPC()}getStatusBits(){return this.cpu.getStatusBits()}setStatusBits(t){return this.cpu.setStatusBits(t)}getCycleCount(){return this.cpu.getCycleCount()}getA(){return this.cpu.getA()}getX(){return this.cpu.getX()}getY(){return this.cpu.getY()}saveState(){return this.cpu.saveState()}loadState(t){this.cpu.loadState(t)}isStable(){return this.cpu.isPCStable()}}},9273:function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))},o=this&&this.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},s("next"),s("throw"),s("return"),e[Symbol.asyncIterator]=function(){return this},e);function s(i){e[i]=t[i]&&function(e){return new Promise((function(s,o){!function(t,e,i,s){Promise.resolve(s).then((function(e){t({value:e,done:i})}),e)}(s,o,(e=t[i](e)).done,e.value)}))}}};Object.defineProperty(e,"__esModule",{value:!0}),e.dbug=e.machine=e.Coverage=e.CoverageState=void 0;const n=i(4017),r=i(2174),a=i(126),h=i(6458),l=i(922),c=i(2439);i(2926),i(1380),i(5505),i(8981);const d=i(5088);var u;i(2683),i(8232),i(686),function(t){t[t.Executed=1]="Executed",t[t.BranchTarget=2]="BranchTarget",t[t.JumpTarget=4]="JumpTarget",t[t.CallTarget=8]="CallTarget",t[t.ReturnTarget=16]="ReturnTarget"}(u=e.CoverageState||(e.CoverageState={})),e.Coverage=class{constructor(){this.state=new Uint8Array(65536),this.nextState=new Uint8Array(65536),this.reset()}reset(){this.state.fill(0),this.nextState.fill(0),this.minPC=65536,this.maxPC=-1,this.lastPC=-1}step(t,e,i){this.nextState[t]|=u.Executed,this.minPC>t&&(this.minPC=t),this.maxPC<t&&(this.maxPC=t),this.lastPC=e,r.Isa6502.isBranch(i)?e!=t+2&&(this.nextState[e]|=u.BranchTarget):r.Isa6502.isJump(i)?this.nextState[e]|=u.JumpTarget:r.Isa6502.isCall(i)?this.nextState[e]|=u.CallTarget:r.Isa6502.isReturn(i)&&(this.nextState[e]|=u.ReturnTarget)}process(t){for(;this.minPC<=this.maxPC;)this.nextState[this.minPC]^this.state[this.minPC]&&(t(this.minPC,this.nextState[this.minPC]),this.state[this.minPC]=this.nextState[this.minPC]),this.minPC+=1;-1!=this.lastPC&&(t(this.lastPC,this.nextState[this.lastPC]),this.lastPC=-1),this.minPC=65536,this.maxPC=-1}},e.machine=new n.Machine,e.machine.reset(),e.dbug=new class{constructor(){this.steppingOut=0,this.isRunning=!1,this.isScheduled=!1,this.nextCpuRunTimeMs=0;let t=document.getElementById("reg-table");this.registerView=new h.RegisterView(t);let i=document.getElementById("display-grid");this.displayView=new c.DisplayView(i,e.machine),this.displayView.updateDisplay(this.isRunning);let s=i.querySelector("#screen-div");new ResizeObserver((()=>{this.displayView.onResize(s.clientWidth-8,s.clientHeight-8)})).observe(s);let o=document.getElementById("files-side");o.ondragover=t=>{this.allowDrop(t)},o.ondrop=t=>{this.handleDrop(t)};let n=document.getElementById("code-side");n.ondragover=t=>{this.allowDrop(t)},n.ondrop=t=>{this.handleDrop(t)},document.getElementById("restart").onclick=()=>{this.onResetCpu()},document.getElementById("stepout").onclick=()=>{this.onStepCpuOutOf()},document.getElementById("stepinto").onclick=()=>{this.onStepCpuInto()},document.getElementById("stepover").onclick=()=>{this.onStepCpuOver()},document.getElementById("continue").onclick=()=>{this.onStartCpu()},document.getElementById("pause").onclick=()=>{this.onStopCpu()},(0,d.default)("#pause",{content:"Pause (F6)"}),(0,d.default)("#continue",{content:"Continue (F5)"}),(0,d.default)("#stepinto",{content:"Step Into (F11)"}),(0,d.default)("#stepover",{content:"Step Over (F10)"}),(0,d.default)("#stepout",{content:"Step Out (⇧F11)"}),(0,d.default)("#restart",{content:"Restart (⌃⇧F5)"}),document.addEventListener("keydown",(t=>t.keyCode>=37&&t.keyCode<=40?(t.preventDefault(),void t.stopPropagation()):t.metaKey&&"o"==t.key?(this.openProject(),t.preventDefault(),void t.stopPropagation()):void 0)),document.addEventListener("keyup",(t=>{this.onCodeKeyUp(t)}))}allowDrop(t){t.preventDefault()}handleDrop(t){t.preventDefault(),t.dataTransfer.items&&t.dataTransfer.items.length>0&&this.dropProjectDir(t.dataTransfer.items[0])}openProject(){var t,e;return s(this,void 0,void 0,(function*(){let i=window;if(i&&"function"==typeof(null==i?void 0:i.showDirectoryPicker))try{let r=yield i.showDirectoryPicker();try{for(var s,n=o(r.values());!(s=yield n.next()).done;){const t=s.value;if(t.name.toLowerCase().endsWith(".json"))return this.loadProject(t.name,r)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&(yield e.call(n))}finally{if(t)throw t.error}}}catch(t){return}}))}dropProjectDir(t){var e,i;return s(this,void 0,void 0,(function*(){let s=yield t.getAsFileSystemHandle();if("directory"==s.kind)try{for(var n,r=o(s.values());!(n=yield r.next()).done;){const t=n.value;if(t.name.toLowerCase().endsWith(".json"))return this.loadProject(t.name,s)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&(yield i.call(r))}finally{if(e)throw e.error}}}))}loadProject(t,e,i){return s(this,void 0,void 0,(function*(){this.project=new a.Project,yield this.project.loadFile(t,e,i);let s=document.getElementById("watch-table");this.watchView=new l.WatchView(this.project,s),this.watchView.loadWatches(),this.displayView.loadSettings(this.project.name),this.onResetCpu()}))}onCodeKeyUp(t){27==t.keyCode&&(this.project.popScrollPosition(),t.preventDefault())}refreshViews(){this.registerView.update(this.isRunning),this.watchView&&this.watchView.update(this.isRunning),this.displayView.updateDisplay(this.isRunning);let t=document.getElementById("continue"),e=document.getElementById("pause");t.style.display=this.isRunning?"none":"inline",e.style.display=this.isRunning?"inline":"none"}onResetCpu(){var t;if(this.isRunning=!1,this.project){this.project.clearVisiblePC();let i=null!==(t=this.project.startAddress)&&void 0!==t?t:24576;e.machine.setPC(i),this.project.activatePCView(),this.refreshViews()}}onStartCpu(){!this.isRunning&&this.project&&(this.project.clearVisiblePC(),this.isRunning=!0,this.nextCpuRunTimeMs=0,this.refreshViews(),this.isScheduled||(this.scheduleCpu(0),this.isScheduled=!0))}onStopCpu(){this.isRunning&&this.project&&(this.isRunning=!1,this.project.activatePCView(),this.refreshViews())}onStepCpuInto(){!this.isRunning&&this.project&&(this.project.clearVisiblePC(),this.stepCpu(!0),this.project.activatePCView(),this.refreshViews())}onStepCpuOver(){var t;if(!this.isRunning&&this.project)if(r.Isa6502.isCall(e.machine.readConst(e.machine.getPC()))){let i=null!==(t=this.project.chooseStepOverPC())&&void 0!==t?t:e.machine.getPC()+3;this.project.breakpoints.setOneShotBreakpoint(i),this.onStartCpu()}else this.onStepCpuInto()}onStepCpuOutOf(){!this.isRunning&&this.project&&0==this.steppingOut&&(r.Isa6502.isReturn(e.machine.readConst(e.machine.getPC()))?this.steppingOut=1:this.steppingOut=2,this.onStartCpu())}scheduleCpu(t){setTimeout((()=>{this.onRunCpu(Date.now())}),t)}stepCpu(t){if(this.project.coverage){let i=e.machine.getPC(),s=e.machine.readConst(e.machine.getPC()),o=e.machine.advanceCpu();return this.project.coverage.step(i,e.machine.getPC(),s),t&&this.project.processCoverage(),o}return e.machine.advanceCpu()}onRunCpu(t){if(t>=this.nextCpuRunTimeMs){let t=Math.floor(e.machine.clockRate/60);for(;t>0;){if(this.steppingOut>0){let t=e.machine.readConst(e.machine.getPC());r.Isa6502.isCall(t)&&(this.steppingOut+=1)}this.project.coverage?t-=this.stepCpu(!1):t-=e.machine.advanceCpu();let i=!0;if(this.project.breakpoints.checkBreakpoints(e.machine.getPC())&&(i=!1),this.steppingOut>0&&(this.steppingOut>=2&&i?r.Isa6502.isReturn(e.machine.readConst(e.machine.getPC()))&&(this.steppingOut-=1):(this.steppingOut=0,i=!1)),!i){this.onStopCpu();break}}e.machine.speaker.update(!0),this.displayView.updateDisplay(!0)}this.isRunning&&this.project.coverage&&this.project.processCoverage(),this.nextCpuRunTimeMs+=1e3/60;let i=this.nextCpuRunTimeMs-t;i<0&&(-i>1e3&&(this.nextCpuRunTimeMs=t),i=0),this.isRunning?this.scheduleCpu(i):this.isScheduled=!1}onAddWatch(){let t=this.project.sourceViewLineFromSelection();t&&this.watchView.addEntryFromSourceViewLine(t)}onScrollToPc(){this.isRunning||this.project.activatePCView()}onRunToCursor(){if(!this.isRunning){let t=this.project.sourceDocLineFromSelection();t&&(this.project.breakpoints.setBreakpoint("once",t.sourceDoc,t.sourceLine),this.onStartCpu())}}onSetNextStatement(){if(!this.isRunning){let t=this.project.sourceDocLineFromSelection();t&&(this.project.clearVisiblePC(),e.machine.setPC(t.sourceLine.address),this.project.activatePCView())}}onSetBreakpoint(){let t=this.project.sourceViewLineFromSelection();t&&this.project.toggleBreakpoint(t)}}},773:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Disassembler=void 0;const s=i(2174),o=i(9273),n=i(8887);e.Disassembler=class{constructor(t){this.useUpperCase=t}setSourceView(t){this.sourceView=t}load(t,e){var i,s,o;this.dis65=e,this.sourceDoc=t;let r=new n.SourceLine;if(r.objBuffer=t.objBuffer,r.objOffset=0,r.objLength=r.objBuffer.length,r.opcode=".bulk",r.args="...",t.sourceLines.push(r),null===(i=this.dis65.AddressMap)||void 0===i||i.forEach((t=>{let e=this.findByOffsetAndSplit(t.Offset);e&&(e.address=t.Addr)})),this.dis65.LongComments)for(const t in this.dis65.LongComments){let e=parseInt(t),i=0;if(e>=0){let t=this.findByOffsetAndSplit(e);if(!t){console.log("couldn't find long comment offset "+e);continue}i=this.sourceDoc.sourceLines.indexOf(t)}let s=!0,o=this.dis65.LongComments[t],r=o.MaxWidth-2;o.BoxMode&&(r-=2);let a=o.Text;for(;""!=a;){let t,h=a.indexOf("\r\n");for(h>=0?(t=a.substring(0,h),a=a.substring(h+2)):(t=a,a="");;){let a=t;if(t.length>r){let e=-1;for(let i=0;i<t.length&&(" "==t[i]&&(e=i),i!=r);i+=1);if(-1==e)break;a=t.substring(0,e),t=t.substring(e+1)}else t="";if(s){if(""!=a&&e>=0){let t=new n.SourceLine;t.comment=" ",this.insertLine(t,i),i+=1}if(o.BoxMode){let t=new n.SourceLine;t.comment="*".repeat(o.MaxWidth),this.insertLine(t,i),i+=1}}let h=new n.SourceLine;if(h.comment=o.BoxMode?"* ":"; ",h.comment+=a,o.BoxMode&&(h.comment=h.comment.padEnd(o.MaxWidth-1)+"*"),this.insertLine(h,i),i+=1,s=!1,""==t)break}}if(o.BoxMode){let t=new n.SourceLine;t.comment="*".repeat(o.MaxWidth),this.insertLine(t,i)}}if(this.dis65.TypeHints)for(const t in this.dis65.TypeHints){let e=this.dis65.TypeHints[t];if("Code"==e.Hint){let t=parseInt(e.Low),i=parseInt(e.High);this.disasmOffsetRange(t,i)}}if(this.dis65.UserLabels)for(const t in this.dis65.UserLabels){let e=parseInt(t),i=this.findByOffsetAndSplit(e);if(i){let e=this.dis65.UserLabels[t];"NonUniqueLocalAddr"==e.Type?i.label="@"+e.Label:i.label=e.Label,"Uncertain"==e.LabelAnno&&(i.label+="?")}else console.log("couldn't find user label line offset "+e)}if(this.dis65.Comments)for(const t in this.dis65.Comments){let e=parseInt(t),i=this.findByOffsetAndSplit(e);i?i.comment="; "+this.dis65.Comments[t]:console.log("couldn't find comment line offset "+e)}if(this.dis65.OperandFormats)for(const t in this.dis65.OperandFormats){let e=parseInt(t),i=this.dis65.OperandFormats[t],r=this.findByOffsetAndSplit(e,i.Length),a=!1;if(r){if("Junk"==i.Format)r.opcode=".junk",r.args=i.Length.toString(),a=!0;else if("Fill"==i.Format)r.opcode=".fill",r.args=i.Length.toString()+",$"+r.objBuffer[r.objOffset].toString(16).padStart(2,"0"),a=!0;else if("Uninit"==i.Format)r.opcode="ds",r.args=i.Length.toString(),a=!0;else if("Dense"==i.Format){r.opcode="hex",r.args="";for(let t=0;t<r.objLength;t+=1){if(8==t){r.args+="+";break}r.args+=r.objBuffer[r.objOffset+t].toString(16).padStart(2,"0")}}else"NumericLE"==i.Format&&1==i.Length&&(r.opcode="db","Symbol"==i.SubFormat?("Low"==(null===(s=i.SymbolRef)||void 0===s?void 0:s.Part)?r.args="<":r.args=">",r.args+=null===(o=i.SymbolRef)||void 0===o?void 0:o.Label):r.args="$"+r.objBuffer[r.objOffset].toString(16).padStart(2,"0"));if(a){let t=this.sourceDoc.sourceLines.indexOf(r),e=new n.SourceLine;e.objOffset=r.objOffset,this.sourceDoc.sourceLines.splice(t+1,0,e),e=new n.SourceLine,e.objOffset=r.objOffset,this.sourceDoc.sourceLines.splice(t,0,e)}}else console.log("couldn't find operand format offset "+e)}}findLabelByAddress(t){for(const e in this.dis65.ProjectProps.ProjectSyms){let i=this.dis65.ProjectProps.ProjectSyms[e];if(i.Value==t)return{Label:i.Label,Value:t}}let e,i,s=65536;for(const o in this.dis65.UserLabels){let n=this.dis65.UserLabels[o];if(n.Value<=t){let o=t-n.Value;o<s&&(e="NonUniqueLocalAddr"==n.Type?"@"+n.Label:n.Label,"Uncertain"==n.LabelAnno&&(e+="?"),i=n.Value,s=o)}}if(e)return{Label:e,Value:i}}findAddressByLabel(t){var e;let i=null===(e=this.dis65.ProjectProps)||void 0===e?void 0:e.ProjectSyms[t];if(i)return i.Value;for(const e in this.dis65.UserLabels){let i=this.dis65.UserLabels[e];if(i.Label==t)return i.Value}return-1}findByOffsetAndSplit(t,e=0){let i,s;for(let e=0;e<this.sourceDoc.sourceLines.length;e+=1){let o=this.sourceDoc.sourceLines[e];if(t==o.objOffset&&0!=o.objLength){i=o,s=e;break}if(t>o.objOffset&&t<o.objOffset+o.objLength){i=o.splitBeforeOffset(t),s=e+1,this.insertLine(i,s);break}}if(i&&e>0&&i.objLength>e){let t=i.splitBeforeOffset(i.objOffset+e);this.insertLine(t,s+1)}return i}insertLine(t,e){this.sourceDoc.sourceLines.splice(e,0,t)}disasmOffsetRange(t,e){let i=t!=e;this.curOffset=t,this.curLine=null,this.startLine=null,this.startIndex=-1,this.dasmLines=[];for(let t=0;t<this.sourceDoc.sourceLines.length;t+=1){let e=this.sourceDoc.sourceLines[t];if(this.curOffset>=e.objOffset&&this.curOffset<e.objOffset+e.objLength){this.curIndex=t,this.curLine=e;break}}if(this.curLine){for(;;){let t=this.curLine.objBuffer[this.curOffset];if(".bulk"==this.curLine.opcode){if(!i&&s.Isa6502.isIllegal(t))break;this.disasmLine()}else 0!=this.dasmLines.length?this.applyDasmLines():this.advanceOffset(this.curLine.objLength);if(!this.curLine)break;if(i){if(this.curOffset>=e)break}else if(s.Isa6502.isFlowControl(t))break}0!=this.dasmLines.length&&this.applyDasmLines()}else console.log("Failed to find block with offset "+t)}initByAddress(t){this.curOffset=-1,this.curLine=null,this.startLine=null,this.startIndex=-1,this.dasmLines=[],this.curIndex=this.sourceDoc.findLineByAddress(t),-1!=this.curIndex&&(this.curLine=this.sourceDoc.sourceLines[this.curIndex],this.curOffset=this.curLine.objOffset+t-this.curLine.address)}disasmAddress(t){if(this.initByAddress(t),this.curLine){for(;;){let t=this.curLine.objBuffer[this.curOffset];if(".bulk"==this.curLine.opcode){if(s.Isa6502.isIllegal(t))break;this.disasmLine()}else 0!=this.dasmLines.length?this.applyDasmLines():this.advanceOffset(this.curLine.objLength);if(!this.curLine)break;if(s.Isa6502.isFlowControl(t))break}0!=this.dasmLines.length&&this.applyDasmLines()}else console.log("Failed to find block with address "+t)}processCoverage(t){let e=t.lastPC;if(this.curLine=null,t.process(((t,e)=>{if(t>=53248)return;for(let e=0;e<2;e+=1){if(this.curLine){if(t!=this.curLine.address+this.curOffset){0!=this.dasmLines.length&&this.applyDasmLines(),this.curLine=null,this.curIndex=-1;continue}}else this.initByAddress(t);break}if(!this.curLine)return void console.log("Failed to find block with address "+t);let i;".bulk"!=this.curLine.opcode?e&(o.CoverageState.BranchTarget|o.CoverageState.CallTarget|o.CoverageState.JumpTarget)&&""==this.curLine.label&&(this.startLine||(this.startLine=this.curLine,this.startIndex=this.curIndex),i=this.curLine,this.dasmLines.push(i)):i=this.disasmLine(),i?e&(o.CoverageState.BranchTarget|o.CoverageState.CallTarget|o.CoverageState.JumpTarget)&&""==i.label&&(i.label="L"+t.toString(16).padStart(4,"0").toUpperCase()):0!=this.dasmLines.length?this.applyDasmLines():this.advanceOffset(this.curLine.objLength)})),0!=this.dasmLines.length&&this.applyDasmLines(),-1!=e){if(e>=53248)return;this.disasmAddress(e)}}disasmLine(){this.startLine||(this.startLine=this.curLine,this.startIndex=this.curIndex);let t=new n.SourceLine;return t.address=this.curLine.address+this.curOffset-this.curLine.objOffset,t.objBuffer=this.curLine.objBuffer,t.objOffset=this.curOffset,this.disasmSourceLine(t),this.dasmLines.push(t),this.advanceOffset(t.objLength),t}advanceOffset(t){this.curOffset+=t,this.curOffset>=this.curLine.objOffset+this.curLine.objLength&&(this.curIndex+=1,this.curIndex<this.sourceDoc.sourceLines.length?this.curLine=this.sourceDoc.sourceLines[this.curIndex]:(this.curLine=null,this.curIndex=-1))}disasmSourceLine(t){var e,i,o,n;let r=t.objOffset,a=t.objBuffer[r];t.objLength=s.Isa6502.ops[a].bc,t.opcode=s.Isa6502.ops[a].op,this.useUpperCase&&(t.opcode=t.opcode.toUpperCase());let h=0,l=0;t.objLength>1&&(h=t.objBuffer[r+1],l+=1,t.objLength>2&&(h+=t.objBuffer[r+2]<<8,l+=1));let c=s.Isa6502.ops[a].ad,d="";if("a"==c)d=this.useUpperCase?"A":"a";else if("rel"==c){h>=128&&(h=-(1+(255^h))),h+=t.address+2;let e=this.findLabelByAddress(h);d=e&&e.Value==h?e.Label:"L"+h.toString(16).padStart(4,"0").toUpperCase()}else if(l>0)if(d=h.toString(16).padStart(2*l,"0"),d="jsr"==c||"jab"==c?"L"+d.toUpperCase():"$"+d,this.useUpperCase&&(d=d.toUpperCase()),"imm"==c){let t=null===(e=this.dis65)||void 0===e?void 0:e.OperandFormats[r];t&&"NumericLE"==t.Format&&("Symbol"==t.SubFormat?(d="Low"==(null===(i=t.SymbolRef)||void 0===i?void 0:i.Part)?"<":">",d+=null===(o=t.SymbolRef)||void 0===o?void 0:o.Label):"HighAscii"==t.SubFormat?d="'"+String.fromCharCode(127&h)+"' | $80":"Decimal"==t.SubFormat&&(d=h.toString())),d="#"+d}else{let t=null===(n=this.dis65)||void 0===n?void 0:n.OperandFormats[r];if(t){if("Symbol"==t.SubFormat&&t.SymbolRef){d=t.SymbolRef.Label;let e=this.findAddressByLabel(t.SymbolRef.Label);e>=0&&h>e&&(d+="+"+(h-e))}}else{let t=this.findLabelByAddress(h);if(t){let e=h-t.Value;"jsr"!=c&&"jab"!=c||t.Value!=h&&(e=-1),c.startsWith("zp")&&t.Value!=h&&(e=-1),e>=0&&e<256&&(d=t.Label,e>0&&(d+="+"+e))}}"zpx"==c||"abx"==c?d+=this.useUpperCase?",X":",x":"zpy"==c||"aby"==c?d+=this.useUpperCase?",Y":",y":"inx"==c?d="("+d+(this.useUpperCase?",X)":",x)"):"iny"==c?d="("+d+(this.useUpperCase?"),Y":"),y"):"jin"==c&&(d="("+d+")")}t.args=d}applyDasmLines(){let t=this.dasmLines[0];if(t.objOffset>this.startLine.objOffset){let e=new n.SourceLine;e.address=this.startLine.address,e.objBuffer=this.startLine.objBuffer,e.objOffset=this.startLine.objOffset,e.objLength=t.objOffset-this.startLine.objOffset,e.opcode=".bulk",e.args="...",this.dasmLines.splice(0,0,e),t=e}""!=this.startLine.label&&(t.label=this.startLine.label),""!=this.startLine.comment&&(t.comment=this.startLine.comment),this.startLine.hasBreakpoint&&(t.hasBreakpoint=!0);let e=this.startIndex,i=this.startLine;for(let t=0;t<this.dasmLines.length;t+=1){let s=this.dasmLines[t];for(s.objOffset==i.objOffset&&(""!=i.label&&(s.label=i.label),""!=i.comment&&(s.comment=i.comment),i.hasBreakpoint&&(s.hasBreakpoint=!0));s.objOffset+s.objLength>=i.objOffset+i.objLength&&(e+=1,i=this.sourceDoc.sourceLines[e],i)&&s.objOffset+s.objLength!=i.objOffset;);}let s=this.dasmLines[this.dasmLines.length-1],o=s.objOffset+s.objLength;if(i&&o>i.objOffset){let t=new n.SourceLine;t.address=s.address+s.objLength,t.objBuffer=i.objBuffer,t.objOffset=o,t.objLength=i.objOffset+i.objLength-o,t.opcode=".bulk",t.args="...",this.dasmLines.push(t),e+=1,this.curLine=t,this.curIndex=this.startIndex+this.dasmLines.length-(e-this.startIndex)-1,this.curOffset=t.objOffset}else this.curIndex=this.startIndex+this.dasmLines.length-(e-this.startIndex),this.curIndex<this.sourceDoc.sourceLines.length?(this.curLine=this.sourceDoc.sourceLines[this.curIndex],this.curOffset=this.curLine.objOffset):(this.curLine=null,this.curIndex=-1,this.curOffset=-1);if(this.sourceDoc.sourceLines.splice(this.startIndex,e-this.startIndex,...this.dasmLines),this.sourceView){let t="";this.dasmLines.forEach((e=>{t+=this.sourceDoc.buildTextLine(e)})),this.sourceView.editor.setOption("readOnly",!1),this.sourceView.editor.state.suppressEdits=!1,this.sourceView.editor.replaceRange(t,{line:this.startIndex,ch:0},{line:e,ch:0}),this.sourceView.editor.setOption("readOnly",!0),this.dasmLines.forEach(((t,e)=>{this.sourceView.updateObjBytes(this.startIndex+e)}))}this.startLine=null,this.startIndex=-1,this.dasmLines=[]}}},4596:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ZoomHiresDisplay=e.Tool=e.ModifierKeys=e.HiresDisplay=e.hiresTable=void 0;const s=i(9273),o=i(2382),n=i(6419),r=i(6767);e.hiresTable=[0,1024,2048,3072,4096,5120,6144,7168,128,1152,2176,3200,4224,5248,6272,7296,256,1280,2304,3328,4352,5376,6400,7424,384,1408,2432,3456,4480,5504,6528,7552,512,1536,2560,3584,4608,5632,6656,7680,640,1664,2688,3712,4736,5760,6784,7808,768,1792,2816,3840,4864,5888,6912,7936,896,1920,2944,3968,4992,6016,7040,8064,40,1064,2088,3112,4136,5160,6184,7208,168,1192,2216,3240,4264,5288,6312,7336,296,1320,2344,3368,4392,5416,6440,7464,424,1448,2472,3496,4520,5544,6568,7592,552,1576,2600,3624,4648,5672,6696,7720,680,1704,2728,3752,4776,5800,6824,7848,808,1832,2856,3880,4904,5928,6952,7976,936,1960,2984,4008,5032,6056,7080,8104,80,1104,2128,3152,4176,5200,6224,7248,208,1232,2256,3280,4304,5328,6352,7376,336,1360,2384,3408,4432,5456,6480,7504,464,1488,2512,3536,4560,5584,6608,7632,592,1616,2640,3664,4688,5712,6736,7760,720,1744,2768,3792,4816,5840,6864,7888,848,1872,2896,3920,4944,5968,6992,8016,976,2e3,3024,4048,5072,6096,7120,8144];const a=40,h=280,l=192,c=560,d=384,u=[4278190080,4284489443,4290596448,4294788351,4284523264,4288453788,4294823700,4294951888,4278415968,4282149631,4288453788,4291862783,4282184980,4287487440,4291886962,4294967295],p=15,f=[0,3,12,6,9,p];class g{constructor(t){t?this.bytes=t.bytes.slice():(this.bytes=new Array(7680),this.bytes.fill(0))}copyFrom(t){this.bytes=t.bytes.slice()}}class b{constructor(t){this.useInterlaceLines=!0,this.canvas=t,this.displayScale=2,this.frame=new g,this.indexBufferTV=new Array(215041),this.indexBufferTV.fill(0),this.indexBufferRGB=new Array(215040),this.indexBufferRGB.fill(0);let e=this.canvas.getContext("2d");this.displayData=e.createImageData(c,d),this.displayArray=new Uint32Array(this.displayData.data.buffer)}setFrameMemory(t){let i=0;for(let s=0;s<l;s+=1){for(let o=0;o<a;o+=1)this.frame.bytes[i+o]=t[e.hiresTable[s]+o];i+=a}this.updateIndexBuffer()}updateBuffers(t){t||(t={x:0,y:0,width:c,height:d}),this.updateDisplayBuffer(t),this.updateCanvas()}updateDisplayBuffer(t){let e=t.y*c,i=t.y*c;for(let s=t.y;s<t.y+t.height;s+=1){if(this.useInterlaceLines&&1&s)for(let e=t.x;e<t.x+t.width;e+=1)this.displayArray[i+e]=4278190080;else for(let s=t.x;s<t.x+t.width;s+=1){let t=u[this.indexBufferTV[e+s]];this.displayArray[i+s]=t}e+=c,i+=c}}updateCanvas(){this.canvas.getContext("2d").putImageData(this.displayData,0,0,0,0,this.canvas.width,this.canvas.height)}updateIndexBuffer(){let t=999,e=-1,i=999,s=-1;this.visibleFrame||(this.visibleFrame=new g,t=0,e=191,i=0,s=39);let o=0,n=0,r=0;for(let h=0;h<l;h+=1){let l=!1;for(let t=0;t<a;t+=1)this.visibleFrame.bytes[o+t]!=this.frame.bytes[o+t]&&(this.visibleFrame.bytes[o+t]=this.frame.bytes[o+t],t<i&&(i=t),t>s&&(s=t),l=!0);if(!l){o+=a,n+=1120,r+=1120;continue}h<t&&(t=h),h>e&&(e=h);let d,u=0,g=0,b=this.frame.bytes[o],m=(127&b)<<1;128&b&&(this.indexBufferTV[r]=0,r+=1);let y=p;for(let t=0;t<a;t+=1){g=b;let e=1+(g>>7<<1);b=t<39?this.frame.bytes[o+t+1]:0,m|=(127&b)<<8;for(let t=0;t<7;t+=1){let t,i,s=7&m;2==s?(t=f[e+u],i=d||t):5==s?(t=0,i=f[e+(1^u)]):2&s?(t=p,i=y):(t=0,i=0),y=p,d=void 0,this.indexBufferRGB[n]=t,this.indexBufferRGB[n+1]=t,n+=2,this.indexBufferTV[r]=i,this.indexBufferTV[r+1]=i,r+=2,m>>=1,u^=1}if(128&(g^b))if(128&b){let e=this.indexBufferTV[r-1];64==(224&g)&&128==(192&b)&&(e=0==(1&t)?7:13),this.indexBufferTV[r-2]=e,this.indexBufferTV[r-1]=e,this.indexBufferTV[r]=e,r+=1}else{let e;this.indexBufferTV[r]=0,r-=1;let i=224&g,s=1&b;if(192==i){if(0==s){e=0==(1&t)?2:8,this.indexBufferTV[r-1]=e;continue}if(1==s){e=0==(1&t)?14:11,this.indexBufferTV[r-1]=e,y=e;continue}}else if(224==i){if(0==s){e=0==(1&t)?11:14,this.indexBufferTV[r-3]=e,this.indexBufferTV[r-2]=e,this.indexBufferTV[r-1]=e;continue}}else if(160==i&&1==s){e=0==(1&t)?13:7,this.indexBufferTV[r-3]=e,this.indexBufferTV[r-2]=e,this.indexBufferTV[r-1]=e,d=e;continue}}}for(let t=0;t<c;t+=1)this.indexBufferRGB[n]=this.indexBufferRGB[n-c],n+=1,this.indexBufferTV[r]=this.indexBufferTV[r-c],r+=1;o+=a}if(i<=s&&t<=e){let o={x:7*i*this.displayScale,y:t*this.displayScale,width:7*(s-i+1)*this.displayScale,height:(e-t+1)*this.displayScale};o.x>=7&&(o.x-=7,o.width+=7),o.x+o.width+7<=c&&(o.width+=7),this.updateBuffers(o)}}}e.HiresDisplay=b;const m=[0,42,85,127,128,170,213,255];var y,v,x;function w(t,e){return t.x>=e.x&&t.x<e.x+e.width&&t.y>=e.y&&t.y<e.y+e.height}function S(t){return 0==t.width||0==t.height}function C(t){let e=Object.assign({},t);return e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>h&&(e.width=h-e.x),e.y+e.height>l&&(e.height=l-e.y),e.width<0&&(e.x=0,e.width=0),e.height<0&&(e.y=0,e.height=0),e}!function(t){t[t.COMMAND=1]="COMMAND",t[t.OPTION=2]="OPTION",t[t.CONTROL=4]="CONTROL",t[t.SHIFT=8]="SHIFT"}(y=e.ModifierKeys||(e.ModifierKeys={}));class L{constructor(t){this.leftByte=Math.floor(t.x/7),this.leftMask=(1<<t.x%7)-1^127|128,this.rightByte=Math.floor((t.x+t.width)/7),this.rightMask=(1<<(t.x+t.width)%7)-1|128,128==this.rightMask&&(this.rightMask=255,this.rightByte-=1),this.leftByte==this.rightByte&&(this.leftMask&=this.rightMask)}}!function(t){t[t.Move=0]="Move",t[t.Select=1]="Select",t[t.Pencil=2]="Pencil",t[t.FillRect=3]="FillRect",t[t.FrameRect=4]="FrameRect"}(v=e.Tool||(e.Tool={})),function(t){t[t.None=0]="None",t[t.Tool=1]="Tool",t[t.OverlayMove=2]="OverlayMove",t[t.OverlayResize=3]="OverlayResize"}(x||(x={})),e.ZoomHiresDisplay=class extends b{constructor(t){super(t),this.overlayPosition=3,this.zoomScale=1,this.tool=v.Move,this.savedTool=v.Move,this.mouseMode=x.None,this.pencilColor=0,this.backColor=0,this.foreColor=42,this.undoHistory=[],this.undoIndex=0,this.scrollTimerId=null,this.showGridLines=!0,this.useTransparent=!0,this.totalScale=this.displayScale*this.zoomScale,this.pageSize={width:h*this.totalScale,height:l*this.totalScale},this.windowRect={x:0,y:0,width:this.canvas.width,height:this.canvas.height},this.toolRect={x:0,y:0,width:0,height:0},this.overlayRect={x:0,y:0,width:h,height:l},this.overlayResizeRect={x:0,y:0,width:16,height:16},this.overlayStartRect={x:0,y:0,width:0,height:0},this.updateWindowRect(),this.updateOverlayRect()}setMachine(t,e){this.machine=t,this.pageAddress=e}screenFromCanvasFloat(t){return this.screenFromCanvas(t,0)}screenFromCanvasFloor(t){return this.screenFromCanvas(t,1)}screenFromCanvasRound(t){return this.screenFromCanvas(t,2)}screenFromCanvas(t,e){let i={x:(t.x+this.windowRect.x)/this.totalScale,y:(t.y+this.windowRect.y)/this.totalScale};return 1==e?(i.x=Math.floor(i.x),i.y=Math.floor(i.y)):2==e&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),1==e?(i.x>=h&&(i.x=279),i.y>=l&&(i.y=191)):(i.x>h&&(i.x=h),i.y>l&&(i.y=l)),i.x<0&&(i.x=0),i.y<0&&(i.y=0),i}updateWindowRect(){this.windowRect.width>this.pageSize.width&&(this.windowRect.width=this.pageSize.width),this.windowRect.height>this.pageSize.height&&(this.windowRect.height=this.pageSize.height),this.windowRect.x<0?this.windowRect.x=0:this.windowRect.x+this.windowRect.width>this.pageSize.width&&(this.windowRect.x=this.pageSize.width-this.windowRect.width),this.windowRect.y<0?this.windowRect.y=0:this.windowRect.y+this.windowRect.height>this.pageSize.height&&(this.windowRect.y=this.pageSize.height-this.windowRect.height)}resizeDisplay(t,e){this.canvas.width=t,this.canvas.height=e,this.windowRect.width=this.canvas.width,this.windowRect.height=this.canvas.height,this.updateWindowRect(),this.updateOverlayRect(),this.updateCanvas(),this.mouseMode=x.None}setZoomScale(t,e){let i=e?this.screenFromCanvasFloat(e):{x:0,y:0},s=this.zoomScale;this.zoomScale=t,this.totalScale=this.displayScale*this.zoomScale,this.pageSize={width:h*this.totalScale,height:l*this.totalScale},this.windowRect.x=Math.floor(i.x*this.totalScale-this.canvas.width/2),this.windowRect.y=Math.floor(i.y*this.totalScale-this.canvas.height/2),this.windowRect.width=this.canvas.width,this.windowRect.height=this.canvas.height,this.updateWindowRect(),this.updateOverlayRect(),t!=s?(this.zoomData=void 0,this.zoomArray=void 0,this.updateBuffers()):this.updateCanvas()}scroll(t,e){this.windowRect.x+=t,this.windowRect.y+=e,this.updateWindowRect(),this.updateCanvas()}toggleGrid(){this.showGridLines=!this.showGridLines,this.updateBuffers()}toggleTransparency(){this.useTransparent=!this.useTransparent,this.selectBits&&this.moveSelection()}toggleColor(){let t,e=0,i=this.foreColor;t=0==(127&i)||127==(127&i)?0:127;for(let s=0;s<l;s+=1)for(let s=0;s<a;s+=1)this.frame.bytes[e]^=i,i^=t,e+=1;this.updateToMemory()}setTool(t){t!=this.tool&&(this.selectBits=null,this.clearToolRect(),this.updateCanvas(),null!=this.scrollTimerId&&(clearTimeout(this.scrollTimerId),this.scrollTimerId=null),this.tool=t)}getTool(){return this.tool}setForeColor(t){t<m.length&&(this.foreColor=m[t])}setBackColor(t){t<m.length&&(this.backColor=m[t])}getRgbColorString(t){let e=u[[0,12,3,p,0,9,6,p][t]];return"#"+(((255&e)<<16)+(65280&e)+((16711680&e)>>16)).toString(16).padStart(6,"0")}captureUndo(){let t=new g(this.frame);0!=this.undoIndex&&(this.undoHistory=this.undoHistory.slice(0,this.undoHistory.length-this.undoIndex),this.undoIndex=0),this.undoHistory.length>=100&&(this.undoHistory=this.undoHistory.slice(1)),this.undoHistory.push(t)}undo(){this.undoHistory.length>0&&(0==this.undoIndex&&(this.captureUndo(),this.undoIndex+=1),this.undoIndex<this.undoHistory.length&&(this.undoIndex+=1,this.selectBits=null,this.clearToolRect(),this.frame.copyFrom(this.undoHistory[this.undoHistory.length-this.undoIndex]),this.updateToMemory()))}redo(){this.undoHistory.length>0&&this.undoIndex>0&&(this.undoIndex-=1,this.frame.copyFrom(this.undoHistory[this.undoHistory.length-this.undoIndex]),this.updateToMemory(),1==this.undoIndex&&(this.undoHistory=this.undoHistory.slice(0,this.undoHistory.length-1),this.undoIndex-=1))}toolDown(t,e){if(this.savedTool=this.tool,this.canvasPt=t,this.zoomScale>1&&w(this.canvasPt,this.overlayRect))return this.startPt=this.canvasPt,void(w(this.canvasPt,this.overlayResizeRect)?(this.mouseMode=x.OverlayResize,this.overlayStartRect.x=this.overlayRect.x,this.overlayStartRect.y=this.overlayRect.y,this.overlayStartRect.width=this.overlayRect.width,this.overlayStartRect.height=this.overlayRect.height):this.mouseMode=x.OverlayMove);this.mouseMode=x.Tool,this.tool==v.Select?(this.startPt=this.screenFromCanvasFloor(this.canvasPt),w(this.startPt,this.toolRect)?(this.startPt.x-=this.toolRect.x,this.startPt.y-=this.toolRect.y,this.selectBits?e&y.OPTION&&this.captureUndo():(this.captureUndo(),this.selectBits=this.captureRect(this.toolRect),e&y.OPTION||(this.fillRect(this.toolRect,this.backColor),this.captureUndo())),this.moveSelection(),this.scrollProc(e)):(this.selectBits=null,this.startPt=this.screenFromCanvasFloat(this.canvasPt),this.currPt=this.startPt,this.rebuildSelectRect(),this.updateCanvas(),this.scrollProc(e))):this.tool==v.FillRect||this.tool==v.FrameRect?(this.captureUndo(),this.startPt=this.screenFromCanvasFloat(this.canvasPt),this.currPt=this.startPt,this.rebuildToolRect(),this.moveRectangle(),this.scrollProc(e)):this.tool==v.Pencil&&(this.captureUndo(),this.startPt=this.screenFromCanvasFloor(this.canvasPt),this.pencilColor=this.togglePencilBit(this.startPt)?0:1,this.scrollProc(e),this.toolRect.x=this.startPt.x,this.toolRect.y=this.startPt.y,this.toolRect.width=0,this.toolRect.height=0,this.toolRectChanged())}toolMove(t,e){if(this.canvasPt=t,this.mouseMode==x.OverlayMove)this.moveOverlay();else if(this.mouseMode==x.OverlayResize)this.resizeOverlay();else if(this.mouseMode==x.Tool)if(this.tool==v.Select)if(this.selectBits){this.currPt=this.screenFromCanvasFloor(this.canvasPt);let t=this.toolRect.x%7;this.toolRect.x=this.currPt.x-this.startPt.x,this.toolRect.y=this.currPt.y-this.startPt.y,e&y.SHIFT&&(this.toolRect.x+=t-this.toolRect.x%7),this.toolRectChanged(),this.moveSelection()}else this.currPt=this.screenFromCanvasFloat(this.canvasPt),this.rebuildSelectRect(),this.updateCanvas();else this.tool==v.FillRect||this.tool==v.FrameRect?(this.currPt=this.screenFromCanvasFloat(this.canvasPt),this.rebuildToolRect(),this.moveRectangle()):this.tool==v.Pencil&&this.togglePencilBits()}toolArrow(t,e){this.tool==v.Select&&(this.selectBits?e&y.OPTION&&this.captureUndo():(this.captureUndo(),this.selectBits=this.captureRect(this.toolRect),e&y.OPTION||(this.fillRect(this.toolRect,this.backColor),this.captureUndo())),0==t?this.toolRect.y-=1:1==t?this.toolRect.x+=e&y.SHIFT?7:1:2==t?this.toolRect.y+=1:3==t&&(this.toolRect.x-=e&y.SHIFT?7:1),this.moveSelection())}toolUp(t,e){this.tool==v.Select&&e&y.CONTROL&&this.trimSelection(),null!=this.scrollTimerId&&(clearTimeout(this.scrollTimerId),this.scrollTimerId=null),this.tool=this.savedTool,this.mouseMode=x.None}togglePencilBits(){this.currPt=this.screenFromCanvasFloor(this.canvasPt);let t=this.currPt.x-this.startPt.x,e=this.currPt.y-this.startPt.y,i=Math.max(Math.abs(t),Math.abs(e));if(i>1)for(let s=1;s<i;s+=1){let o={x:Math.floor(this.startPt.x+t*s/i),y:Math.floor(this.startPt.y+e*s/i)};this.togglePencilBit(o,this.pencilColor,!1)}this.togglePencilBit(this.currPt,this.pencilColor),this.startPt=this.currPt,this.toolRect.x=this.startPt.x,this.toolRect.y=this.startPt.y,this.toolRect.width=0,this.toolRect.height=0,this.toolRectChanged()}togglePencilBit(t,e,i=!0){let s=Math.floor(t.x/7),o=1<<t.x%7,n=t.y*a+s,r=this.frame.bytes[n]&o?1:0;return null==e&&(e=1^r),1==e?this.frame.bytes[n]|=o:this.frame.bytes[n]&=~o,128&this.foreColor?this.frame.bytes[n]|=128:this.frame.bytes[n]&=-129,i&&this.updateToMemory(),r}rebuildSelectRect(){this.rebuildToolRect(!0)}rebuildToolRect(t=!1){this.toolRect.x=this.startPt.x,this.toolRect.width=this.currPt.x-this.toolRect.x,this.toolRect.width<0&&(this.toolRect.width=-this.toolRect.width,this.toolRect.x=this.currPt.x),this.toolRect.y=this.startPt.y,this.toolRect.height=this.currPt.y-this.toolRect.y,this.toolRect.height<0&&(this.toolRect.height=-this.toolRect.height,this.toolRect.y=this.currPt.y),this.toolRect.width+=this.toolRect.x,this.toolRect.height+=this.toolRect.y,t?(this.toolRect.x=Math.round(this.toolRect.x),this.toolRect.y=Math.round(this.toolRect.y),this.toolRect.width=Math.round(this.toolRect.width)-this.toolRect.x,this.toolRect.height=Math.round(this.toolRect.height)-this.toolRect.y):(this.toolRect.x=Math.floor(this.toolRect.x),this.toolRect.y=Math.floor(this.toolRect.y),this.toolRect.width=Math.round(this.toolRect.width)-this.toolRect.x,this.toolRect.height=Math.round(this.toolRect.height)-this.toolRect.y),t||(this.toolRect.width<=0&&(this.toolRect.width=1),this.toolRect.height<=0&&(this.toolRect.height=1)),this.toolRectChanged()}scrollProc(t){let e=!1,i=16;if(this.canvasPt.x<=i?(this.windowRect.x-=i,e=!0):this.canvasPt.x>=this.windowRect.width-i&&(this.windowRect.x+=i,e=!0),this.canvasPt.y<=i?(this.windowRect.y-=i,e=!0):this.canvasPt.y>=this.windowRect.height-i&&(this.windowRect.y+=i,e=!0),e)if(this.updateWindowRect(),this.tool==v.Select)if(this.selectBits){this.currPt=this.screenFromCanvasFloor(this.canvasPt);let e=this.toolRect.x%7;this.toolRect.x=this.currPt.x-this.startPt.x,this.toolRect.y=this.currPt.y-this.startPt.y,t&y.SHIFT&&(this.toolRect.x+=e-this.toolRect.x%7),this.toolRectChanged(),this.moveSelection()}else this.currPt=this.screenFromCanvasFloat(this.canvasPt),this.rebuildSelectRect(),this.updateCanvas();else this.tool==v.Pencil?this.togglePencilBits():this.tool!=v.FillRect&&this.tool!=v.FrameRect||(this.currPt=this.screenFromCanvasFloat(this.canvasPt),this.rebuildToolRect(),this.moveRectangle());this.scrollTimerId=setTimeout(function(){this.scrollProc(t)}.bind(this),50)}copySelection(t,e=!1){if(this.tool==v.Select){let i,s;if(this.selectBits)i=this.selectBits,e&&(this.selectBits=null,this.clearToolRect(),this.updateToMemory());else{let t=this.toolRect;S(t)&&(t={x:0,y:0,width:h,height:l}),i=this.captureRect(t),e&&(this.captureUndo(),this.fillRect(t,this.backColor),this.clearToolRect(),this.updateToMemory())}if(t){let t=(0,o.packNaja2)(i);s=(0,r.textFromNaja)(t)}else s=(0,r.textFromPixels)(i);navigator.clipboard.writeText(s).then((()=>{}))}}cutSelection(t){this.copySelection(t,!0)}pasteSelection(t,e){let i=e?this.screenFromCanvasFloat(e):e,s=(0,r.imageFromText)(t);s&&this.pasteImage(s,i)}clearSelection(){this.tool==v.Select&&(S(this.toolRect)||(this.selectBits?(this.selectBits=null,this.clearToolRect(),this.moveSelection()):(this.captureUndo(),this.fillRect(this.toolRect,this.backColor),this.clearToolRect(),this.updateToMemory())))}selectAll(t){this.selectBits&&(this.selectBits=null,this.clearToolRect(),this.moveSelection()),this.setTool(v.Select),this.toolRect={x:0,y:0,width:h,height:l},this.toolRectChanged(),t&&this.trimSelection(),this.updateCanvas()}selectNone(){this.clearToolRect(),this.updateCanvas()}trimSelection(){if(S(this.toolRect)||this.selectBits)return;let t,e=this.backColor;t=0==(127&e)||127==(127&e)?0:127;let i=C(this.toolRect),s=new L(i);1&s.leftByte&&(e^=t);let o=i.y*a;for(;i.height>0;){let n=!0,r=e;if(0!=((this.frame.bytes[o+s.leftByte]^r)&s.leftMask)&&(n=!1),r^=t,n)for(let e=s.leftByte+1;e<=s.rightByte-1;e+=1){if(this.frame.bytes[o+e]!=r){n=!1;break}r^=t}if(n&&s.leftByte!=s.rightByte&&0!=((this.frame.bytes[o+s.rightByte]^r)&s.rightMask)&&(n=!1),!n)break;i.y+=1,i.height-=1,o+=a}for(o=(i.y+i.height-1)*a;i.height>0;){let n=!0,r=e;if(0!=((this.frame.bytes[o+s.leftByte]^r)&s.leftMask)&&(n=!1),r^=t,n)for(let e=s.leftByte+1;e<=s.rightByte-1;e+=1){if(this.frame.bytes[o+e]!=r){n=!1;break}r^=t}if(n&&s.leftByte!=s.rightByte&&0!=((this.frame.bytes[o+s.rightByte]^r)&s.rightMask)&&(n=!1),!n)break;i.height-=1,o-=a}if(255!=s.leftMask){let o=!0,n=i.y*a+s.leftByte;for(let t=0;t<i.height;t+=1){if(0!=((this.frame.bytes[n]^e)&s.leftMask)){o=!1;break}n+=a}if(o){s.leftByte+=1,s.leftMask=255,e^=t;let o=7-i.x%7;i.x+=o,i.width-=o}}if(255==s.leftMask)for(;s.leftByte<=s.rightByte;){let o=!0,n=i.y*a+s.leftByte;for(let t=0;t<i.height;t+=1){if(this.frame.bytes[n]!=e){o=!1;break}n+=a}if(!o)break;s.leftByte+=1,i.x+=7,i.width-=7,e^=t}let n=e;if(1&(s.leftByte^s.rightByte)&&(n^=t),255!=s.rightMask&&s.leftByte<=s.rightByte){let o=!0,r=i.y*a+s.rightByte;for(let t=0;t<i.height;t+=1){if(0!=((this.frame.bytes[r]^n)&s.rightMask)){o=!1;break}r+=a}if(o){s.rightByte-=1,s.rightMask=255,e^=t;let o=(i.x+i.width)%7;i.width-=o}}if(255==s.rightMask)for(;s.leftByte<=s.rightByte;){let e=!0,o=i.y*a+s.rightByte;for(let t=0;t<i.height;t+=1){if(this.frame.bytes[o]!=n){e=!1;break}o+=a}if(!e)break;s.rightByte-=1,n^=t,i.width-=7}this.toolRect=i,this.toolRectChanged(),this.updateCanvas()}moveSelection(){this.frame.copyFrom(this.undoHistory[this.undoHistory.length-this.undoIndex-1]),this.selectBits&&this.drawImage(this.selectBits,this.toolRect),this.updateToMemory()}clearToolRect(){this.toolRect={x:0,y:0,width:0,height:0},this.toolRectChanged()}toolRectChanged(){this.onToolRectChanged&&this.onToolRectChanged(this.toolRect)}pasteImage(t,e){let i,s,o={x:Math.floor(this.windowRect.x/this.totalScale),y:Math.floor(this.windowRect.y/this.totalScale),width:Math.ceil((this.windowRect.x+this.windowRect.width)/this.totalScale),height:Math.ceil((this.windowRect.y+this.windowRect.height)/this.totalScale)};o.width-=o.x,o.height-=o.y,this.setTool(v.Select),this.captureUndo(),this.selectBits=t,e&&w(e,o)?(i=Math.floor(e.x-t.bounds.width/2),s=Math.floor(e.y-t.bounds.height/2)):w(t.bounds,o)?(i=t.bounds.x,s=t.bounds.y):(i=Math.floor((o.x-t.bounds.width)/2),s=Math.floor((o.y-t.bounds.height)/2)),i<o.x&&(i=o.x),s<o.y&&(s=o.y),i+=3,i=i-i%7+t.bounds.x%7,i<o.x&&(i+=7),this.toolRect.x=i,this.toolRect.y=s,this.toolRect.width=t.bounds.width,this.toolRect.height=t.bounds.height,this.toolRectChanged(),this.moveSelection()}moveRectangle(){if(this.frame.copyFrom(this.undoHistory[this.undoHistory.length-this.undoIndex-1]),this.tool==v.FillRect||this.toolRect.width<4||this.toolRect.height<2)this.fillRect(this.toolRect,this.foreColor);else{let t={x:this.toolRect.x,y:this.toolRect.y,width:this.toolRect.width,height:1};this.fillRect(t,this.foreColor),t.y=this.toolRect.y+this.toolRect.height-1,this.fillRect(t,this.foreColor),t.y=this.toolRect.y,t.width=2,t.height=this.toolRect.height,this.fillRect(t,this.foreColor),t.x=this.toolRect.x+this.toolRect.width-2,this.fillRect(t,this.foreColor)}this.updateToMemory()}fillRect(t,e){let i=C(t);if(S(i))return;let s,o=new L(i);s=0==(127&e)||127==(127&e)?0:127,1&o.leftByte&&(e^=s);let n=i.y*a;for(let t=0;t<i.height;t+=1){let t=e,i=this.frame.bytes[n+o.leftByte];this.frame.bytes[n+o.leftByte]=(i^t)&o.leftMask^i,t^=s;for(let e=o.leftByte+1;e<o.rightByte;e+=1)this.frame.bytes[n+e]=t,t^=s;o.leftByte<o.rightByte&&(i=this.frame.bytes[n+o.rightByte],this.frame.bytes[n+o.rightByte]=(i^t)&o.rightMask^i),n+=a}}drawImage(t,e){var i,s;let o=Math.floor((t.bounds.x+t.bounds.width+6)/7)-Math.floor(t.bounds.x/7),n={x:e.x,y:e.y,width:t.bounds.width,height:t.bounds.height},r=C(n),h=new L(r),l=(r.y-n.y)*o+(h.leftByte-Math.floor(n.x/7)),c=0,d=n.x%7-t.bounds.x%7;d<0&&(c=-d,d=0);let u=r.y*a;for(let e=0;e<r.height;e+=1){for(let e=0;e<h.rightByte-h.leftByte+1;e+=1){let o,n=t.dataBytes[l+e];d>0?(n=n<<d&127|128&n,n|=(127&(null!==(i=t.dataBytes[l+e-1])&&void 0!==i?i:0))>>7-d):c>0&&(n=(127&n)>>c|128&n,n|=(null!==(s=t.dataBytes[l+e+1])&&void 0!==s?s:0)<<7-c&127),0==e?0==n&&this.useTransparent||(o=this.frame.bytes[u+h.leftByte],this.frame.bytes[u+h.leftByte]=(o^n)&h.leftMask^o):e<h.rightByte-h.leftByte?0==n&&this.useTransparent||(this.frame.bytes[u+h.leftByte+e]=n):h.leftByte<h.rightByte&&(0==n&&this.useTransparent||(o=this.frame.bytes[u+h.rightByte],this.frame.bytes[u+h.rightByte]=(o^n)&h.rightMask^o))}l+=o,u+=a}}captureRect(t){let e=C(t),i=new L(e),s=new n.PixelData;s.dataBytes=[],s.bounds=Object.assign({},e);let o=e.y*a;for(let t=0;t<e.height;t+=1){for(let t=i.leftByte;t<=i.rightByte;t+=1){let e=this.frame.bytes[o+t];t==i.leftByte&&(e&=i.leftMask),t==i.rightByte&&(e&=i.rightMask),s.dataBytes.push(e)}o+=a}return s}updateOverlayRect(){this.overlayRect.x=0,this.overlayRect.y=0,this.zoomScale>1&&(1&this.overlayPosition?(this.overlayRect.x=this.canvas.width-this.overlayRect.width,this.overlayResizeRect.x=this.overlayRect.x):this.overlayResizeRect.x=this.overlayRect.width-this.overlayResizeRect.width,2&this.overlayPosition?(this.overlayRect.y=this.canvas.height-this.overlayRect.height,this.overlayResizeRect.y=this.overlayRect.y):this.overlayResizeRect.y=this.overlayRect.height-this.overlayResizeRect.height)}moveOverlay(){let t=!1,e=this.canvasPt.x-this.startPt.x,i=this.canvasPt.y-this.startPt.y;Math.abs(e)>32&&(e<0?1&this.overlayPosition&&(this.overlayPosition&=-2,t=!0):1&this.overlayPosition||(this.overlayPosition|=1,t=!0)),Math.abs(i)>32&&(i<0?2&this.overlayPosition&&(this.overlayPosition&=-3,t=!0):2&this.overlayPosition||(this.overlayPosition|=2,t=!0)),t&&(this.updateOverlayRect(),this.updateCanvas())}resizeOverlay(){let t=Math.floor(this.canvasPt.x-this.startPt.x),e=Math.floor(this.canvasPt.y-this.startPt.y);1&this.overlayPosition?(this.overlayRect.x=this.overlayStartRect.x+t,this.overlayRect.width=this.overlayStartRect.width-t):this.overlayRect.width=this.overlayStartRect.width+t,this.overlayRect.width<140?(this.overlayRect.width=140,1&this.overlayPosition&&(this.overlayRect.x=this.overlayStartRect.x+this.overlayStartRect.width-this.overlayRect.width)):this.overlayRect.width>c&&(this.overlayRect.width=c,1&this.overlayPosition&&(this.overlayRect.x=this.overlayStartRect.x+this.overlayStartRect.width-this.overlayRect.width)),2&this.overlayPosition?(this.overlayRect.y=this.overlayStartRect.y+e,this.overlayRect.height=this.overlayStartRect.height-e):this.overlayRect.height=this.overlayStartRect.height+e,this.overlayRect.height<96?(this.overlayRect.height=96,2&this.overlayPosition&&(this.overlayRect.y=this.overlayStartRect.y+this.overlayStartRect.height-this.overlayRect.height)):this.overlayRect.height>d&&(this.overlayRect.height=d,2&this.overlayPosition&&(this.overlayRect.y=this.overlayStartRect.y+this.overlayStartRect.height-this.overlayRect.height)),1&this.overlayPosition?this.overlayResizeRect.x=this.overlayRect.x:this.overlayResizeRect.x=this.overlayRect.width-this.overlayResizeRect.width,2&this.overlayPosition?this.overlayResizeRect.y=this.overlayRect.y:this.overlayResizeRect.y=this.overlayRect.height-this.overlayResizeRect.height,this.updateCanvas()}updateFromMemory(){if(this.machine){let t=0;for(let i=0;i<l;i+=1){let o=this.pageAddress+e.hiresTable[i];for(let e=0;e<a;e+=1){let i=s.machine.readConst(o+e);this.frame.bytes[t+e]=i}t+=a}this.updateIndexBuffer()}}updateToMemory(){if(this.machine){let t=0;for(let i=0;i<l;i+=1){let s=this.pageAddress+e.hiresTable[i];for(let e=0;e<a;e+=1)this.machine.write(s+e,this.frame.bytes[t+e]);t+=a}this.updateIndexBuffer()}}updateBuffers(t){if(t||(t={x:0,y:0,width:c,height:d}),!this.zoomData&&this.zoomScale>1){let t=this.canvas.getContext("2d");this.zoomData=t.createImageData(c*this.zoomScale,d*this.zoomScale),this.zoomArray=new Uint32Array(this.zoomData.data.buffer)}this.updateDisplayBuffer(t),this.zoomArray&&this.updateZoomBuffer(t),this.updateCanvas()}updateZoomBuffer(t){let e=0,i=0,s=!this.showGridLines,o=c*this.zoomScale;for(let n=0;n<d;n+=1){if(n<t.y||n>=t.y+t.height){e+=c,i+=o*this.zoomScale;continue}for(let o=t.x;o<t.x+t.width;o+=1){let t=s?this.indexBufferTV[e+o]:this.indexBufferRGB[e+o],n=u[t];for(let t=0;t<this.zoomScale;t+=1)this.zoomArray[i+o*this.zoomScale+t]=n}e+=c,i+=o;let r=this.zoomScale-1,a=!1;if(this.showGridLines&&(n+1)%this.displayScale==0&&(a=(n+1)%this.displayScale==0,r-=1,r<0&&(i-=o)),r>0){let t=i-o;for(let e=0;e<r;e+=1){for(let e=0;e<o;e+=1)this.zoomArray[i+e]=this.zoomArray[t+e];i+=o}}if(a){for(let t=0;t<o;t+=1)this.zoomArray[i+t]=4278190080;i+=o}}if(this.showGridLines){let t=0;for(let e=0;e<h;e+=1){let s=0==t?4278222592:4278190080;(t-=1)<0&&(t=6),i=0;for(let t=0;t<d*this.zoomScale;t+=1)this.zoomArray[i+e*this.totalScale]=s,i+=o}}}updateCanvas(){let t=this.canvas.getContext("2d");if(t.fillStyle="#444",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.putImageData(1==this.zoomScale?this.displayData:this.zoomData,-this.windowRect.x,-this.windowRect.y,this.windowRect.x,this.windowRect.y,this.windowRect.width,this.windowRect.height),this.tool!=v.Select||S(this.toolRect)||(t.strokeStyle="red",t.setLineDash([5,3]),t.beginPath(),t.strokeRect(this.toolRect.x*this.totalScale-this.windowRect.x+.5,this.toolRect.y*this.totalScale-this.windowRect.y+.5,this.toolRect.width*this.totalScale-1,this.toolRect.height*this.totalScale-1),t.setLineDash([])),this.zoomScale>1){let e=Math.floor(this.windowRect.x/this.zoomScale);e+this.overlayRect.width>c&&(e=c-this.overlayRect.width);let i=Math.floor(this.windowRect.y/this.zoomScale);i+this.overlayRect.height>d&&(i=d-this.overlayRect.height),t.putImageData(this.displayData,this.overlayRect.x-e,this.overlayRect.y-i,e,i,this.overlayRect.width,this.overlayRect.height),t.strokeStyle="white",t.beginPath(),t.strokeRect(this.overlayRect.x-.5,this.overlayRect.y-.5,this.overlayRect.width+1,this.overlayRect.height+1),this.tool!=v.Select||S(this.toolRect)||(t.save(),t.rect(this.overlayRect.x,this.overlayRect.y,this.overlayRect.width,this.overlayRect.height),t.clip(),t.strokeStyle="red",t.setLineDash([5,3]),t.beginPath(),t.strokeRect(this.overlayRect.x+this.toolRect.x*this.displayScale-e+.5,this.overlayRect.y+this.toolRect.y*this.displayScale-i+.5,this.toolRect.width*this.displayScale-1,this.toolRect.height*this.displayScale-1),t.restore())}}}},2439:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DisplayView=void 0;const s=i(9273),o=i(4596),n=i(5088);var r;!function(t){t[t.ACTIVE=0]="ACTIVE",t[t.VISIBLE=1]="VISIBLE",t[t.PRIMARY=2]="PRIMARY",t[t.SECONDARY=3]="SECONDARY"}(r||(r={})),e.DisplayView=class{constructor(t,e){this.hasFocus=!1,this.isEditing=!1,this.leftButtonIsDown=!1,this.rightButtonIsDown=!1,this.editTool=o.Tool.Move,this.displayGrid=t,this.machine=e,this.displaySource=r.ACTIVE,this.displayDiv=this.displayGrid.querySelector("#display-div"),this.hiresCanvas=this.displayDiv.querySelector("#hires-canvas"),this.hiresDisplay=new o.ZoomHiresDisplay(this.hiresCanvas),(0,n.default)("#screen-edit",{content:"Edit Screen (⌘E)"}),this.hiresDisplay.onToolRectChanged=t=>{this.onToolRectChanged(t)},this.toolPalette=this.displayGrid.querySelector("#tool-palette"),this.colorPalette=this.displayGrid.querySelector("#color-palette"),this.xyPalette=this.displayGrid.querySelector("#xy-palette");let i=this.getPageAddress();this.hiresDisplay.setMachine(e,i),document.oncut=t=>{if(document.activeElement){let e=document.activeElement;e&&e.oncut&&e.oncut(t)}},document.oncopy=t=>{if(document.activeElement){let e=document.activeElement;e&&e.oncopy&&e.oncopy(t)}},document.onpaste=t=>{if(document.activeElement){let e=document.activeElement;e&&e.onpaste&&e.onpaste(t)}},document.addEventListener("keydown",(t=>{"F5"!=t.key||t.shiftKey||t.ctrlKey||this.hiresCanvas.focus()})),this.displayGrid.querySelector("#screen-edit").onclick=t=>{t.preventDefault(),this.toggleEditMode(),this.hiresCanvas.focus()},this.hiresCanvas.oncut=t=>{this.hiresDisplay.cutSelection(!1)},this.hiresCanvas.oncopy=t=>{this.hiresDisplay.copySelection(!1)},this.hiresCanvas.onpaste=t=>{navigator.clipboard.readText().then((t=>{this.isEditing&&this.hiresDisplay.pasteSelection(t,this.mousePt)}))},this.hiresCanvas.onkeydown=t=>{this.isEditing||"Meta"==t.key&&("MetaLeft"==t.code?this.joystick.button0=!0:"MetaRight"==t.code&&(this.joystick.button1=!0),this.updateJoystick());let e=t.key.toLowerCase();if(t.metaKey&&"e"==e)return this.toggleEditMode(),void t.preventDefault();if(!this.isEditing&&"F"==t.key[0]&&t.key.length>1)return;if(!this.isEditing){let e=0;if(!t.ctrlKey){let i="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_".indexOf(t.key);if(i>=0)e=64+i;else{let i="`abcdefghijklmnopqrstuvwxyz{|}~".indexOf(t.key);if(i>=0)e=64+i;else{let i=" !\"#$%&'()*+,-./0123456789:;<=>?".indexOf(t.key);i>=0&&(e=32+i)}}}if(0==e){let i=t.which;if(i<128){if(t.ctrlKey)i>=97&&i<=122&&(i-=32),i>=64&&i<96&&(i-=64);else switch(i){case 37:i=8;break;case 38:i=11;break;case 39:i=21;break;case 40:i=10}"Meta"!=t.key&&(e=i)}}return void(e&&(this.machine.setKeyCode(e),t.preventDefault(),t.stopPropagation()))}let i=-1;if("ArrowUp"==t.key?i=0:"ArrowRight"==t.key?i=1:"ArrowDown"==t.key?i=2:"ArrowLeft"==t.key&&(i=3),i>=0)return void this.hiresDisplay.toolArrow(i,this.getModifierKeys(t));if(t.metaKey)return void("x"==e?(this.hiresDisplay.cutSelection(t.shiftKey),t.preventDefault()):"c"==e?(this.hiresDisplay.copySelection(t.shiftKey),t.preventDefault()):"v"==e?(navigator.clipboard.readText().then((t=>{this.isEditing&&this.hiresDisplay.pasteSelection(t,this.mousePt)})),t.preventDefault()):"a"===e?(this.hiresDisplay.selectAll(t.ctrlKey),t.preventDefault()):"z"===e&&(t.shiftKey?this.hiresDisplay.redo():this.hiresDisplay.undo(),t.preventDefault()));if(("c"===e||"b"===e)&&""==this.lastKey)return void(this.lastKey=e);if("c"===this.lastKey||"b"===this.lastKey){if("x"==e)return this.setForeColor(4^this.foreColorIndex),void(this.lastKey="");let t="bgvwaoui".search(e);if(-1!=t)return"c"==this.lastKey?this.setForeColor(t):this.setBackColor(t),void(this.lastKey="")}let s=parseInt(e);if(s>=0&&s<=9)return"c"==this.lastKey?this.setForeColor(s):"b"==this.lastKey?this.setBackColor(s):this.hiresDisplay.setZoomScale(1<<s-1,this.mousePt),void(this.lastKey="");"backspace"==e?this.hiresDisplay.clearSelection():"s"==e?this.setTool(o.Tool.Select):"p"==e?this.setTool(o.Tool.Pencil):"r"==e?this.setTool(o.Tool.FillRect):"f"==e?this.setTool(o.Tool.FrameRect):"g"==e?this.hiresDisplay.toggleGrid():"t"==e?this.hiresDisplay.toggleTransparency():"x"==e&&this.hiresDisplay.toggleColor(),this.lastKey=""},this.hiresCanvas.onkeyup=t=>{this.isEditing||"Meta"==t.key&&("MetaLeft"==t.code?this.joystick.button0=!1:"MetaRight"==t.code&&(this.joystick.button1=!1),this.mousePt&&this.updateJoystick())},this.hiresCanvas.onwheel=t=>{this.hiresDisplay.scroll(t.deltaX,t.deltaY),t.preventDefault()},this.hiresCanvas.onfocus=t=>{this.hasFocus=!0,this.isEditing||(this.hiresCanvas.style.cursor="none")},this.hiresCanvas.onblur=t=>{this.hasFocus=!1,this.isEditing||(this.hiresCanvas.style.cursor="default")},this.hiresCanvas.onpointerenter=t=>{this.mousePt=this.canvasFromClient(t),this.lastMousePt=this.mousePt,!this.isEditing&&this.hasFocus&&this.resetJoystick()},this.hiresCanvas.onpointerdown=t=>{if(this.lastMousePt=this.mousePt,this.mousePt=this.canvasFromClient(t),!this.hasFocus)return this.focusClick=!0,void(this.isEditing||this.resetJoystick());this.focusClick=!1,1==t.which?(this.hiresCanvas.setPointerCapture(t.pointerId),this.leftButtonIsDown=!0,this.joystick.button0=!0,this.isEditing&&this.hiresDisplay.toolDown(this.mousePt,this.getModifierKeys(t))):3==t.which&&(this.rightButtonIsDown=!0,this.joystick.button1=!0),this.isEditing||this.updateJoystick()},this.hiresCanvas.oncontextmenu=t=>!1,this.hiresCanvas.onpointermove=t=>{let e=this.canvasFromClient(t);e.x>=0&&e.y>=0&&(this.lastMousePt=this.mousePt,this.mousePt=e,this.isEditing?this.leftButtonIsDown&&this.hiresDisplay.toolMove(this.mousePt,this.getModifierKeys(t)):this.hasFocus&&this.updateJoystick())},this.hiresCanvas.onpointerup=t=>{this.focusClick||(this.lastMousePt=this.mousePt,this.mousePt=this.canvasFromClient(t),1==t.which?(this.hiresCanvas.releasePointerCapture(t.pointerId),this.leftButtonIsDown=!1,this.joystick.button0=!1,this.isEditing&&this.hiresDisplay.toolUp(this.mousePt,this.getModifierKeys(t))):3==t.which&&(this.rightButtonIsDown=!1,this.joystick.button1=!1),!this.isEditing&&this.hasFocus&&this.updateJoystick())},this.hiresCanvas.onpointerleave=t=>{this.leftButtonIsDown=!1,this.rightButtonIsDown=!1,this.joystick.button0=!1,this.joystick.button1=!1,this.isEditing?(this.mousePt=void 0,this.lastMousePt=void 0):this.hasFocus&&this.updateJoystick()};for(let t=0;t<4;t+=1)this.displayDiv.querySelector("#li"+t).onclick=()=>{this.onclickDisplaySource(t)};for(let t=0;t<8;t+=1){let e=this.toolPalette.querySelector("#tool"+t);if(null==e)break;e.onmousedown=e=>{e.preventDefault(),this.setTool(t),this.hiresCanvas.focus()}}for(let t=0;t<8;t+=1){let e=this.colorPalette.querySelector("#clr"+t);if(null==e)break;e.style.backgroundColor=this.hiresDisplay.getRgbColorString(t),e.onmousedown=e=>{e.preventDefault(),this.setForeColor(t),this.hiresCanvas.focus()}}this.colorPalette.onmousedown=t=>{t.preventDefault()},this.joystick={x0:0,y0:0,button0:!1,button1:!1},this.setForeColor(1)}canvasFromClient(t){let e=t.target.getBoundingClientRect();return{x:t.clientX-e.left-0-4,y:t.clientY-e.top-0-4}}getModifierKeys(t){let e=0;return t.metaKey&&(e|=o.ModifierKeys.COMMAND),t.altKey&&(e|=o.ModifierKeys.OPTION),t.ctrlKey&&(e|=o.ModifierKeys.CONTROL),t.shiftKey&&(e|=o.ModifierKeys.SHIFT),e}loadSettings(t){this.projectName=t;let e=this.projectName+"/display",i=localStorage.getItem(e);if(i){let t=JSON.parse(i);this.onclickDisplaySource(t.source)}}resetJoystick(){this.joystick.x0=this.mousePt.x<280?0:255,this.joystick.y0=this.mousePt.y<192?0:255,this.joystick.button0=!1,this.joystick.button1=!1}updateJoystick(){this.mousePt&&(this.joystick.x0+=this.mousePt.x-this.lastMousePt.x,this.joystick.x0<0?this.joystick.x0=0:this.joystick.x0>255&&(this.joystick.x0=255),this.joystick.y0+=this.mousePt.y-this.lastMousePt.y,this.joystick.y0<0?this.joystick.y0=0:this.joystick.y0>255&&(this.joystick.y0=255),null===s.machine||void 0===s.machine||s.machine.setJoystickValues(this.joystick))}onResize(t,e){this.hiresDisplay.resizeDisplay(t,e)}onclickDisplaySource(t){for(let e=0;e<4;e+=1)this.displayDiv.querySelector("#li"+e).className=e==t?"active":"";if(this.displaySource=t,this.projectName){let t=this.projectName+"/display",e={source:this.displaySource},i=JSON.stringify(e);localStorage.setItem(t,i)}this.updateDisplay(s.dbug.isRunning),this.hiresCanvas.focus()}setTool(t){for(let e=0;e<8;e+=1){let i=this.toolPalette.querySelector("#tool"+e);if(null==i)break;i.className="tool-btn"+(e==t?" active":"")}this.hiresDisplay.setTool(t),t==o.Tool.Select?this.hiresCanvas.style.cursor="crosshair":this.hiresCanvas.style.cursor="default"}getTool(){return this.hiresDisplay.getTool()}setForeColor(t){for(let e=0;e<8;e+=1){let i=this.colorPalette.querySelector("#clr"+e);if(null==i)break;i.className="color-btn"+(e==t?" active":"")}this.hiresDisplay.setForeColor(t),this.foreColorIndex=t}setBackColor(t){this.hiresDisplay.setBackColor(t)}toggleEditMode(){this.isEditing=!this.isEditing,this.isEditing&&(s.dbug.onStopCpu(),this.hiresCanvas.focus());let t=this.displayGrid.querySelector("#screen-div");this.isEditing?(null==this.startWidth&&(this.startWidth=t.clientWidth,this.startHeight=t.clientHeight),null==this.editWidth&&(this.editWidth=t.clientWidth,this.editHeight=t.clientHeight)):(this.editWidth=t.clientWidth,this.editHeight=t.clientHeight),t.style.width=(this.isEditing?this.editWidth:this.startWidth)+"px",t.style.height=(this.isEditing?this.editHeight:this.startHeight)+"px",t.style.resize=this.isEditing?"both":"none",this.displayGrid.className=this.isEditing?"editing":"",this.toolPalette.className=this.isEditing?"visible":"",this.colorPalette.className=this.isEditing?"visible":"",this.xyPalette.className=this.isEditing?"visible":"",this.isEditing?this.setTool(this.editTool):(this.editTool=this.getTool(),this.hasFocus&&(this.hiresCanvas.style.cursor="none"),this.hiresDisplay.resizeDisplay(560,384),this.hiresDisplay.setZoomScale(1,this.mousePt),this.hiresDisplay.selectNone())}getPageAddress(){return this.displaySource==r.PRIMARY?8192:this.displaySource==r.SECONDARY?16384:this.displaySource==r.VISIBLE?0==this.machine.getDisplayPage()?8192:16384:this.displaySource==r.ACTIVE?0==this.machine.getActiveDisplayPage()?8192:16384:void 0}updateDisplay(t){let e=this.getPageAddress();for(let t=0;t<2;t+=1){let e=this.displayDiv.querySelector("#li"+t).children[0],i=e.innerHTML;if(i.endsWith(")")&&(i=i.substring(0,i.length-3)),0==t){let t=this.machine.getActiveDisplayPage();e.innerHTML=i+`(${1+t})`}else{let t=this.machine.getDisplayPage();e.innerHTML=i+`(${1+t})`}}this.hiresDisplay.setMachine(this.machine,e),this.hiresDisplay.updateFromMemory()}onToolRectChanged(t){let e=t.x,i=t.y,s=`PictMoveTo ${e};${i}`;if(0!=t.width||0!=t.height){let o=t.x+t.width,n=t.y+t.height;s+="<br>",s+=`PictRect ${e.toString()};${i.toString()};${(o-1).toString()};${(n-1).toString()}`,e=Math.floor(e/7),o=Math.floor((o+6)/7),s+="<br>",s+=`PictClear ${e.toString()};${i.toString()};${o.toString()};${n.toString()}`}s+="<br>",s+=`address: $${(this.getPageAddress()+o.hiresTable[i]+e).toString(16)}`,s+="<br>",this.xyPalette.innerHTML=s}}},6767:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.imageFromText=e.textFromNaja=e.textFromPixels=void 0;const s=i(6419),o=i(8887);e.textFromPixels=function(t){let e="",i="                ",s=Math.floor((t.bounds.x+t.bounds.width+6)/7)-Math.floor(t.bounds.x/7);if(e+=i,e+=`;{x:${t.bounds.x}`,e+=`,y:${t.bounds.y}`,e+=`,w:${t.bounds.width}`,e+=`,h:${t.bounds.height}}\n`,1==s)for(let s=0;s<t.dataBytes.length;s+=1)e+=i+"DB  %"+t.dataBytes[s].toString(2).padStart(8,"0")+"\n";else{let o=0;for(let n=0;n<t.dataBytes.length;n+=1)0==o&&(e+=i+"HEX "),e+=t.dataBytes[n].toString(16).toUpperCase().padStart(2,"0"),++o==s&&(e+="\n",o=0);0!=o&&(e+="\n")}return e},e.textFromNaja=function(t){let e="                ",i=e+"DB  $"+t[0].toString(16).toUpperCase().padStart(2,"0")+",$"+t[1].toString(16).toUpperCase().padStart(2,"0")+",$"+t[2].toString(16).toUpperCase().padStart(2,"0")+",$"+t[3].toString(16).toUpperCase().padStart(2,"0")+"\n",s=0;for(let o=4;o<t.length;o+=1)0==s&&(i+=e+"HEX "),i+=t[o].toString(16).toUpperCase().padStart(2,"0"),24==++s&&(i+="\n",s=0);return 0!=s&&(i+="\n"),i},e.imageFromText=function(t){let e=t.split(/\r?\n/),i=(new o.SourceDocBuilder).buildRawDoc(e),n=[],r=0;i.sourceLines.forEach((t=>{let e=t.opcode.toUpperCase();if("HEX"==e){let e=t.args,i=0;for(let t=0;t<e.length;t+=2){let s=e.substring(t,t+2),o=parseInt(s,16);n.push(o),i+=1}0==r&&(r=i)}else if("DFB"==e||"DC.B"==e||"DB"==e){let e,i=t.args,s=0;for(;i.length>0;){let t=i.indexOf(",");-1!=t?(e=i.substring(0,t),i=i.substring(t+1)):(e=i,i="");let o=10;"$"==e[0]?(e=e.substring(1),o=16):"%"==e[0]&&(e=e.substring(1),o=2);let r=parseInt(e,o);n.push(r),s+=1}0==r&&(r=s)}}));let a=(0,s.unpackNaja1)(n);if(a)return a;if(a=(0,s.unpackNaja2)(n),a)return a;let h=new s.PixelData;if(h.bounds.x=0,h.bounds.y=0,h.bounds.width=n.length,h.bounds.height=1,r>0){let t=n.length/r;t==Math.floor(t)&&(h.bounds.width=7*r,h.bounds.height=t)}return h.dataBytes=n,h}},2174:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Isa6502=void 0;class i{static getRegIndex(t,e){switch(i.ops[e.objBuffer[e.objOffset+0]].ad){case"zpx":case"abx":return t.getX();case"zpy":case"aby":case"iny":return t.getY()}}static computeAddress(t,e,s=!0){let o=e.objBuffer[e.objOffset+0],n=e.objLength>=1?e.objBuffer[e.objOffset+1]:0,r=e.objLength>=2?e.objBuffer[e.objOffset+2]:0,a=i.ops[o].ad,h=-1,l=0;switch(a){case"zp":h=n,l=2;break;case"zpx":h=n,s&&(h=h+t.getX()&255),l=2;break;case"zpy":h=n,s&&(h=h+t.getY()&255),l=2;break;case"jab":case"jsr":case"abs":h=n+(r<<8),l=4;break;case"abx":h=n+(r<<8),s&&(h=h+t.getX()&65535),l=4;break;case"aby":h=n+(r<<8),s&&(h=h+t.getY()&65535),l=4;break;case"inx":let e=n+t.getX();h=t.readConst(255&e)+(t.readConst(e+1&255)<<8),l=4;break;case"iny":h=t.readConst(n)+(t.readConst(n+1&255)<<8),s&&(h=h+t.getY()&65535),l=4}return{type:a,address:h,size:l}}static DisassembleArgs(t,e,s){let o="",n=t[e+0],r=i.ops[n].ad;if(r.startsWith("ab")||"jsr"==r||"jab"==r)o="$"+(t[e+1]+256*t[e+2]).toString(16).padStart(4,"0"),"abx"==r?o+=",x":"aby"==r&&(o+=",y");else if("rel"==r){let i=t[e+1];i>=128&&(i=-(1+(255^i))),i+=s+2,o="$"+i.toString(16).padStart(4,"0")}else""!=r&&(2==i.ops[n].bc&&(o="$"+t[e+1].toString(16).padStart(2,"0")),"imm"==r?o="#"+o:"zpx"==r?o+=",x":"zpy"==r?o+=",y":"iny"==r?o="("+o+"),y":"inx"==r&&(o="("+o+",x)"));return o}static isFlowControl(t){return 1==i.ops[t].fc}static isIllegal(t){return"???"==i.ops[t].op}static isBranch(t){return"rel"==i.ops[t].ad}static isCall(t){return 32==t}static isReturn(t){return 96==t||64==t}static isJump(t){return 76==t||108==t}}e.Isa6502=i,i.ops=[{op:"brk",ad:"",bc:1,fc:!0},{op:"ora",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ora",ad:"zp",bc:2},{op:"asl",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"php",ad:"",bc:1},{op:"ora",ad:"imm",bc:2},{op:"asl",ad:"a",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ora",ad:"abs",bc:3},{op:"asl",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bpl",ad:"rel",bc:2,fc:!0},{op:"ora",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ora",ad:"zpx",bc:2},{op:"asl",ad:"zpx",bc:2},{op:"???",ad:"",bc:1},{op:"clc",ad:"",bc:1},{op:"ora",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ora",ad:"abx",bc:3},{op:"asl",ad:"abx",bc:3},{op:"???",ad:"",bc:1},{op:"jsr",ad:"jsr",bc:3,fc:!0},{op:"and",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"bit",ad:"zp",bc:2},{op:"and",ad:"zp",bc:2},{op:"rol",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"plp",ad:"",bc:1},{op:"and",ad:"imm",bc:2},{op:"rol",ad:"a",bc:1},{op:"???",ad:"",bc:1},{op:"bit",ad:"abs",bc:3},{op:"and",ad:"abs",bc:3},{op:"rol",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bmi",ad:"rel",bc:2,fc:!0},{op:"and",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"and",ad:"zpx",bc:2},{op:"rol",ad:"zpx",bc:2},{op:"???",ad:"",bc:1},{op:"sec",ad:"",bc:1},{op:"and",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"and",ad:"abx",bc:3},{op:"rol",ad:"abx",bc:3},{op:"???",ad:"",bc:1},{op:"rti",ad:"",bc:1,fc:!0},{op:"eor",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"eor",ad:"zp",bc:2},{op:"lsr",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"pha",ad:"",bc:1},{op:"eor",ad:"imm",bc:2},{op:"lsr",ad:"a",bc:1},{op:"???",ad:"",bc:1},{op:"jmp",ad:"jab",bc:3,fc:!0},{op:"eor",ad:"abs",bc:3},{op:"lsr",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bvc",ad:"rel",bc:2,fc:!0},{op:"eor",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"eor",ad:"zpx",bc:2},{op:"lsr",ad:"zpx",bc:2},{op:"???",ad:"",bc:1},{op:"cli",ad:"",bc:1},{op:"eor",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"eor",ad:"abx",bc:3},{op:"lsr",ad:"abx",bc:3},{op:"???",ad:"",bc:1},{op:"rts",ad:"",bc:1,fc:!0},{op:"adc",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"adc",ad:"zp",bc:2},{op:"ror",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"pla",ad:"",bc:1},{op:"adc",ad:"imm",bc:2},{op:"ror",ad:"a",bc:1},{op:"???",ad:"",bc:1},{op:"jmp",ad:"jin",bc:3,fc:!0},{op:"adc",ad:"abs",bc:3},{op:"ror",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bvs",ad:"rel",bc:2,fc:!0},{op:"adc",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"adc",ad:"zpx",bc:2},{op:"ror",ad:"zpx",bc:2},{op:"???",ad:"",bc:1},{op:"sei",ad:"",bc:1},{op:"adc",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"adc",ad:"abx",bc:3},{op:"ror",ad:"abx",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sta",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sty",ad:"zp",bc:2},{op:"sta",ad:"zp",bc:2},{op:"stx",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"dey",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"txa",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sty",ad:"abs",bc:3},{op:"sta",ad:"abs",bc:3},{op:"stx",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bcc",ad:"rel",bc:2,fc:!0},{op:"sta",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sty",ad:"zpx",bc:2},{op:"sta",ad:"zpx",bc:2},{op:"stx",ad:"zpy",bc:2},{op:"???",ad:"",bc:1},{op:"tya",ad:"",bc:1},{op:"sta",ad:"aby",bc:3},{op:"txs",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sta",ad:"abx",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ldy",ad:"imm",bc:2},{op:"lda",ad:"inx",bc:2},{op:"ldx",ad:"imm",bc:2},{op:"???",ad:"",bc:1},{op:"ldy",ad:"zp",bc:2},{op:"lda",ad:"zp",bc:2},{op:"ldx",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"tay",ad:"",bc:1},{op:"lda",ad:"imm",bc:2},{op:"tax",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ldy",ad:"abs",bc:3},{op:"lda",ad:"abs",bc:3},{op:"ldx",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bcs",ad:"rel",bc:2,fc:!0},{op:"lda",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ldy",ad:"zpx",bc:2},{op:"lda",ad:"zpx",bc:2},{op:"ldx",ad:"zpy",bc:2},{op:"???",ad:"",bc:1},{op:"clv",ad:"",bc:1},{op:"lda",ad:"aby",bc:3},{op:"tsx",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"ldy",ad:"abx",bc:3},{op:"lda",ad:"abx",bc:3},{op:"ldx",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"cpy",ad:"imm",bc:2},{op:"cmp",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"cpy",ad:"zp",bc:2},{op:"cmp",ad:"zp",bc:2},{op:"dec",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"iny",ad:"",bc:1},{op:"cmp",ad:"imm",bc:2},{op:"dex",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"cpy",ad:"abs",bc:3},{op:"cmp",ad:"abs",bc:3},{op:"dec",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"bne",ad:"rel",bc:2,fc:!0},{op:"cmp",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"cmp",ad:"zpx",bc:2},{op:"dec",ad:"zpx",bc:2},{op:"???",ad:"",bc:1},{op:"cld",ad:"",bc:1},{op:"cmp",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"cmp",ad:"abx",bc:3},{op:"dec",ad:"abx",bc:3},{op:"???",ad:"",bc:1},{op:"cpx",ad:"imm",bc:2},{op:"sbc",ad:"inx",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"cpx",ad:"zp",bc:2},{op:"sbc",ad:"zp",bc:2},{op:"inc",ad:"zp",bc:2},{op:"???",ad:"",bc:1},{op:"inx",ad:"",bc:1},{op:"sbc",ad:"imm",bc:2},{op:"nop",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"cpx",ad:"abs",bc:3},{op:"sbc",ad:"abs",bc:3},{op:"inc",ad:"abs",bc:3},{op:"???",ad:"",bc:1},{op:"beq",ad:"rel",bc:2,fc:!0},{op:"sbc",ad:"iny",bc:2},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sbc",ad:"zpx",bc:2},{op:"inc",ad:"zpx",bc:2},{op:"???",ad:"",bc:1},{op:"sed",ad:"",bc:1},{op:"sbc",ad:"aby",bc:3},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"???",ad:"",bc:1},{op:"sbc",ad:"abx",bc:3},{op:"inc",ad:"abx",bc:3},{op:"???",ad:"",bc:1}]},4017:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Machine=void 0;const s=i(9273),o=i(4113);e.Machine=class{constructor(){this.clockRate=1022727,this.ram=new Uint8Array(131072),this.rom=new Uint8Array(12288),this.rom.fill(238,0,12287),this.rom.set(h,10240),this.cpu=new o.MOS6502,this.cpu.connectMemoryBus(this),this.paddleButtons=new Array(3),this.paddleValues=new Array(4),this.paddleTimes=new Array(4),this.speaker=new n,this.slots=new Array(8),this.disk2Card=new a,this.slots[6]=this.disk2Card}reset(){this.highRamWrite=!1,this.highRamRead=!1,this.highRamBank=1,this.lastHighRamAccess=0,this.altZpOffset=0,this.auxReadOffset=0,this.auxWriteOffset=0,this.keyLatch=0,this.visibleDisplayPage=0,this.activeDisplayPage=0,this.paddleButtons.fill(!1),this.paddleValues.fill(0),this.paddleTimes.fill(0),this.speaker.reset(),this.ram.fill(238,0,this.ram.length-1),this.ram.fill(0,8192,16383),this.disk2Card.reset()}loadRam(t,e,i,s=0,o=-1){-1==o&&(o=i.length),0==s&&o==i.length||(i=i.slice(s,s+o)),t>=53248&&t<57344?this.ram.set(i,2==e?t:t-4096):this.ram.set(i,t)}readConst(t){var e,i;if(t<49152||t>=53248)return this.read(t);if(t>=49408&&t<51200){let s=t>>8&7;return null!==(i=null===(e=this.slots[s])||void 0===e?void 0:e.readConst(15&t))&&void 0!==i?i:0}return 0}read(t){var e,i,s,o;if(t<512)return this.ram[t+this.altZpOffset];if(t<49152)return this.ram[t+this.auxReadOffset];if(t>=53248)return this.highRamRead?t>=57344||1==this.highRamBank?this.ram[t+this.altZpOffset]:this.ram[t+this.altZpOffset-4096]:this.rom[t-53248];if(t<49295)switch(t>>4&15){case 0:return this.keyLatch;case 1:return this.read_C01x(t);case 2:case 4:break;case 3:this.speaker.toggle();break;case 5:this.access_C05x(t);break;case 6:return this.readPaddles(t);case 7:this.resetPaddles();break;case 8:this.access_C08x(t)}else{if(t<49408){let s=t>>4&7;return null!==(i=null===(e=this.slots[s])||void 0===e?void 0:e.read(15&t))&&void 0!==i?i:this.readFloatingBus()}if(t<51200){let e=t>>8&7;return null!==(o=null===(s=this.slots[e])||void 0===s?void 0:s.readRom(255&t))&&void 0!==o?o:this.readFloatingBus()}}return this.readFloatingBus()}write(t,e){if(t<512)this.ram[t+this.altZpOffset]=e;else if(t<49152)this.ram[t+this.auxWriteOffset]=e,t>=8192&&t<16384?this.activeDisplayPage=0:t>=16384&&t<24576&&(this.activeDisplayPage=1);else if(t>=53248)this.highRamWrite&&(t>=57344||1==this.highRamBank?this.ram[t+this.altZpOffset]=e:this.ram[t+this.altZpOffset-4096]=e);else if(t<=49295)switch(t>>4&15){case 0:this.write_C00x(t,e);break;case 1:this.clearKeyStrobe();break;case 2:case 4:case 6:break;case 3:this.speaker.toggle();break;case 5:this.access_C05x(t);break;case 7:this.resetPaddles();break;case 8:this.access_C08x(t)}else if(t<49408){let i=t>>4&7;this.slots[i]&&this.slots[i].write(15&t,255&e)}}readFloatingBus(t){let e=238;return null!=t&&(t?e|=128:e&=-129),e}write_C00x(t,e){switch(15&t){case 0:case 1:case 6:case 7:case 10:case 11:case 12:case 13:case 14:case 15:break;case 2:this.auxReadOffset=0;break;case 3:this.auxReadOffset=65536;break;case 4:this.auxWriteOffset=0;break;case 5:this.auxWriteOffset=65536;break;case 8:this.altZpOffset=0;break;case 9:this.altZpOffset=65536}}read_C01x(t){switch(15&t){case 0:return this.clearKeyStrobe();case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:console.log("Read of $"+t.toString(16)+" ignored")}return 238}access_C05x(t){switch(15&t){case 0:case 1:case 2:case 3:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:break;case 4:this.visibleDisplayPage=0;break;case 5:this.visibleDisplayPage=1}}access_C08x(t){if(1&t){let t=this.getCycleCount();if(t-this.lastHighRamAccess>5)return void(this.lastHighRamAccess=t)}this.highRamBank=8&t?1:2,this.highRamWrite=0!=(1&t),this.highRamRead=0==(3&t)||3==(3&t)}setKeyCode(t){this.keyLatch=128|t}clearKeyStrobe(){return this.keyLatch&=-129,this.keyLatch}resetPaddles(){let t=this.getCycleCount();for(let e=0;e<this.paddleTimes.length;e+=1){if(t<=this.paddleTimes[e])continue;const i=2816/255;this.paddleTimes[e]=t+Math.floor(this.paddleValues[e]*i)}}readPaddles(t){switch(7&t){case 0:return 0;case 1:case 2:case 3:{let e=this.paddleButtons[(3&t)-1];return this.readFloatingBus(e)}case 4:case 5:case 6:case 7:{let e=this.getCycleCount()<=this.paddleTimes[3&t];return this.readFloatingBus(e)}}}setJoystickValues(t){var e,i,s,o,n,r,a;this.paddleButtons[0]=null!==(e=t.button0)&&void 0!==e&&e,this.paddleButtons[1]=null!==(i=t.button1)&&void 0!==i&&i,this.paddleButtons[2]=null!==(s=t.button2)&&void 0!==s&&s,this.paddleValues[0]=null!==(o=t.x0)&&void 0!==o?o:0,this.paddleValues[1]=null!==(n=t.y0)&&void 0!==n?n:0,this.paddleValues[2]=null!==(r=t.x1)&&void 0!==r?r:0,this.paddleValues[3]=null!==(a=t.y1)&&void 0!==a?a:0;for(let t=0;t<this.paddleValues.length;t+=1)this.paddleValues[t]<0?this.paddleValues[t]=0:this.paddleValues[t]>255&&(this.paddleValues[t]=255)}setDiskImage(t,e,i,s){this.disk2Card.setImage(t,e,i,s)}getDisplayPage(){return this.visibleDisplayPage}getActiveDisplayPage(){return this.activeDisplayPage}getPC(){return this.cpu.getPC()}getSP(){return this.cpu.getSP()}getStatusBits(){return this.cpu.getStatusBits()}getCycleCount(){return this.cpu.getCycleCount()}getA(){return this.cpu.getA()}getX(){return this.cpu.getX()}getY(){return this.cpu.getY()}setA(t){let e=this.cpu.saveState();e.A=t,this.cpu.loadState(e)}setX(t){let e=this.cpu.saveState();e.X=t,this.cpu.loadState(e)}setY(t){let e=this.cpu.saveState();e.Y=t,this.cpu.loadState(e)}setStatusBits(t){this.cpu.setStatusBits(t)}setPC(t){let e=this.cpu.saveState();e.PC=t-1,e.o=-1,e.T=-1,e.R=1,this.cpu.loadState(e),this.advanceCpu()}advanceCpu(){return this.cpu.advanceInsn()}call(t,e=0,i=0,s=0,o=0){let n=this.getCycleCount(),r=this.cpu.saveState();for(r.PC=t-1,r.o=-1,r.T=-1,r.R=1,r.A=e,r.X=i,r.Y=s,r.C=o,r.D=0,this.cpu.loadState(r),this.write(256+(r.SP+1&255),255),this.write(256+(r.SP+2&255),255);0!=this.cpu.getPC();)this.advanceCpu();return this.getCycleCount()-n}};class n{reset(){this.audioCtx&&this.audioCtx.close(),this.audioCtx=new AudioContext,this.audioCtx.resume(),this.cyclesPerSample=s.machine.clockRate/this.audioCtx.sampleRate,this.sampleBuffer=[],this.audioSampleIndex=0,this.partialSample=new Array(Math.floor(this.cyclesPerSample)),this.partialIndex=0,this.speakerLevel=-1,this.lastSpeakerUpdate=s.machine.getCycleCount(),this.nextBufferStart=0,this.fadeCount=0,this.fadeDelay=Math.floor(1*this.audioCtx.sampleRate/4),this.fadeSamples=Math.floor(1*this.audioCtx.sampleRate/16)}toggle(){this.update(!1),this.speakerLevel=-this.speakerLevel,this.fadeCount=this.fadeDelay+this.fadeSamples}update(t){if(this.audioCtx){let e=s.machine.getCycleCount(),i=e-this.lastSpeakerUpdate;this.lastSpeakerUpdate=e;let o=!0;for(;i>0;){if(this.partialIndex>0||!o)for(;i>0;)if(i-=1,this.partialSample[this.partialIndex]=this.speakerLevel,this.partialIndex+=1,this.partialIndex==this.partialSample.length){let t=0;for(let e=0;e<this.partialSample.length;e+=1)t+=this.partialSample[e];t/=this.partialSample.length,this.emitSample(t),this.partialIndex=0;break}if(i>0){let t=Math.floor(i/this.cyclesPerSample);for(i-=Math.floor(t*this.cyclesPerSample);t>0;)this.emitSample(this.speakerLevel),t-=1}o=!1}t&&this.flushAudioBuffer()}}emitSample(t){0==this.fadeCount?t=0:(this.fadeCount-=1,this.fadeCount<this.fadeSamples&&(t*=this.fadeCount/this.fadeSamples)),this.sampleBuffer.push(t)}flushAudioBuffer(){if(this.sampleBuffer.length>0){let t=this.audioCtx.createBuffer(1,this.sampleBuffer.length,this.audioCtx.sampleRate);t.getChannelData(0).set(this.sampleBuffer),this.sampleBuffer=[];let e=this.audioCtx.createBufferSource();e.buffer=t,e.connect(this.audioCtx.destination),this.nextBufferStart<this.audioCtx.currentTime&&(this.nextBufferStart=this.audioCtx.currentTime),e.start(this.nextBufferStart),this.nextBufferStart+=t.duration}}}class r{constructor(){this.reset()}reset(){this.isWriteProtected=!1,this.isSpinning=!1,this.phase=0,this.trackOffset=0,this.byteIndex=0}setImage(t,e,i){"nib"==e?(this.image=t,this.isWriteProtected=i):console.log("Unsupported disk format: "+e)}getNextDataByte(){if(this.image){let t=this.image[this.trackOffset+this.byteIndex];return this.byteIndex+=1,6656==this.byteIndex&&(this.byteIndex=0),t}return 238}getPhase(){return this.phase}setPhase(t){this.phase!=t&&(this.phase=t,this.trackOffset=6656*(this.phase>>1))}}class a{constructor(){this.drives=[new r,new r],this.reset()}reset(){this.drives.forEach((t=>{t.reset()})),this.currentDrive=0,this.motorIsOn=!1,this.writeMode=!1,this.magnetStates=0,this.latch=0}setImage(t,e,i,s){this.drives[t].setImage(e,i,s)}read(t){return this.onReadWrite(t)}readConst(t){return 0}readRom(t){return 0}write(t,e){this.onReadWrite(t,e)}onReadWrite(t,e){let i=null!=e;switch(15&t){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:this.controlStepper(t);break;case 8:case 9:this.controlMotor(t);break;case 10:case 11:this.enable(t);break;case 12:i&&(this.latch=e),this.readWrite();break;case 13:i&&(this.latch=e),this.loadWriteProtect();break;case 14:case 15:this.setMode(t)}if(!i)return 0==(1&t)?this.latch:238}controlStepper(t){let e=this.drives[this.currentDrive];if(!this.motorIsOn){if(!e.isSpinning)return void console.log("disk stepper accessed while motor is off");console.log("disk stepper accessed while motor is off but spinning")}let i=1<<(t>>1&3);1&t?this.magnetStates|=i:this.magnetStates&=~i;let s=e.getPhase(),o=0;this.magnetStates&1<<(s+1&3)&&(o+=1),this.magnetStates&1<<(s+3&3)&&(o-=1);let n=s+o;n<0?n=0:n>69&&(n=69),e.setPhase(n)}controlMotor(t){let e=0!=(1&t);e!=this.motorIsOn&&(this.motorIsOn=e,this.motorIsOn?(this.drives[this.currentDrive].isSpinning=!0,this.drives[1^this.currentDrive].isSpinning=!1):(this.drives[0].isSpinning=!1,this.drives[1].isSpinning=!1))}enable(t){this.currentDrive=1&t,this.drives[1^this.currentDrive].isSpinning=!1}readWrite(){let t=this.drives[this.currentDrive];t.isSpinning?this.writeMode?t.isWriteProtected?console.log("disk write ignored: write protected"):console.log("disk write ignored: NOT IMPLEMENTED"):this.latch=t.getNextDataByte():console.log("read/write on drive that's not spinning")}loadWriteProtect(){let t=this.drives[this.currentDrive];t.isSpinning?t.isWriteProtected?this.latch|=128:this.latch&=127:console.log("checking write protect on drive that's not spinning")}setMode(t){this.writeMode=0!=(1&t)}}const h=[74,8,32,71,248,40,169,15,144,2,105,224,133,46,177,38,69,48,37,46,81,38,145,38,96,32,0,248,196,44,176,17,200,32,14,248,144,246,105,1,72,32,0,248,104,197,45,144,245,96,160,47,208,2,160,39,132,45,160,39,169,0,133,48,32,40,248,136,16,246,96,72,74,41,3,9,4,133,39,104,41,24,144,2,105,127,133,38,10,10,5,38,133,38,96,165,48,24,105,3,41,15,133,48,10,10,10,10,5,48,133,48,96,74,8,32,71,248,177,38,40,144,4,74,74,74,74,41,15,96,166,58,164,59,32,150,253,32,72,249,161,58,168,74,144,9,106,176,16,201,162,240,12,41,135,74,170,189,98,249,32,121,248,208,4,160,128,169,0,170,189,166,249,133,46,41,3,133,47,152,41,143,170,152,160,3,224,138,240,11,74,144,8,74,74,9,32,136,208,250,200,136,208,242,96,255,255,255,32,130,248,72,177,58,32,218,253,162,1,32,74,249,196,47,200,144,241,162,3,192,4,144,242,104,168,185,192,249,133,44,185,0,250,133,45,169,0,160,5,6,45,38,44,42,136,208,248,105,191,32,237,253,202,208,236,32,72,249,164,47,162,6,224,3,240,28,6,46,144,14,189,179,249,32,237,253,189,185,249,240,3,32,237,253,202,208,231,96,136,48,231,32,218,253,165,46,201,232,177,58,144,242,32,86,249,170,232,208,1,200,152,32,218,253,138,76,218,253,162,3,169,160,32,237,253,202,208,248,96,56,165,47,164,59,170,16,1,136,101,58,144,1,200,96,4,32,84,48,13,128,4,144,3,34,84,51,13,128,4,144,4,32,84,51,13,128,4,144,4,32,84,59,13,128,4,144,0,34,68,51,13,200,68,0,17,34,68,51,13,200,68,169,1,34,68,51,13,128,4,144,1,34,68,51,13,128,4,144,38,49,135,154,0,33,129,130,0,0,89,77,145,146,134,74,133,157,172,169,172,163,168,164,217,0,216,164,164,0,28,138,28,35,93,139,27,161,157,138,29,35,157,139,29,161,0,41,25,174,105,168,25,35,36,83,27,35,36,83,25,161,0,26,91,91,165,105,36,36,174,174,168,173,41,0,124,0,21,156,109,156,165,105,41,83,132,19,52,17,165,105,35,160,216,98,90,72,38,98,148,136,84,68,200,84,104,68,232,148,0,180,8,132,116,180,40,110,116,244,204,74,114,242,164,138,0,170,162,162,116,116,116,114,68,104,178,50,178,0,34,0,26,26,38,38,114,114,136,200,196,202,38,72,68,68,162,200,133,69,104,72,10,10,10,48,3,108,254,3,40,32,76,255,104,133,58,104,133,59,108,240,3,32,130,248,32,218,250,76,101,255,216,32,132,254,32,47,251,32,147,254,32,137,254,173,88,192,173,90,192,173,93,192,173,95,192,173,255,207,44,16,192,216,32,58,255,173,243,3,73,165,205,244,3,208,23,173,242,3,208,15,169,224,205,243,3,208,8,160,3,140,242,3,76,0,224,108,242,3,32,96,251,162,5,189,252,250,157,239,3,202,208,247,169,200,134,0,133,1,160,7,198,1,165,1,201,192,240,215,141,248,7,177,0,217,1,251,208,236,136,136,16,245,108,0,0,234,234,32,142,253,169,69,133,64,169,0,133,65,162,251,169,160,32,237,253,189,30,250,32,237,253,169,189,32,237,253,181,74,32,218,253,232,48,232,96,89,250,0,224,69,32,255,0,255,3,255,60,193,208,208,204,197,160,221,219,196,194,193,255,195,255,255,255,193,216,217,208,211,173,112,192,160,0,234,234,189,100,192,16,4,200,208,248,136,96,169,0,133,72,173,86,192,173,84,192,173,81,192,169,0,240,11,173,80,192,173,83,192,32,54,248,169,20,133,34,169,0,133,32,169,40,133,33,169,24,133,35,169,23,133,37,76,34,252,32,88,252,160,8,185,8,251,153,14,4,136,208,247,96,173,243,3,73,165,141,244,3,96,201,141,208,24,172,0,192,16,19,192,147,208,15,44,16,192,172,0,192,16,251,192,131,240,3,44,16,192,76,253,251,56,76,44,252,168,185,72,250,32,151,251,32,12,253,201,206,176,238,201,201,144,234,201,204,240,230,208,232,234,234,234,234,234,234,234,234,234,234,234,234,234,234,72,74,41,3,9,4,133,41,104,41,24,144,2,105,127,133,40,10,10,5,40,133,40,96,201,135,208,18,169,64,32,168,252,160,192,169,12,32,168,252,173,48,192,136,208,245,96,164,36,145,40,230,36,165,36,197,33,176,102,96,201,160,176,239,168,16,236,201,141,240,90,201,138,240,90,201,136,208,201,198,36,16,232,165,33,133,36,198,36,165,34,197,37,176,11,198,37,165,37,32,193,251,101,32,133,40,96,73,192,240,40,105,253,144,192,240,218,105,253,144,44,240,222,105,253,144,92,208,233,164,36,165,37,72,32,36,252,32,158,252,160,0,104,105,0,197,35,144,240,176,202,165,34,133,37,160,0,132,36,240,228,169,0,133,36,230,37,165,37,197,35,144,182,198,37,165,34,72,32,36,252,165,40,133,42,165,41,133,43,164,33,136,104,105,1,197,35,176,13,72,32,36,252,177,40,145,42,136,16,249,48,225,160,0,32,158,252,176,134,164,36,169,160,145,40,200,196,33,144,249,96,56,72,233,1,208,252,104,233,1,208,246,96,230,66,208,2,230,67,165,60,197,62,165,61,229,63,230,60,208,2,230,61,96,160,75,32,219,252,208,249,105,254,176,245,160,33,32,219,252,200,200,136,208,253,144,5,160,50,136,208,253,172,32,192,160,44,202,96,162,8,72,32,250,252,104,42,160,58,202,208,245,96,32,253,252,136,173,96,192,69,47,16,248,69,47,133,47,192,128,96,164,36,177,40,72,41,63,9,64,145,40,104,108,56,0,230,78,208,2,230,79,44,0,192,16,245,145,40,173,0,192,44,16,192,96,32,12,253,32,165,251,32,12,253,201,155,240,243,96,165,50,72,169,255,133,50,189,0,2,32,237,253,104,133,50,189,0,2,201,136,240,29,201,152,240,10,224,248,144,3,32,58,255,232,208,19,169,220,32,237,253,32,142,253,165,51,32,237,253,162,1,138,240,243,202,32,53,253,201,149,208,2,177,40,201,224,144,2,41,223,157,0,2,201,141,208,178,32,156,252,169,141,208,91,164,61,166,60,32,142,253,32,64,249,160,0,169,173,76,237,253,165,60,9,7,133,62,165,61,133,63,165,60,41,7,208,3,32,146,253,169,160,32,237,253,177,60,32,218,253,32,186,252,144,232,96,74,144,234,74,74,165,62,144,2,73,255,101,60,72,169,189,32,237,253,104,72,74,74,74,74,32,229,253,104,41,15,9,176,201,186,144,2,105,6,108,54,0,201,160,144,2,37,50,132,53,72,32,120,251,104,164,53,96,198,52,240,159,202,208,22,201,186,208,187,133,49,165,62,145,64,230,64,208,2,230,65,96,164,52,185,255,1,133,49,96,162,1,181,62,149,66,149,68,202,16,247,96,177,60,145,66,32,180,252,144,247,96,177,60,209,66,240,28,32,146,253,177,60,32,218,253,169,160,32,237,253,169,168,32,237,253,177,66,32,218,253,169,169,32,237,253,32,180,252,144,217,96,32,117,254,169,20,72,32,208,248,32,83,249,133,58,132,59,104,56,233,1,208,239,96,138,240,7,181,60,149,58,202,16,249,96,160,63,208,2,160,255,132,50,96,169,0,133,62,162,56,160,27,208,8,169,0,133,62,162,54,160,240,165,62,41,15,240,6,9,192,160,0,240,2,169,253,148,0,149,1,96,234,234,76,0,224,76,3,224,32,117,254,32,63,255,108,58,0,76,215,250,96,234,96,234,234,234,234,234,76,248,3,169,64,32,201,252,160,39,162,0,65,60,72,161,60,32,237,254,32,186,252,160,29,104,144,238,160,34,32,237,254,240,77,162,16,10,32,214,252,208,250,96,32,0,254,104,104,208,108,32,250,252,169,22,32,201,252,133,46,32,250,252,160,36,32,253,252,176,249,32,253,252,160,59,32,236,252,129,60,69,46,133,46,32,186,252,160,53,144,240,32,236,252,197,46,240,13,169,197,32,237,253,169,210,32,237,253,32,237,253,169,135,76,237,253,165,72,72,165,69,166,70,164,71,40,96,133,69,134,70,132,71,8,104,133,72,186,134,73,216,96,32,132,254,32,47,251,32,147,254,32,137,254,216,32,58,255,169,170,133,51,32,103,253,32,199,255,32,167,255,132,52,160,23,136,48,232,217,204,255,208,248,32,190,255,164,52,76,115,255,162,3,10,10,10,10,10,38,62,38,63,202,16,248,165,49,208,6,181,63,149,61,149,65,232,240,243,208,6,162,0,134,62,134,63,185,0,2,200,73,176,201,10,144,211,105,136,201,250,176,205,96,169,254,72,185,227,255,72,165,49,160,0,132,49,96,188,178,190,178,239,196,178,169,187,166,164,6,149,7,2,5,240,0,235,147,167,198,153,178,201,190,193,53,140,196,150,175,23,23,43,31,131,127,93,204,181,252,23,23,245,3,251,3,98,250,64,250]},2382:(t,e)=>{"use strict";var i,s;Object.defineProperty(e,"__esModule",{value:!0}),e.packNaja1=e.packNaja2=e.Naja2Compressor=e.CompType=void 0,(s=e.CompType||(e.CompType={}))[s.Raw=0]="Raw",s[s.Skip=1]="Skip",s[s.Flip=2]="Flip",s[s.Copy1=3]="Copy1",s[s.Copy=4]="Copy",s[s.Rep1=5]="Rep1",s[s.Rep2=6]="Rep2",s[s.Move=7]="Move",s[s.Count=8]="Count",function(t){t[t.None=0]="None",t[t.Rep1Back=1]="Rep1Back",t[t.Rep1Cur=2]="Rep1Cur",t[t.Rep1Next=3]="Rep1Next",t[t.Rep2Back=4]="Rep2Back",t[t.Rep2Split=5]="Rep2Split",t[t.Rep2Next=6]="Rep2Next",t[t.Move=7]="Move",t[t.Count=8]="Count"}(i||(i={}));class o{constructor(){this.maxSkipCount=63,this.minMoveCount=4,this.maxMoveCount=31,this.minRep1Count=2,this.maxRep1Count=31,this.maxRep2Count=15}setImageData(t){let e=Math.floor(t.bounds.x/7),i=Math.ceil((t.bounds.x+t.bounds.width)/7)-e;this.imageData=new Uint8Array(i*t.bounds.height);for(let e=0;e<t.bounds.height;e+=1)for(let s=0;s<i;s+=1)this.imageData[s*t.bounds.height+e]=t.dataBytes[e*i+s];this.leftColumn=e,this.columnWidth=i,this.topLine=t.bounds.y,this.lineHeight=t.bounds.height}compress(t){this.setImageData(t),this.entries=[],this.rawBytes=[],this.highBit=0;let e=new Array(i.Count),s=new Array(i.Count);for(let t=0;t<this.columnWidth;t+=1){this.entries.push({type:"column",count:t+this.leftColumn});let o=t*this.lineHeight,n=0;for(;n<this.lineHeight;){let r=this.imageData[o+n];if(0==r){this.flushRawBytes();let t=1;for(;n+t!=this.lineHeight&&0==this.imageData[o+n+t];)t+=1;this.entries.push({type:"skip",count:t}),n+=t;continue}s[i.Rep1Back]=this.countRep1(t,n-1),e[i.Rep1Back]=s[i.Rep1Back]>1?1/s[i.Rep1Back]:0,s[i.Rep1Cur]=this.countRep1(t,n),e[i.Rep1Cur]=s[i.Rep1Cur]>2?2/(1+s[i.Rep1Cur]):0,s[i.Rep1Next]=this.countRep1(t,n+1),e[i.Rep1Next]=s[i.Rep1Next]>3?3/(2+s[i.Rep1Next]):0,s[i.Rep2Back]=this.countRep2(t,n-2),e[i.Rep2Back]=s[i.Rep2Back]>0?1/(2*s[i.Rep2Back]):0,s[i.Rep2Split]=this.countRep2(t,n-1),e[i.Rep2Split]=s[i.Rep2Split]>1?2/(1+2*s[i.Rep2Split]):0,s[i.Rep2Next]=this.countRep2(t,n),e[i.Rep2Next]=s[i.Rep2Next]>1?3/(2+2*s[i.Rep2Next]):0;let a=1;for(;n+a!=this.lineHeight&&0!=this.imageData[o+n+a];)a+=1;a>this.maxMoveCount&&(a=this.maxMoveCount);let h=-1,l=-1,c=0;if(a>=this.minMoveCount)for(let e=0;e<=t;e+=1){let i=e<t?this.lineHeight:n,s=0;for(;s!=i;){let t=0;for(;s+t!=i;){let i=this.imageData[e*this.lineHeight+s+t];if(0==i)break;if(i!=this.imageData[o+n+t])break;if(t+=1,t==a)break}c<=t&&(h=e,l=s,c=t),s+=1}}s[i.Move]=c,e[i.Move]=s[i.Move]>3?3/s[i.Move]:0;let d=1,u=i.None;for(let t=i.Rep1Back;t<=i.Move;t+=1)e[t]>0&&e[t]<d&&(d=e[t],u=t);if(u!=i.Rep1Back)if(u!=i.Rep1Cur)if(u!=i.Rep1Next)if(u!=i.Rep2Back)if(u!=i.Rep2Split)if(u!=i.Rep2Next)if(u!=i.Move)this.pushRawByte(r),n+=1;else{let t=[];for(let e=0;e<c;e+=1){let i=this.imageData[h*this.lineHeight+l+e];t.push(i)}this.flushRawBytes(),this.entries.push({type:"move",count:c,data:t,srcColumn:h,srcLine:l}),n+=c}else this.pushRawByte(r),n+=1,this.pushRawByte(this.imageData[o+n]),n+=1,this.flushRawBytes(),this.entries.push({type:"rep2",count:s[i.Rep2Next]}),n+=2*s[i.Rep2Next];else this.pushRawByte(r),n+=1,this.flushRawBytes(),this.entries.push({type:"rep2",count:s[i.Rep2Split]}),n+=2*s[i.Rep2Split];else this.flushRawBytes(),this.entries.push({type:"rep2",count:s[i.Rep2Back]}),n+=2*s[i.Rep2Back];else this.pushRawByte(r),n+=1,this.pushRawByte(this.imageData[o+n]),n+=1,this.flushRawBytes(),this.entries.push({type:"rep1",count:s[i.Rep1Next]}),n+=s[i.Rep1Next];else this.pushRawByte(r),n+=1,this.flushRawBytes(),this.entries.push({type:"rep1",count:s[i.Rep1Cur]}),n+=s[i.Rep1Cur];else this.flushRawBytes(),this.entries.push({type:"rep1",count:s[i.Rep1Back]}),n+=s[i.Rep1Back]}this.flushRawBytes()}return this.optimizeEntries(),this.encode()}optimizeEntries(){let t=0,e=0;for(;e!=this.entries.length;){for(t=e;e+=1,e!=this.entries.length&&"column"!=this.entries[e].type;);for(let i=t;i<e;i+=1)if("move"==this.entries[i].type&&i+1<e){let t=this.entries[i],e=this.entries[i+1];if("rep1"==e.type&&e.count){let i=t.data.length-1;for(;i>0&&t.data[i-1]==t.data[i];)i-=1;let s=t.data.length-i-1;if(s>0){if(t.data.length-s<this.minMoveCount&&(s=t.data.length-this.minMoveCount,s<=0))continue;t.data.splice(i,s),t.count-=s,e.count+=s}}else if("rep2"==e.type&&e.count){let i=t.data.length-2;for(;i>1&&t.data[i-2]==t.data[i+0]&&t.data[i-1]==t.data[i+1];)i-=2;let s=(t.data.length-i-2)/2;if(s>0){if(t.data.length-2*s<this.minMoveCount&&(s=Math.floor((t.data.length-this.minMoveCount)/2),s<=0))continue;t.data.splice(i,2*s),t.count-=2*s,e.count+=s}}}}for(t=0,e=0;e!=this.entries.length;){for(t=e;e+=1,e!=this.entries.length&&"column"!=this.entries[e].type;);for(;;){let i=!1;for(let s=t;s<e;s+=1){if("flip"==this.entries[s].type){let t=1,o=0;for(let i=s+1;i<e;i+=1){let n=this.entries[i].type;if("flip"==n)t+=1,0==(1&t)&&(o=i-s);else if("raw"!=n||i+1==e){if("raw"==n&&(i+=1),0!=(1&t))for(let n=i+1;n<this.entries.length;n+=1){let r=this.entries[n].type;if("flip"==r){this.entries.splice(n,1),n<e&&(e-=1),t+=1,o=i-s-1;break}if("raw"==r)break}break}}if(o>0){this.entries[s].data=[];for(let t=0;t<o;t+=1)"raw"==this.entries[s+1+t].type&&this.entries[s].data.push(...this.entries[s+1+t].data);this.entries[s].type="copy",this.entries.splice(s+1,o),e-=o,i=!0;continue}}"raw"==this.entries[s].type&&s+1<e&&"copy"==this.entries[s+1].type&&this.entries[s+1].data.length>1&&(this.entries[s].type="copy",this.entries[s].data.push(...this.entries[s+1].data),this.entries.splice(s+1,1),e-=1,i=!0),"copy"==this.entries[s].type&&this.entries[s].data.length>1&&s+1<e&&"raw"==this.entries[s+1].type&&(this.entries[s].data.push(...this.entries[s+1].data),this.entries.splice(s+1,1),e-=1,i=!0),"copy"==this.entries[s].type&&s+1<e&&"copy"==this.entries[s+1].type&&(this.entries[s].data.push(...this.entries[s+1].data),this.entries.splice(s+1,1),e-=1,i=!0)}if(!i)break}}}countRep1(t,e){let i=0;if(e>=0){let s=t*this.lineHeight,o=this.imageData[s+e];if(e+=1,0!=o)for(;e+i<this.lineHeight&&this.imageData[s+e+i]==o;)i+=1}return i}countRep2(t,e){let i=0;if(e>=0){let s=t*this.lineHeight,o=this.imageData[s+e];if((e+=1)<this.lineHeight){let t=this.imageData[s+e];if(e+=1,0!=o&&0!=t)for(;e+2*i+2<=this.lineHeight&&this.imageData[s+e+2*i+0]==o&&this.imageData[s+e+2*i+1]==t;)i+=1}}return i}pushRawByte(t){128&(t^this.highBit)&&(this.flushRawBytes(),this.entries.push({type:"flip",count:1}),this.highBit^=128),this.rawBytes.push(t)}flushRawBytes(){this.rawBytes.length>0&&(this.entries.push({type:"raw",count:this.rawBytes.length,data:this.rawBytes}),this.rawBytes=[])}asHexData(t){let e="";for(let i=0;i<t.length;i+=1)""!=e&&(e+=" "),e+=t[i].toString(16).padStart(2,"0").toUpperCase();return e}dumpBlocks(){this.entries.forEach((t=>{"move"==t.type?console.log(`move ${t.data.length} {${this.asHexData(t.data)}}`):"flip"==t.type?console.log(t.type):"copy"==t.type?console.log(`copy ${t.data.length} [${this.asHexData(t.data)}]`):"column"==t.type?(console.log(""),console.log(t.type+" "+t.count)):"raw"==t.type?console.log(`raw  ${t.data.length} [${this.asHexData(t.data)}]`):console.log(t.type+" "+t.count)}))}encode(){let t=[];return t.push(this.leftColumn),t.push(this.topLine),t.push(this.columnWidth),t.push(this.lineHeight),this.entries.forEach((e=>{if("raw"==e.type)e.data.forEach((e=>{t.push(127&e)}));else if("flip"==e.type)t.push(128);else if("copy"==e.type)1==e.data.length?t.push(129):(t.push(131),t.push(e.data.length)),t.push(...e.data);else if("skip"==e.type){let i=e.count;for(;i>0;){let e=i;e>this.maxSkipCount&&(e=this.maxSkipCount),t.push(128|e<<1),i-=e}}else if("rep1"==e.type){let i=e.count;for(;i>0;){let e=i;e>this.maxRep1Count&&(e=this.maxRep1Count);let s=i-e;s>0&&s<this.minRep1Count&&(e=i-this.minRep1Count,s=this.minRep1Count),t.push(129|e<<2),i=s}}else if("rep2"==e.type){let i=e.count;for(;i>0;){let e=i;e>this.maxRep2Count&&(e=this.maxRep2Count),t.push(131|e<<3),i-=e}}else"move"==e.type&&(t.push(135|(e.data.length>>1&15)<<3),t.push(e.srcColumn<<1|1&e.data.length),t.push(e.srcLine))})),t}}e.Naja2Compressor=o,e.packNaja2=function(t){return(new o).compress(t)},e.packNaja1=function(t){let e=[],i=Math.floor(t.bounds.x/7),s=Math.floor((t.bounds.x+t.bounds.width+6)/7),o=t.bounds.y,n=t.bounds.y+t.bounds.height,r=s-i;e.push(o),e.push(n-1),e.push(i),e.push(s-1);let a=0,h=0;for(let l=s-i;--l>=0;)for(let i=n-o;--i>=0;){let s=t.dataBytes[i*r+l];if(0==a)h=s,a=1;else if(s==h)a+=1;else if(a>2||254==h)e.push(254),e.push(a),e.push(h),h=s,a=1;else{for(;a>0;)e.push(h),a-=1;h=s,a=1}}if(a>0)if(a>2||254==h)e.push(254),e.push(a),e.push(h);else for(;a>0;)e.push(h),a-=1;return e}},126:function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Project=e.ProjectFile=void 0;const o=i(9273),n=i(6358),r=i(8887),a=i(1232);class h{constructor(t,e,i){this.project=t,this.name=e,this.parentDir=i}}class l extends h{constructor(t,e,i){super(t,e,i),this.parentDir.subEntries.push(this),this.itemElement=document.createElement("li"),this.itemElement.className="proj-file",this.parentDir.listElement.appendChild(this.itemElement);let s=document.createElement("a");s.textContent=e,this.itemElement.appendChild(s),this.itemElement.addEventListener("click",(t=>{t.stopPropagation(),this.project.activateView(this.sourceView,!1)}))}activate(){this.itemElement.className="proj-file active",this.parentDir.openView()}deactivate(){this.itemElement.className="proj-file"}}e.ProjectFile=l;class c extends h{constructor(t,e,i,s){if(super(t,e,i),this.subEntries=[],this.isOpen=!1,this.parentDir){this.parentDir.subEntries.push(this),this.itemElement=document.createElement("li"),this.itemElement.className="proj-dir",this.parentDir.listElement.appendChild(this.itemElement),this.arrowElement=document.createElement("div"),this.arrowElement.className="codicon codicon-chevron-right",this.itemElement.appendChild(this.arrowElement);let t=document.createElement("a");t.textContent=e,this.itemElement.appendChild(t),this.itemElement.addEventListener("click",(t=>{t.stopPropagation(),this.isOpen?this.closeView():this.openView()})),this.updateIcon()}this.listElement=document.createElement("ul"),this.listElement.type="none",s?(this.isOpen=!0,this.listElement.style.display="block",this.listElement.style.paddingLeft="16px",s.appendChild(this.listElement)):(this.listElement.style.display="none",this.itemElement.appendChild(this.listElement))}openView(){this.isOpen||(this.listElement.style.display="block",this.isOpen=!0,this.updateIcon()),this.parentDir&&this.parentDir.openView()}closeView(){this.isOpen&&(this.listElement.style.display="none",this.isOpen=!1,this.updateIcon())}updateIcon(){this.arrowElement.className="proj-arrow codicon "+(this.isOpen?"codicon-chevron-down":"codicon-chevron-right")}}class d{constructor(t,e,i){this.project=t,this.project.sourceViews=[],this.rootDir=new c(t,t.name,null,e),this.filesElement=e,this.viewsElement=i}processLstFile(t,e){let i=t,s=i.lastIndexOf("/");-1!=s&&(i=i.substring(s+1));let o=e.split(/\r?\n/),a=(new r.SourceDocBuilder).buildLstDocs(this.project,i,o),h=new c(this.project,i,this.rootDir);a.forEach((t=>{let e,i=h,s=t.name,o=0;for(;-1!=(e=s.indexOf("/"));){let t=s.substring(0,e);if(s=s.substring(e+1),0!=e){if(o>0){let e;i.subEntries.every((i=>i.name!=t||(e=i,!1))),i=e||new c(this.project,t,i)}o+=1}}let r=new l(this.project,s,i),a=new n.SourceView(this.project,r,this.viewsElement);r.sourceView=a,this.project.sourceViews.push(a),a.setDocument(t)}))}processDis65File(t,e){let i=(new r.SourceDocBuilder).buildDis65Docs(this.project,t,e),s=new c(this.project,"disassembly",this.rootDir);i.forEach((t=>{let e=new l(this.project,t.name,s),i=new n.SourceView(this.project,e,this.viewsElement);e.sourceView=i,this.project.sourceViews.push(i),i.setDocument(t),t.disassembler&&(t.disassembler.setSourceView(i),this.project.coverage||(this.project.coverage=new o.Coverage))}))}}class u{constructor(t){this.dirHandle=t}load(t){return s(this,void 0,void 0,(function*(){try{return this.dirHandle?(yield this.dirHandle.getFileHandle(t)).getFile():(yield fetch(t)).blob()}catch(e){console.log("Failed to load "+t),console.log(e.message)}}))}}e.Project=class{constructor(){this.sourceViews=[],this.scrollStack=[]}loadFile(t,e,i){return s(this,void 0,void 0,(function*(){let s=new u(e);i?i+="/":i="";try{let e=yield s.load(i+t),o=yield e.text();this.json=JSON.parse(o)}catch(t){throw t}this.name=this.json.projectName||"unknown";let n=null;if(this.json.bins)for(let t=0;t<this.json.bins.length;t+=1){let e=this.json.bins[t];if(null==e.enabled||1==e.enabled)try{let t=yield s.load(i+e.fileName),r=yield t.arrayBuffer();const a=new Uint8Array(r);n||(n=a);let h=parseInt(e.loadAddress,16),l=e.bank||0;o.machine.loadRam(h,l,a),this.json.startAddress&&(this.startAddress=parseInt(this.json.startAddress,16))}catch(t){}}let r=document.getElementById("files-side"),h=document.getElementById("code-side"),l=new d(this,r,h);if(this.json.lsts)for(let t=0;t<this.json.lsts.length;t+=1){let e=this.json.lsts[t];if(null==e.enabled||1==e.enabled)try{let t=yield s.load(i+e.fileName),o=yield t.text();l.processLstFile(e.fileName,o)}catch(t){}}if(this.breakpoints=new a.Breakpoints(this),this.breakpoints.loadBreakpoints(),this.json.images)for(let t=0;t<this.json.images.length;t+=1){let e=this.json.images[t];if(null==e.enabled||1==e.enabled)try{let t=yield s.load(i+e.fileName),n=yield t.arrayBuffer();const r=new Uint8Array(n);let a=e.fileName.lastIndexOf("."),h=e.fileName.substring(a+1).toLowerCase(),l=e.drive||1,c=e.readonly||!1;o.machine.setDiskImage(l-1,r,h,c)}catch(t){}}if(this.json.dasms)for(let t=0;t<this.json.dasms.length;t+=1){let e=this.json.dasms[t];try{let t=yield s.load(i+e.fileName),o=yield t.text(),r=JSON.parse(o);l.processDis65File(r,n)}catch(t){}}this.findInput=document.getElementById("find-input"),this.findInput.addEventListener("keyup",(t=>{13==t.keyCode&&this.activeSourceView.findWord(!t.shiftKey)}))}))}onFind(){this.activeSourceView.selectWord(),this.findInput.focus(),this.findInput.select()}setSearchWord(t){this.findInput.value=t}getSearchWord(){return this.findInput.value}findSourceView(t){for(let e=0;e<this.sourceViews.length;e+=1)if(this.sourceViews[e].sourceDoc.name==t)return this.sourceViews[e]}pushScrollPosition(t,e,i){this.scrollStack.push({sourceView:t,left:e,top:i})}popScrollPosition(){if(this.scrollStack.length>0){let t=this.scrollStack.pop(),e=!1;this.activateView(t.sourceView,e),t.sourceView.setScrollPosition(t.left,t.top)}}findSourceViewLinesByAddress(t){let e=[];return this.sourceViews.forEach((i=>{let s=i.sourceDoc.findLineByAddress(t);-1!=s&&e.push({sourceView:i,lineNumber:s})})),e}sourceViewLineFromAddress(t,e){let i,s=this.findSourceViewLinesByAddress(t);if(s.every((t=>t.sourceView!=e||(i=t,!1))),!i){let o=[],n=[],r=e.sourceDoc.lstFileName;for(s.every((t=>(t.sourceView.sourceDoc.lstFileName==r?o.push(t):n.push(t),!0)));o&&(o.every((e=>(i=e,!e.sourceView.sourceDoc.isLoaded(t)))),!i);)o=n,n=void 0}return i}scrollToFunctionAddress(t,e,i){let s=this.sourceViewLineFromAddress(t,i);if(s){this.activeSourceView.pushScrollPosition();let t=!1;this.activateView(s.sourceView,t),s.sourceView.scrollToFunctionLine(e,s.lineNumber)}}sourceViewLineFromSelection(){if(this.activeSourceView){let t=this.activeSourceView.getLineFromSelection();if(t>=0)return{sourceView:this.activeSourceView,lineNumber:t}}}sourceDocLineFromSelection(){if(this.activeSourceView){let t=this.activeSourceView.getLineFromSelection();if(t>=0){let e=this.activeSourceView.sourceDoc;return{sourceDoc:e,sourceLine:e.sourceLines[t]}}}}loadBreakpoint(t,e){let i=this.findSourceView(t);i?i.loadBreakpoint(e):console.log("breakpoint not found")}toggleBreakpoint(t){t.sourceView.toggleUserBreakpoint(t.lineNumber)}clearVisiblePC(){this.activeSourceView&&this.activeSourceView.clearPC()}activatePCView(){let t=o.machine.getPC(),e=this.findSourceViewLinesByAddress(t);e.every((i=>{if(1==e.length||i.sourceView.sourceDoc.isLoaded(t)){let t=!0;return this.activateView(i.sourceView,t),!1}return!0}))}activateView(t,e){if(this.activeSourceView&&this.activeSourceView.clearPC(),t!=this.activeSourceView&&(this.activeSourceView&&(this.activeSourceView.setVisible(!1),this.activeSourceView.projectFile.deactivate()),this.activeSourceView=t,this.activeSourceView.setVisible(!0)),!o.dbug.isRunning){let t=o.machine.getPC();this.coverage&&(this.coverage.lastPC=t,this.processCoverage()),this.activeSourceView.updatePC(t,e)}this.activeSourceView.projectFile.activate(),this.activeSourceView.focus()}chooseStepOverPC(){return this.activatePCView(),this.activeSourceView.chooseStepOverPC(o.machine.getPC())}processCoverage(){var t;let e=null===(t=this.activeSourceView)||void 0===t?void 0:t.sourceDoc.disassembler;e&&e.processCoverage(this.coverage)}}},6458:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegisterView=e.asHex=e.IntEdit=void 0;const s=i(9273);class o extends HTMLElement{constructor(){super(),this.index=-1,s.dbug.isRunning||this.addEventListener("mousedown",(t=>{let e=this.textContent.toUpperCase();this.textContent==e&&(e=this.textContent.toLowerCase()),this.textContent=e,t.stopPropagation(),t.preventDefault(),this.valueChanged&&this.valueChanged(this.index)}))}}class n extends HTMLElement{constructor(){super(),this.base=16,this.bytes=1,s.dbug.isRunning||(this.addEventListener("focus",(t=>{this.oldValue="",this.newValue="",this.dollarSign=this.textContent.startsWith("$")?"$":""})),this.addEventListener("blur",(t=>{""!=this.oldValue&&(this.textContent=this.oldValue)})),this.addEventListener("keydown",(t=>{if("Enter"==t.key){if(""!=this.newValue)return void this.completeValue();this.blur()}else"Escape"==t.key?this.blur():1!=t.key.length&&"Backspace"!=t.key||this.handleKey(t)})))}handleKey(t){let e,i=t.key;if("Backspace"==i)""==this.oldValue&&(this.oldValue=this.textContent,10==this.base?this.newValue=this.oldValue:this.newValue=this.oldValue.slice(1)),this.newValue=this.newValue.slice(0,this.newValue.length-1),t.stopPropagation();else{if(2==this.base){if(!i.match(/[0-1]+/))return}else if(10==this.base){if(!i.match(/[0-9]+/))return}else if(i=i.toUpperCase(),!i.match(/[0-9A-F]+/))return;""==this.oldValue&&(this.oldValue=this.textContent),this.newValue+=i}2==this.base?(e=8*this.bytes,this.textContent="%"+this.newValue.padEnd(e+this.bytes," ")):10==this.base?(e=1==this.bytes?3:5,this.textContent="#"+this.newValue.padEnd(e," ")):(e=2*this.bytes,this.textContent=this.dollarSign+this.newValue.padEnd(e," ")),this.newValue.length>=e&&this.completeValue()}completeValue(){let t=parseInt(this.newValue,this.base);if(t>(1<<8*this.bytes)-1)return this.textContent=this.oldValue,void this.blur();let e=t.toString(this.base).toUpperCase();if(2==this.base){let e=t.toString(this.base).padStart(8*this.bytes,"0");this.textContent="%"+e.slice(0,4);for(let t=4;t<8*this.bytes;t+=4)this.textContent+="."+e.slice(t,t+4)}else if(10==this.base){let t=1==this.bytes?3:5;this.textContent="#"+e.padEnd(t," ")}else this.textContent=this.dollarSign+e.padStart(2*this.bytes,"0");this.oldValue="",this.blur(),this.valueChanged&&this.valueChanged(t)}}function r(t,e){return null==e&&(e=t<256?2:4),t.toString(16).padStart(e,"0").toUpperCase()}e.IntEdit=n,customElements.define("int-edit",n),customElements.define("flag-edit",o),e.asHex=r,e.RegisterView=class{constructor(t){this.lastCycles=0,this.table=t,this.regBytes=new Array(3)}update(t){for(;this.table.rows.length>0;)this.table.deleteRow(this.table.rows.length-1);const e=["A","X","Y","PC","SP","PS"];let i=[s.machine.getA(),s.machine.getX(),s.machine.getY(),s.machine.getPC(),256+s.machine.getSP(),s.machine.getStatusBits()],o=s.machine.getCycleCount(),n=this.lastCycles>0?o-this.lastCycles:0;this.lastCycles=o;for(let o=0;o<3;o+=1){let a=this.table.insertRow();for(let h=0;h<8;h+=1){let l="";if(0==h)l=e[o];else if(1==h)l=r(i[o]);else if(2==h)l="#"+i[o].toString(),l=l.padEnd(4," ");else if(3==h)l=i[o].toString(2).padStart(8,"0"),l="%"+l.slice(0,4)+"."+l.slice(4);else if(4==h)l=" "+e[o+3];else if(5==h)2!=o&&(l=r(i[o+3]));else if(6==h)l=0==o?"ΔClock":1==o?"ΔTime":"";else if(7==h)if(0==o)l="#"+n.toString();else if(1==o){let t=(1e3*n/1022727).toString(),e=t.indexOf(".");e>=0&&t.length>e+3&&(t=t.substring(0,e+3)),l="#"+t+" ms"}else l="";let c=a.insertCell();if(5==h&&2==o){let e=this.buildFlags(t);c.appendChild(e)}else if(h>=1&&h<=3){let e=document.createElement("int-edit");2==h?e.base=10:3==h&&(e.base=2),e.textContent=l,e.classList.add("int-edit"),t||(e.tabIndex=-1,e.classList.add("int-edit-stopped")),e.valueChanged=0==o?t=>{s.machine.setA(t),s.dbug.refreshViews()}:1==o?t=>{s.machine.setX(t),s.dbug.refreshViews()}:t=>{s.machine.setY(t),s.dbug.refreshViews()},c.appendChild(e)}else{let t=document.createTextNode(l);0!=h&&4!=h&&6!=h||(c.className="reg-label"),c.appendChild(t)}4!=h&&6!=h||(c.style.paddingRight="6px")}}}buildFlags(t){const e=["C","Z","I","D","B","E","V","N"];let i=document.createElement("table");i.style.borderSpacing="0px";let o=s.machine.getStatusBits(),n=i.insertRow();for(let i=7;i>=0;i-=1){let r=n.insertCell();r.style.padding="0px";let a=document.createElement("flag-edit");a.index=i;let h=e[i];o&1<<i||(h=h.toLowerCase()),a.textContent=h,a.classList.add("flag-edit"),t||(a.tabIndex=-1,a.classList.add("flag-edit-stopped")),a.valueChanged=e=>{let i=s.machine.getStatusBits();i^=1<<e,s.machine.setStatusBits(i),this.update(t)},r.appendChild(a)}return i}}},8887:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SourceDocBuilder=e.SourceDoc=e.SourceLine=e.SourceLineTemplate=void 0;const s=i(9273),o=i(773);e.SourceLineTemplate=class{constructor(t){this.address=t.address,this.objData=[];for(let e=0;e<t.objLength;e+=1)this.objData.push(t.objBuffer[t.objOffset+e]);this.label=t.label,this.opcode=t.opcode,this.args=t.args,this.prevLabel=t.prevLabel,this.prevLineOffset=t.prevLineOffset}};const n=["ds","dfb","db","dw","hex"];class r{constructor(t){this.address=-1,this.objOffset=0,this.objLength=0,this.label="",this.opcode="",this.args="",this.comment="",t&&(this.address=t.address,this.objBuffer=Uint8Array.from(t.objData),this.objLength=t.objData.length,this.objOffset=0,this.label=t.label,this.opcode=t.opcode,this.args=t.args,this.prevLabel=t.prevLabel,this.prevLineOffset=t.prevLineOffset)}isStorageOp(){return function(t){let e=t.toLowerCase();return n.indexOf(e)>-1||e.startsWith("dc.")||"."==e[0]}(this.opcode)}splitBeforeAddress(t){if(-1==this.address||this.address+this.objLength<=t)return void console.log("Bad splitBeforeAddress");let e=new r;return e.address=t,e.objBuffer=this.objBuffer,e.objOffset=this.objOffset+(t-this.address),e.objLength=this.address+this.objLength-t,e.opcode=".bulk",e.args="...",this.objLength-=e.objLength,e}splitBeforeOffset(t){if(-1==this.address||this.objOffset+this.objLength<=t)return void console.log("Bad splitBeforeOffset");let e=new r;return e.address=this.address+t-this.objOffset,e.objBuffer=this.objBuffer,e.objOffset=t,e.objLength=this.objOffset+this.objLength-t,e.opcode=".bulk",e.args="...",this.objLength-=e.objLength,e}}e.SourceLine=r;class a{constructor(){this.name="",this.lstFileName="",this.sourceLines=[],this.tabStops=[16,20,36]}isLoaded(t){let e=!1,i=this.findLinesByAddress(t);return i.length>0&&i.forEach((t=>{let i=this.sourceLines[t],o=Math.min(i.objLength,16),n=0;for(let t=0;t<o;t+=1)s.machine.readConst(i.address+t)==i.objBuffer[i.objOffset+t]&&(n+=1);n/o>=.9&&(e=!0)})),e}findLinesByAddress(t){let e=[];for(let i=0;i<this.sourceLines.length;i+=1){let s=this.sourceLines[i];t>=s.address&&t<s.address+s.objLength&&e.push(i)}return e}findLineByAddress(t){let e=this.findLinesByAddress(t),i=-1;if(e.length>0)if(e.length>1){let t=-1;e.forEach((e=>{let o=this.sourceLines[e],n=0;for(let t=0;t<o.objLength;t+=1)s.machine.readConst(o.address+t)==o.objBuffer[o.objOffset+t]&&(n+=1);n/=o.objLength,t<n&&(t=n,i=e)}))}else i=e[0];return i}findLineByLabel(t){for(let e=0;e<this.sourceLines.length;e+=1)if(this.sourceLines[e].label==t)return e;return-1}getText(){return this.text||(this.text="",this.sourceLines.forEach((t=>{this.text+=this.buildTextLine(t)}))),this.text}buildTextLine(t,e){let i="";if(0!=t.label.length||0!=t.opcode.length||0!=t.args.length){e&&e.push(i.length),0!=t.label.length&&(i+=t.label),e&&e.push(i.length);let s=this.tabStops[0];if(0!=t.opcode.length){let o=t.opcode.toLowerCase();"if"!=o&&"do"!=o&&"else"!=o&&"fin"!=o||(s-=4),i=i.padEnd(s-1)+" ",e&&e.push(i.length),i+=t.opcode}else e&&e.push(i.length);e&&e.push(i.length),0!=t.args.length?(i=i.padEnd(this.tabStops[1]-1)+" ",e&&e.push(i.length),i+=t.args):e&&e.push(i.length),e&&e.push(i.length),e&&e.push(i.length),0!=t.comment.length?(i=i.padEnd(this.tabStops[2]-1)+" ",e&&e.push(i.length),i+=t.comment):e&&e.push(i.length),e&&e.push(i.length)}else e&&(e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0)),0!=t.comment.length?(t.commentColumn&&(i=i.padEnd(t.commentColumn)),e&&e.push(i.length),i+=t.comment):e&&e.push(i.length),e&&e.push(i.length);return i+"\n"}}e.SourceDoc=a,e.SourceDocBuilder=class{buildLstDocs(t,e,i){return this.startBuild(t),this.lstFileName=e,t&&t.json.tabStops&&(this.tabStops=t.json.tabStops),0==i[0].indexOf("------- FILE ")?new l(this).parse(i):new h(this).parse(i),this.sourceDocs.forEach((t=>{t.objBuffer=Uint8Array.from(t.objData),delete t.objData,t.sourceLines.forEach(((e,i)=>{delete e.fileLine,e.objBuffer=t.objBuffer,delete e.objData}))})),this.sourceDocs}buildDis65Docs(t,e,i){var s;this.startBuild(t),this.changeFile(null!==(s=this.project.name)&&void 0!==s?s:"disassembly"),this.currentDoc.objBuffer=i;let n=new o.Disassembler(!1);return this.currentDoc.disassembler=n,n.load(this.currentDoc,e),this.sourceDocs}buildRawDoc(t){return this.startBuild(null),new h(this).parse(t),this.sourceDocs[0]}startBuild(t){this.project=t,this.sourceDocs=[],this.currentDoc=null,this.lstFileName="",t&&t.json.tabStops?this.tabStops=t.json.tabStops:this.tabStops=null}changeFile(t){let e=t.toUpperCase();e.lastIndexOf(".S")!=e.length-2&&(t+=e==t?".S":".s"),""!=this.lstFileName&&(t.startsWith("/")||(t="/"+t),t=this.lstFileName+t);let i=this.currentDoc;if(!this.currentDoc||this.currentDoc.name!=t){let e=!1;this.sourceDocs.every((s=>s.name!=t||(i=this.currentDoc,this.currentDoc=s,e=!0,!1))),e||(i=this.currentDoc,this.currentDoc=new a,this.currentDoc.name=t,this.currentDoc.lstFileName=this.lstFileName,this.currentDoc.objData=[],this.tabStops&&(this.currentDoc.tabStops=this.tabStops),this.sourceDocs.push(this.currentDoc))}return i}};class h{constructor(t){this.isRawText=!1,this.builder=t}parse(t){this.isRawText=0!=t[0].indexOf("===== FILE "),this.isRawText&&this.builder.changeFile("unknown.s"),this.prevLine=0,t.forEach(((e,i)=>{if(i<t.length-1||""!=e)if(0==e.indexOf("===== FILE ")){let t=e.substring(11),i=t.indexOf(" ");i>0&&(t=t.substring(0,i)),this.builder.changeFile(t);let s=this.builder.currentDoc.sourceLines.length;this.prevLine=s>0?this.builder.currentDoc.sourceLines[s-1].fileLine:0}else this.parseLine(e)}))}parseLine(t){let e="";for(let i=this.isRawText?0:23;i<t.length;++i)if("\t"==t[i]){let t=4-(3&e.length);e=e.padEnd(e.length+t)}else e+=t[i];let i=new r;if(i.objData=this.builder.currentDoc.objData,i.objLength=0,i.objOffset=i.objData.length,!this.isRawText){let e=t.substring(0,6).trim();if(i.fileLine=parseInt(e),i.fileLine!=this.prevLine+1){if(!this.macroLine){let t=this.builder.currentDoc.sourceLines.length;this.macroLine=this.builder.currentDoc.sourceLines[t-1]}}else this.macroLine&&(this.macroLine=void 0);let s=t.substring(6,23).trim();if(""!=s){let t=s.indexOf(":");-1!=t&&(i.address=parseInt(s.substring(0,t),16),s=s.substring(t+1).trim());for(let t=0;t<3;++t){let t=s.substring(0,2),e=parseInt(t,16);if(this.macroLine?(this.macroLine.objData.push(e),this.macroLine.objLength+=1,-1==this.macroLine.address&&(this.macroLine.address=i.address)):(i.objData.push(e),i.objLength+=1),s.length<=2)break;s=s.substring(3)}}}if("*"==e[0]||";"==e[0])i.comment=e;else{let t=e.length;for(let i=0;i<e.length;++i)if(" "==e[i]||";"==e[i]){t=i;break}let s=e.indexOf(" ;");if(-1!=s&&(s+=1),0!=t&&(i.label=e.substring(0,t),e=e.substring(t)),e=e.trim(),""!=e&&";"!=e[0]){let t=e.length;for(let i=0;i<e.length;++i)if(" "==e[i]||";"==e[i]){t=i;break}0!=t&&(i.opcode=e.substring(0,t),e=e.substring(t)),e=e.trim()}if(""!=e&&";"!=e[0]){let t=e.length;for(let i=0;i<e.length;++i)if(" "==e[i]&&i+1<e.length&&";"==e[i+1]){t=i;break}0!=t&&(i.args=e.substring(0,t).trim(),e=e.substring(t)),e=e.trim()}""!=e&&";"==e[0]&&(i.comment=e,-1!=s&&(i.commentColumn=s),e="")}this.macroLine||(this.prevLine=i.fileLine,this.builder.currentDoc.sourceLines.push(i))}}class l{constructor(t){this.builder=t}parse(t){this.lastAddress=-1,this.nextAddress=-1,this.previousDoc=void 0,this.nextMacroLine=-1,t.forEach(((e,i)=>{if(i<t.length-1||""!=e)if(0==e.indexOf("------- FILE ")){let t=e.substring(13),i=t.indexOf(" ");i>0&&(t=t.substring(0,i)),this.previousDoc=this.builder.changeFile(t)}else this.parseLine(e)}))}parseLine(t){let e="",i=!1;for(let s=0;s<t.length;++s)if("\t"==t[s]){let o=8-(7&e.length);if(s+1<e.length&&";"==t[s+1])continue;i&&(o=8-(e.length+1&7)),e=e.padEnd(e.length+o)}else";"==t[s]&&(i=!0),e+=t[s];let s=new r;s.objData=this.builder.currentDoc.objData,s.objLength=0,s.objOffset=s.objData.length;let o=e.substring(0,7);e=e.substring(8),s.fileLine=parseInt(o);let n=e.substring(1,5);if(e=e.substring(5),s.address=parseInt(n,16),this.nextAddress=s.address,""!=e){let t=e.substring(1,5).trim();e=e.substring(5),"????"==t?s.address=-1:""!=t&&console.log("format error 1")}if(""!=e){e.length<13&&console.log("format error 2");let t=e.substring(0,13);e=e.substring(13),""!=t.trim()&&console.log("format error 3")}if(""!=e){e.length<12&&console.log("format error 4");let t=e.substring(0,12).trim();if(e=e.substring(12),""!=t&&"-"!=t&&-1!=s.address)for(let e=0;e<4;++e){let e=t.substring(0,2),i=parseInt(e,16);if(s.objData.push(i),s.objLength+=1,t.length<=2||"*"==t[2])break;t=t.substring(3)}}if(""!=e&&" "!=e[0]&&";"!=e[0]){let t=e.length;for(let i=0;i<e.length;++i)if(" "==e[i]||";"==e[i]){t=i;break}0!=t&&(s.label=e.substring(0,t),e=e.substring(t))}if(e=e.trim(),""!=e&&";"!=e[0]){let t=e.length;for(let i=0;i<e.length;++i)if(" "==e[i]||";"==e[i]){t=i;break}0!=t&&(s.opcode=e.substring(0,t),e=e.substring(t)),e=e.trim()}if(""!=e&&";"!=e[0]){let t=e.length;for(let i=0;i<e.length;++i)if(";"==e[i]){t=i;break}0!=t&&(s.args=e.substring(0,t).trim(),e=e.substring(t)),e=e.trim()}if(""!=e&&";"==e[0]&&(s.comment=e,e=""),"align"===s.opcode.toLowerCase()&&(s.address=this.lastAddress),"equ"!==s.opcode.toLowerCase()&&"="!==s.opcode||(s.objOffset=0,s.objLength=0),this.lastAddress=this.nextAddress,-1!=this.nextMacroLine){if(s.fileLine==this.nextMacroLine)return void(this.nextMacroLine+=1);this.nextMacroLine=-1}if(0==s.fileLine){if("include"==s.opcode){let t=this.previousDoc.sourceLines[this.previousDoc.sourceLines.length-1];return s.fileLine=t.fileLine+1,void this.previousDoc.sourceLines.push(s)}{let t=this.builder.currentDoc,e=t.sourceLines[t.sourceLines.length-1];s.fileLine=e.fileLine+1,this.nextMacroLine=1}}this.builder.currentDoc.sourceLines.push(s)}}},6358:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SourceView=void 0;const s=i(9273),o=i(2174),n=i(6458),r=i(4631),a=i(5088);e.SourceView=class{constructor(t,e,i){this.savedBreakpointLines=[],this.currentPCLine=-1,this.project=t,this.projectFile=e,this.codeDiv=document.createElement("div"),this.codeDiv.className="code-div",i.appendChild(this.codeDiv),this.codeDiv.addEventListener("mouseenter",(t=>{this.onCodeMouseEnter(t)})),this.codeDiv.addEventListener("mousemove",(t=>{this.onCodeMouseMove(t)})),this.codeDiv.addEventListener("mouseleave",(t=>{this.onCodeMouseLeave(t)})),this.codeDiv.addEventListener("wheel",(t=>{this.onCodeMouseLeave(t)})),this.hoverDiv=document.createElement("div"),this.hoverDiv.className="hover-div",this.codeDiv.appendChild(this.hoverDiv),this.hoverDiv.addEventListener("mouseleave",(t=>{this.onCodeMouseLeave(t)})),this.hoverDiv.addEventListener("mousedown",(t=>{this.onToolTipMouseClick(t)})),this.hoverTip=(0,a.default)(this.hoverDiv,{trigger:"manual",placement:"right",offset:[0,8],duration:[100,100]}),this.textArea=document.createElement("textarea"),this.textArea.className="code-area",this.codeDiv.appendChild(this.textArea),this.setVisible(!1)}getLineFromSelection(){let t=this.editor.getCursor("from");return t.line<this.sourceDoc.sourceLines.length?t.line:-1}setVisible(t){this.codeDiv.style.display=t?"block":"none",t&&!this.editor&&(this.initEditor(),this.savedBreakpointLines.forEach((t=>{this.updateBreakpoint(t)})),this.savedBreakpointLines=[])}focus(){this.editor&&this.editor.focus()}initEditor(){this.editor=(0,r.fromTextArea)(this.textArea,{mode:"6502",theme:"dbug",readOnly:!0,extraKeys:{F9:function(){s.dbug.onSetBreakpoint()},"Shift-F9":function(){s.dbug.onAddWatch()},"Ctrl-F10":function(){s.dbug.onRunToCursor()},"Shift-Ctrl-F10":function(){s.dbug.onSetNextStatement()},"Shift-Ctrl-8":function(){s.dbug.onScrollToPc()}},gutters:["gutter-line","gutter-bytes","gutter-marker"]}),document.addEventListener("keydown",(t=>{this.dispatchFunctionKeys(t)})),this.editor.on("keydown",((t,e)=>{this.dispatchFunctionKeys(e)})),this.editor.on("gutterClick",((t,e,i)=>{"gutter-marker"!==i&&"gutter-bytes"!==i||this.toggleUserBreakpoint(e)})),this.editor.on("mousedown",((t,e)=>{this.onMouseDown(e)})),this.editor.setValue(this.sourceDoc.getText()),this.sourceDoc.sourceLines.forEach(((t,e)=>{if(this.addLineNumber(e),-1!=t.address&&(t.objLength||t.label.length)){let i=" "+(0,n.asHex)(t.address,4)+":";if(t.objLength>0){for(let e=0;e<t.objLength;e+=1)e<3?i+=" "+(0,n.asHex)(t.objBuffer[t.objOffset+e]):3==e&&(i+="+");let s=document.createTextNode(i);this.editor.setGutterMarker(e,"gutter-bytes",s);let o=t.opcode.toLowerCase();if("jsr"===o||"jmp"===o){let i=this.editor.getDoc().getLine(e).indexOf(t.args);if(-1!==i){let s={line:e,ch:i},o={line:e,ch:i+t.args.length},n={className:"mark-error"};this.editor.markText(s,o,n)}}}}}))}dispatchFunctionKeys(t){let e=!1;t.metaKey&&("d"==t.key?(this.selectWord(),e=!0):"g"==t.key?(this.findWord(!t.shiftKey),e=!0):"f"==t.key&&(this.project.onFind(),e=!0)),"F5"==t.key?t.shiftKey?t.ctrlKey&&(s.dbug.onResetCpu(),e=!0):t.ctrlKey||(s.dbug.onStartCpu(),t.preventDefault()):"F6"==t.key?t.shiftKey||t.ctrlKey||(s.dbug.onStopCpu(),e=!0):"F10"==t.key?t.shiftKey||t.ctrlKey||(s.dbug.onStepCpuOver(),e=!0):"F11"==t.key&&(t.ctrlKey||(t.shiftKey?s.dbug.onStepCpuOutOf():s.dbug.onStepCpuInto(),e=!0)),e&&(t.preventDefault(),t.stopPropagation())}onCodeMouseEnter(t){this.hoverTimer=setTimeout(function(){this.onCodeMouseHover()}.bind(this),100)}onCodeMouseMove(t){"block"!=this.hoverDiv.style.display&&(this.hoverX=t.pageX,this.hoverY=t.pageY,this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(function(){this.onCodeMouseHover()}.bind(this),100))}onCodeMouseHover(){if(clearTimeout(this.hoverTimer),this.hoverTimer=void 0,this.toolTipInfo=this.buildToolTip(this.hoverX,this.hoverY),this.toolTipInfo){this.hoverDiv.style.display="block",this.hoverDiv.style.left=this.toolTipInfo.bounds.left+"px",this.hoverDiv.style.top=this.toolTipInfo.bounds.top+"px",this.hoverDiv.style.width=this.toolTipInfo.bounds.right-this.toolTipInfo.bounds.left+"px",this.hoverDiv.style.height=this.toolTipInfo.bounds.bottom-this.toolTipInfo.bounds.top+"px";let t=document.createElement("div");t.className="tooltip-content";let e=document.createElement("a");e.innerHTML=this.toolTipInfo.content,t.appendChild(e),this.hoverTip.setContent(t),this.hoverTip.show()}}onCodeMouseLeave(t){this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.hoverDiv.style.display="none",this.hoverTip.hide(),this.toolTipInfo=void 0}onToolTipMouseClick(t){if(this.toolTipInfo){let e=this.getJumpScrollTargetAddress(this.toolTipInfo.sourceLine),i=this.toolTipInfo.sourceLine.args;if(e<0){let e=this.editor.coordsChar({left:t.pageX,top:t.pageY});e&&this.editor.setSelection({line:e.line,ch:e.ch},{line:e.line,ch:e.ch},{scroll:!1})}this.onCodeMouseLeave(t),e>=0?this.project.scrollToFunctionAddress(e,i,this):setTimeout((()=>{this.editor.focus()}),0)}}onMouseDown(t){let e=this.hitSourceLine(t.pageX,t.pageY);if(e){let i=this.getJumpScrollTargetAddress(e.sourceLine);i>0&&(t.preventDefault(),this.project.scrollToFunctionAddress(i,e.sourceLine.args,this))}}getJumpScrollTargetAddress(t){if(t.objLength>0){let e=o.Isa6502.computeAddress(s.machine,t);if("jab"==e.type||"jsr"==e.type)return e.address}return-1}scrollToFunctionLine(t,e){let i=this.sourceDoc.sourceLines[e];if(0==i.label.length){let s=i.address,o=e;for(;o>0;){let i=this.sourceDoc.sourceLines[o-1];if(i.address!=s)break;if(0!=i.objLength)break;if(o-=1,0!=i.label.length&&(e=o,i.label==t))break}}this.scrollToLine(e,!0)}setDocument(t){this.sourceDoc=t}scanForComments(t){let e=this.sourceDoc.sourceLines[t],i=t,s=t,o=!1;for(;i>0;){let t=this.sourceDoc.sourceLines[i-1];if(-1!=t.address&&t.address!=e.address)break;if(t.label.length){if(o)break;o=!0,i-=1,s=i}else{if(t.opcode.length||t.args.length)break;i-=1}}for(;i<s;){let t=this.sourceDoc.sourceLines[i];if(!(""===t.comment||";"===t.comment||t.comment.startsWith(";---")||t.comment.startsWith(";===")||t.comment.startsWith("*---")||t.comment.startsWith("***")))break;i+=1}for(;i<s;){let t=this.sourceDoc.sourceLines[s-1];if(!(""===t.comment||";"===t.comment||t.comment.startsWith(";---")||t.comment.startsWith(";===")||t.comment.startsWith("*---")||t.comment.startsWith("***")))break;s-=1}let n="";for(;i<s;)n+=this.sourceDoc.sourceLines[i].comment+"<br>",i+=1;return n}hitSourceLine(t,e){let i=this.editor.coordsChar({left:t,top:e});if(i.line<this.sourceDoc.sourceLines.length){let t=this.sourceDoc.sourceLines[i.line];if(t.args.length>0){let e=0,s=this.sourceDoc.tabStops[0];if(t.label.length<s?e+=s:e+=t.label.length+1,e+=t.opcode.length,e<this.sourceDoc.tabStops[1]?e=this.sourceDoc.tabStops[1]:e+=1,i.ch>=e&&i.ch<e+t.args.length)return{sourceLine:t,line:i.line,ch:i.ch,argLeft:e}}}}buildToolTip(t,e){let i=this.hitSourceLine(t,e);if(i){if(0==i.sourceLine.objLength)return;let t=i.sourceLine.opcode.toLowerCase();if(i.sourceLine.isStorageOp()||"align"==t)return;let e="",r=!0,a=o.Isa6502.computeAddress(s.machine,i.sourceLine,r);if("jab"==a.type||"jsr"==a.type){let t=this.project.sourceViewLineFromAddress(a.address,this);if(t){let i=t.sourceView.scanForComments(t.lineNumber);i.length>0&&(e=function(t){let e="",i=t;for(;""!=i;){let t=i.indexOf("; ");if(-1==t){e+=i;break}e+=i.substring(0,t+1),i=i.substring(t+1);let s="";for(;i.length>0&&" "==i[0];)s+=" ",i=i.substring(1);""!=s&&(i=s+i)}return e}(i))}}if(""==e&&""!=a.type){let t=0;a.size>0&&(t=s.machine.readConst(a.address),e+=(0,n.asHex)(a.address,a.size)+":  "),e+=(0,n.asHex)(t),e+="   #"+t.toString(10).padEnd(4," ");let i=t.toString(2).padStart(8,"0");e+=" %"+i.slice(0,4)+"."+i.slice(4)}if(""==e)return;let h=this.editor.charCoords({line:i.line,ch:i.argLeft}),l=this.editor.charCoords({line:i.line,ch:i.argLeft+i.sourceLine.args.length-1});return h.right=l.right,{sourceLine:i.sourceLine,content:e,bounds:h}}}updateLine(t,e){let i=t,n=this.sourceDoc.sourceLines[i];if(-1!=n.address&&n.objLength){let r=n.opcode[0]>="A"&&n.opcode[0]<="Z",a=n.opcode.toLowerCase(),h=n.isStorageOp(),l=!1,c=!1;for(let t=0;t<n.objLength;t+=1)e[t]!=n.objBuffer[n.objOffset+t]&&(0!=t||h?c=!0:l=!0);let d=null!=n.savedOp,u=null!=n.savedArgs,p=n.savedArgBytes,f=!1,g=[];if(d&&!l&&(n.opcode=n.savedOp,f=!0),u&&!c&&(n.args=n.savedArgs,f=!0),l&&o.Isa6502.ops[e[0]].bc==e.length&&(f=!0,d||(n.savedOp=n.opcode,d=!0),n.opcode=o.Isa6502.ops[e[0]].op,r&&(n.opcode=n.opcode.toUpperCase())),c)if(f=!0,u||(n.savedArgs=n.args,u=!0),h)if("hex"==a){if(!p){p=[];for(let t=0;t<n.args.length;t+=2){let e=n.args.slice(t,t+2),i=parseInt(e,16);p.push(i)}n.savedArgBytes=p}n.args="";for(let t=0;t<p.length;t+=1){let e=s.machine.readConst(n.address+t);e!=p[t]&&(g.push(2*t),g.push(2*t+2));let i=e.toString(16).padStart(2,"0");r&&(i=i.toUpperCase()),n.args+=i}}else{let t="db"==a||"dfb"==a||"dc.b"==a?0:1,i=n.savedArgs.split(",");n.args="";for(let s=0;s<i.length;s+=1){let o=i[s];if(s>0&&(n.args+=","),s<3){let i,a;if(t){let t=n.objOffset+2*s;a=n.objBuffer[t+0]+(n.objBuffer[t+1]<<8),i=2*s+1<e.length?e[2*s+0]+(e[2*s+1]<<8):a}else a=n.objBuffer[n.objOffset+s],i=e[s];if(i!=a){let e=parseInt(o);"$"==o[0]||e!=e?(o="$"+i.toString(16).padStart(t?4:2,"0"),r&&(o=o.toUpperCase())):o=i.toString(10),g.push(n.args.length),g.push(n.args.length+o.length)}}n.args+=o}}else if(o.Isa6502.ops[e[0]].bc==e.length){let t=new Uint8Array(e);n.args=o.Isa6502.DisassembleArgs(t,0,n.address),r&&(n.args=n.args.toUpperCase())}if(f){let e=[],s=this.sourceDoc.buildTextLine(n,e);this.editor.setOption("readOnly",!1),this.editor.state.suppressEdits=!1,this.editor.replaceRange(s,{line:i,ch:0},{line:i+1,ch:0});let o={className:"self-modified"};if(l){let t=e[2],s=e[3];t!=s&&this.editor.markText({line:i,ch:t},{line:i,ch:s},o)}if(c)if(0!=g.length)for(let t=0;t<g.length;t+=2){let s=e[4]+g[t+0],n=e[4]+g[t+1];this.editor.markText({line:i,ch:s},{line:i,ch:n},o)}else{let t=e[4],s=e[5];t!=s&&this.editor.markText({line:i,ch:t},{line:i,ch:s},o)}this.addLineNumber(t),this.editor.setOption("readOnly",!0)}}}addLineNumber(t){let e=(t+1).toString().padStart(4," "),i=document.createTextNode(e),s=document.createElement("span");s.className="gutter-line",s.appendChild(i),this.editor.setGutterMarker(t,"gutter-line",s)}updateObjBytes(t){let e=this.sourceDoc.sourceLines[t];if(-1!=e.address&&(e.objLength||e.label.length)){let i=" "+(0,n.asHex)(e.address,4)+":";if(e.objLength>0){for(let t=0;t<e.objLength;t+=1)t<3?i+=" "+(0,n.asHex)(e.objBuffer[e.objOffset+t]):3==t&&(i+="+");let s=document.createTextNode(i);this.editor.setGutterMarker(t,"gutter-bytes",s);let o=e.opcode.toLowerCase();if("jsr"===o||"jmp"===o){let i=this.editor.getDoc().getLine(t).indexOf(e.args);if(-1!==i){let s={line:t,ch:i},o={line:t,ch:i+e.args.length},n={className:"mark-error"};this.editor.markText(s,o,n)}}}}}updateGutterBytes(){this.sourceDoc.sourceLines.forEach(((t,e)=>{if(-1!=t.address&&t.objLength){let i=[],o=!1;for(let e=0;e<t.objLength;e+=1)i.push(s.machine.readConst(t.address+e)),i[e]!=t.objBuffer[t.objOffset+e]&&(o=!0);const r=document.createElement("div");let a=document.createElement("span");r.appendChild(a);let h=" "+(0,n.asHex)(t.address,4)+":",l=null!=t.savedOp,c=null!=t.savedArgs;if(o||l||c){let s=document.createTextNode(h);a.appendChild(s),this.updateLine(e,i);for(let e=0;e<t.objLength&&e<=3;e+=1)a=document.createElement("span"),r.appendChild(a),e<3?(t.objBuffer[t.objOffset+e]!=i[e]&&(a.style.color="red"),h=" "+(0,n.asHex)(i[e])):3==e&&(h="+"),s=document.createTextNode(h),a.appendChild(s);t.hasBreakpoint&&(e==this.currentPCLine?(this.clearPcLineMark(),this.updateBreakpoint(e),this.setPcLineMark(e)):this.updateBreakpoint(e))}else{for(let e=0;e<t.objLength;e+=1)if(e<3)h+=" "+(0,n.asHex)(t.objBuffer[t.objOffset+e]);else if(3==e){h+="+";break}let e=document.createTextNode(h);a.appendChild(e)}this.editor.setGutterMarker(e,"gutter-bytes",r)}}))}setGutterMarker(t,e,i){let s=document.createTextNode("");s.textContent=e;let o=document.createElement("span");o.style.color=i,o.appendChild(s),this.editor.setGutterMarker(t,"gutter-marker",o)}updateBreakpoint(t){this.sourceDoc.sourceLines[t].hasBreakpoint?this.setGutterMarker(t,"●","red"):this.setGutterMarker(t,"","black")}toggleUserBreakpoint(t){let e=this.sourceDoc.sourceLines[t];if(0!=e.objLength&&-1!=e.address){if(e.hasBreakpoint=!e.hasBreakpoint,e.hasBreakpoint){for(let i=t;i>=0;i-=1){let s=this.sourceDoc.sourceLines[i];if(s.label&&""!=s.label&&!s.label.startsWith(":")&&!s.label.startsWith(".")){e.prevLabel=s.label,e.prevLineOffset=i-t;break}}this.project.breakpoints.setBreakpoint("user",this.sourceDoc,e)}else this.project.breakpoints.clearBreakpoint(this.sourceDoc,e);this.editor?t==this.currentPCLine?(this.clearPcLineMark(),this.updateBreakpoint(t),this.setPcLineMark(t)):this.updateBreakpoint(t):this.savedBreakpointLines.push(t)}}loadBreakpoint(t){let e=this.sourceDoc.findLineByAddress(t.address);if(-1!=e){let i=this.sourceDoc.sourceLines[e];if(i.label==t.label&&((""==i.label||i.label.startsWith(":")||i.label.startsWith("."))&&(i.opcode==t.opcode&&i.args==t.args||(e=-1)),-1!=e))return void this.toggleUserBreakpoint(e)}if(null!=t.prevLabel){let e=this.sourceDoc.findLineByLabel(t.prevLabel);if(-1!=e){let i=e-t.prevLineOffset,s=this.sourceDoc.sourceLines[i];if(s.label==t.label&&s.opcode==t.opcode&&s.args==t.args)return void this.toggleUserBreakpoint(i)}}console.log("breakpoint not found")}pushScrollPosition(){let t=this.editor.getScrollInfo();this.project.pushScrollPosition(this,t.left,t.top)}setScrollPosition(t,e){this.editor.scrollTo(t,e)}scrollToLine(t,e){let i=this.editor.getWrapperElement().getBoundingClientRect(),s=this.editor.lineAtHeight(i.top,"window"),o=this.editor.lineAtHeight(i.bottom,"window");if(s+=2,o>2&&(o-=2),t<s||t>o){let e=this.editor.charCoords({line:t,ch:0},"local").top,i=this.editor.getScrollerElement().offsetHeight/2;this.editor.scrollTo(null,e-i)}e&&this.editor.setSelection({line:t,ch:0},{line:t+1,ch:0},{scroll:!1})}clearPcLineMark(){-1!=this.currentPCLine&&(this.sourceDoc.sourceLines[this.currentPCLine].hasBreakpoint?this.updateBreakpoint(this.currentPCLine):this.setGutterMarker(this.currentPCLine,"","black"),this.currentPCLine=-1)}setPcLineMark(t){let e;this.clearPcLineMark(),e=this.sourceDoc.sourceLines[t].hasBreakpoint?"red":"yellow",this.setGutterMarker(t,"▶",e),this.editor.setSelection({line:t,ch:0},{line:t+1,ch:0},{scroll:!1}),this.currentPCLine=t}updatePC(t,e){let i=this.sourceDoc.findLineByAddress(t);if(-1!=i)this.updateGutterBytes(),this.setPcLineMark(i),e&&this.scrollToLine(i,!0);else{let t=-1;for(let e=0;e<this.sourceDoc.sourceLines.length;e+=1){let i=this.sourceDoc.sourceLines[e];if(-1!=i.address){t=i.address;break}}t>-1&&this.sourceDoc.isLoaded(t)&&this.updateGutterBytes()}}clearPC(){this.clearPcLineMark()}chooseStepOverPC(t){let e=this.sourceDoc.findLineByAddress(t);if(-1!=e){let i=this.sourceDoc.sourceLines[e];if("jsr"==i.opcode.toLowerCase()&&"DRAW_PICT"==i.args){for(;e+=1,e!=this.sourceDoc.sourceLines.length;)if(i=this.sourceDoc.sourceLines[e],"PictEnd"==i.opcode)return i.address+1;return t}}}selectWord(){let t=this.editor.getCursor("start"),e=this.editor.getLine(t.line).toUpperCase(),i=this.editor.getCursor("end");if(t.line==i.line&&t.ch!=i.ch)return this.project.setSearchWord(e.slice(t.ch,i.ch)),void this.findWord(!0);let s=t.ch;for(;s>0;){let t=e[s-1];if(!(t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"==t))break;s-=1}let o=t.ch;for(;o<e.length;){let t=e[o];if(!(t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"==t))break;o+=1}if(s!=o){this.project.setSearchWord(e.slice(s,o));let i={line:t.line,ch:s},n={line:t.line,ch:o};this.editor.setSelection(i,n),this.scrollToLine(t.line,!1)}}findWord(t){let e=this.project.getSearchWord().toUpperCase(),i=this.editor.getCursor(t?"end":"start"),s=i.line,o=i.ch,n=!1;for(;;){let r=this.editor.getLine(s).toUpperCase();0!=o&&(r=t?r.slice(o):r.slice(0,o));let a=t?r.indexOf(e):r.lastIndexOf(e);if(-1!=a){let t={line:s,ch:a},i={line:s,ch:a+e.length};return this.scrollToLine(s,!1),void this.editor.setSelection(t,i)}if(s==i.line&&n)break;o=0,s+=t?1:-1,s<0?(s=this.sourceDoc.sourceLines.length-1,n=!0):s!=this.sourceDoc.sourceLines.length||(s=0,n=!0)}}}},6419:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unpackNaja1=e.unpackNaja2=e.PixelData=void 0;class i{constructor(){this.bounds={x:0,y:0,width:0,height:0}}}e.PixelData=i,e.unpackNaja2=function(t,e){var s,o,n,r,a,h;let l=!1;null==e&&(e=0,l=!0);let c=t[e+0],d=t[e+1],u=t[e+2],p=null!==(s=t[e+3])&&void 0!==s?s:0;if(e+=4,u<1||u>40||c+u>40||p<1||p>192||d+p>192)return null;let f=new i;f.bounds.x=7*c,f.bounds.y=d,f.bounds.width=7*u,f.bounds.height=p,f.dataBytes=new Uint8Array(u*p);let g=0,b=0,m=u*p,y=0;for(;b!=m||(g+=1,b=g,m=g+u*p,g!=u);){let i=t[e];if(null==i)return null;if(e+=1,i<=127){f.dataBytes[b]=i|y,b+=u;continue}i&=127;let s=0==(1&i);if(i>>=1,s){if(0==i){y^=128;continue}for(;i>0;)f.dataBytes[b]=0,b+=u,i-=1;continue}if(s=0==(1&i),i>>=1,s){if(0==i){f.dataBytes[b]=null!==(o=t[e])&&void 0!==o?o:0,b+=u,e+=1;continue}let s=f.dataBytes[b-u];for(;i>0;)f.dataBytes[b]=s,b+=u,i-=1;continue}if(s=0==(1&i),i>>=1,s){if(0==i){let i=null!==(n=t[e])&&void 0!==n?n:0;for(e+=1;i>0;)f.dataBytes[b]=null!==(r=t[e])&&void 0!==r?r:0,b+=u,e+=1,i-=1;continue}let s=f.dataBytes[b-2*u],o=f.dataBytes[b-1*u];for(;i>0;)f.dataBytes[b]=s,b+=u,f.dataBytes[b]=o,b+=u,i-=1;continue}let l=i<<1,c=null!==(a=t[e])&&void 0!==a?a:0;l|=1&c,c>>=1;let d=null!==(h=t[e+=1])&&void 0!==h?h:0;e+=1;let p=d*u+c;for(;l>0;)f.dataBytes[b]=f.dataBytes[p],b+=u,p+=u,l-=1}return l&&e!=t.length?null:f},e.unpackNaja1=function(t,e){var s,o;let n=!1;null==e&&(e=0,n=!0);let r=t[e+0],a=t[e+1],h=null!==(s=t[e+2])&&void 0!==s?s:1,l=null!==(o=t[e+3])&&void 0!==o?o:0;if(e+=4,r>a||h>l||a>=192||l>=40)return null;let c=l-h+1,d=a-r+1,u=new i;u.bounds.x=7*h,u.bounds.y=r,u.bounds.width=7*c,u.bounds.height=d,u.dataBytes=new Uint8Array(c*d);let p=0,f=0;for(let i=c;--i>=0;)for(let s=d;--s>=0;){if(0==p){if(f=t[e++],null==f)return null;if(254==f){if(p=t[e++],f=t[e++],null==f)return null}else p=1}u.dataBytes[s*c+i]=f,p-=1}return n&&e!=t.length?null:u}},922:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WatchView=void 0;const s=i(9273),o=i(6458),n=i(8887),r=i(2174),a=i(5088);class h{constructor(t){this.sourceFile=t.sourceFile,this.sourceLine=new n.SourceLineTemplate(t.sourceLine),this.elementSize=t.elementSize,this.bytesVisible=t.bytesVisible,this.flags=t.flags}}class l{constructor(t){this.elementSize=0,this.bytesVisible=1,this.flags=0,t&&(this.sourceFile=t.sourceFile,this.sourceLine=new n.SourceLine(t.sourceLine),this.elementSize=t.elementSize,this.bytesVisible=t.bytesVisible,this.flags=t.flags),this.lastData=new Array(this.bytesVisible)}static createFromSourceDocLine(t){let e=new l;e.sourceFile=t.sourceDoc.name,e.sourceLine=t.sourceLine;let i=e.sourceLine.args.toLowerCase(),s=e.sourceLine.opcode.toLowerCase();return i.endsWith(",x")||i.endsWith(",y")||e.sourceLine.isStorageOp()?e.bytesVisible=16:e.bytesVisible=1,"dw"!=s&&"dc.w"!=s||(e.elementSize=1),e.lastData=new Array(e.bytesVisible),e}static createZpageEntry(){let t=new l;return t.sourceFile="none",t.sourceLine=new n.SourceLine,t.sourceLine.objBuffer=Uint8Array.from([165,0]),t.sourceLine.objLength=t.sourceLine.objBuffer.length,t.sourceLine.objOffset=0,t.sourceLine.args="zpage",t.elementSize=0,t.bytesVisible=256,t.flags=0,t.lastData=new Array(t.bytesVisible),t}}e.WatchView=class{constructor(t,e){this.project=t,this.table=e,this.entries=[]}loadWatches(){let t=localStorage.getItem(this.project.name+"/watch");null!=t&&JSON.parse(t).forEach((t=>{if(t.sourceFile){let e;"none"!=t.sourceFile&&(e=this.project.findSourceView(t.sourceFile)),this.addEntryFromTemplate(e,t)}})),0==this.entries.length&&this.addEntry(l.createZpageEntry()),this.saveWatches()}saveWatches(){let t=[];this.entries.forEach((e=>{t.push(new h(e))}));let e=JSON.stringify(t);localStorage.setItem(this.project.name+"/watch",e)}addEntryFromSourceViewLine(t){let e=t.sourceView.sourceDoc,i=e.sourceLines[t.lineNumber];if(i.args.startsWith("#"))return;let s=l.createFromSourceDocLine({sourceDoc:e,sourceLine:i});return this.addEntry(s),s}addEntryFromTemplate(t,e){if(t){let i=t.sourceDoc;for(let s=0;s<i.sourceLines.length;s+=1)if(i.sourceLines[s].args==e.sourceLine.args&&i.sourceLines[s].objLength){let i=this.addEntryFromSourceViewLine({sourceView:t,lineNumber:s});return i.bytesVisible=e.bytesVisible,i.elementSize=e.elementSize,void(i.flags=e.flags)}}try{let t=new l(e);this.addEntry(t)}catch(t){console.log("Failed to create WatchEntry")}}addEntry(t){if(!t.sourceLine.isStorageOp()){let e=r.Isa6502.computeAddress(s.machine,t.sourceLine);if("jab"==e.type||"jsr"==e.type)return}this.entries.push(t),this.table.parentElement.style.display="block",this.update(!1)}removeEntry(t){let e=this.entries.indexOf(t);e>-1&&this.entries.splice(e,1),0==this.entries.length&&(this.table.parentElement.style.display="none"),this.update(!1)}update(t){this.table.innerHTML="",this.entries.forEach((e=>{this.buildWatchEntryView(e,t)})),this.saveWatches()}buildWatchEntryView(t,e){let i=this.table.insertRow();i.tabIndex=-1,i.classList.add("watch-row"),i.draggable=!0,i.watchEntry=t,i.addEventListener("keydown",(e=>{"Backspace"==e.key&&this.removeEntry(t)})),i.addEventListener("dragstart",(t=>{this.dragRow=t.target})),i.addEventListener("dragover",(t=>{t.preventDefault();let e=t.target.parentNode;if(e.parentNode==this.dragRow.parentNode){let t=Array.from(e.parentNode.children);t.indexOf(e)>t.indexOf(this.dragRow)?e.after(this.dragRow):e.before(this.dragRow)}})),i.addEventListener("dragend",(t=>{this.entries=[],Array.from(this.dragRow.parentNode.children).forEach((t=>{this.entries.push(t.watchEntry)})),this.update(!1)}));let s=i.insertCell();s.style.verticalAlign="top",s.style.paddingTop="4px",s.appendChild(this.buildDropdown(e,t)),s=i.insertCell(),s.className="watch-expression",s.style.verticalAlign="top",s.style.paddingTop="4px";let o,r=t.sourceLine.args,a=r,h=null!=r.match(/^\$[0-9A-F]+(\,[X|Y])?$/);if(t.sourceLine.isStorageOp()&&(""!=t.sourceLine.label?(a=t.sourceLine.label,h=!1):(a="$"+t.sourceLine.address.toString(16).toUpperCase().padStart(4,"0"),h=!0)),h){let i=a.split(",");1==i.length?i.push(""):i[1]=","+i[1];let o=document.createElement("int-edit");o.bytes=2,o.textContent=a.slice(0,5),o.classList.add("int-edit"),o.classList.add("int-edit-addr"),e||(o.tabIndex=-1,o.classList.add("int-edit-stopped")),o.valueChanged=s=>{let o=t.sourceLine;t.sourceFile="none",t.sourceLine=new n.SourceLine,t.sourceLine.address=s,t.sourceLine.objBuffer=new Uint8Array(3),t.sourceLine.objBuffer[0]=o.objBuffer[o.objOffset+0],t.sourceLine.objBuffer[1]=255&s,t.sourceLine.objBuffer[2]=s>>8,t.sourceLine.objLength=3,t.sourceLine.objOffset=0,t.sourceLine.opcode=o.opcode,t.sourceLine.args="$"+s.toString(16).toUpperCase().padStart(4,"0")+i[1],this.update(e)},s.appendChild(o),""!=i[1]&&s.appendChild(document.createTextNode(i[1]))}else s.appendChild(document.createTextNode(a));s=i.insertCell(),s.style.verticalAlign="top",o=1==t.bytesVisible?this.buildHexSingle(t,e):this.buildHexTable(t,e),s.appendChild(o)}buildDropdown(t,e){let i=document.createElement("div");i.className="dropdown-content";let s=0==e.elementSize?"✓ ":"  ",o=document.createElement("a");o.innerHTML=s+"Bytes",o.onclick=()=>{e.elementSize=0,this.update(t)},i.appendChild(o),s=1==e.elementSize?"✓ ":"  ",o=document.createElement("a"),o.className="dropdown-group-end",o.innerHTML=s+"Words",o.onclick=()=>{e.elementSize=1,this.update(t)},i.appendChild(o),[1,16,32,64,128,256].forEach((n=>{s=n==e.bytesVisible?"✓ ":"  ",o=document.createElement("a"),o.innerHTML=s+n.toString(),o.onclick=()=>{e.bytesVisible=n,this.update(t)},i.appendChild(o)})),o.className="dropdown-group-end",o=document.createElement("a"),s=1&e.flags?"✓ ":"  ",o.innerHTML=s+"Text",o.onclick=()=>{e.flags^=1,this.update(t)},i.appendChild(o);let n=document.createElement("div");return n.className="codicon codicon-triangle-down dropdown-button",(0,a.default)(n,{content:i,trigger:"click",interactive:!0,placement:"bottom",arrow:!1,offset:[0,0],duration:[100,100]}),n}buildHexSingle(t,e){let i=document.createElement("table");i.className="watch-hex-table";let n=0;n=t.sourceLine.isStorageOp()?t.sourceLine.address:r.Isa6502.computeAddress(s.machine,t.sourceLine,!0).address;let a=i.insertRow(),h=!1,l=n,c=document.createElement("span");c.innerHTML=(0,o.asHex)(n)+":",l!=t.lastAddress&&(null!=t.lastAddress&&(h=!0),t.lastAddress=l),h&&(c.className="watch-span-changed"),a.insertCell().appendChild(c);let d=s.machine.readConst(l);t.elementSize>0&&(d+=s.machine.readConst(l+1&65535)<<8);for(let i=0;i<3;i+=1){let n,r=document.createElement("int-edit");if(r.bytes=t.elementSize+1,0==i)n=(0,o.asHex)(d,0==t.elementSize?2:4);else if(1==i){r.base=10;let e=0==t.elementSize?3:5;n="#"+d.toString(10).padEnd(e," ")}else 2==i&&(r.base=2,0==t.elementSize?(n=d.toString(2).padStart(8,"0"),n="%"+n.slice(0,4)+"."+n.slice(4)):(n=d.toString(2).padStart(16,"0"),n="%"+n.slice(0,4)+"."+n.slice(4,8)+"."+n.slice(8,12)+"."+n.slice(12)));r.textContent=n,r.classList.add("int-edit"),e||(r.tabIndex=-1,r.classList.add("int-edit-stopped")),d!=t.lastData[0]&&null!=t.lastData[0]&&r.classList.add("watch-span-changed"),r.valueChanged=t=>{s.machine.write(l,255&t),r.bytes>1&&s.machine.write(l+1&65535,t>>8),this.update(e)},a.insertCell().appendChild(r)}return t.lastData[0]=d,i}buildHexTable(t,e){let i=document.createElement("table");i.className="watch-hex-table";let n=0;n=t.sourceLine.isStorageOp()?t.sourceLine.address:r.Isa6502.computeAddress(s.machine,t.sourceLine,!1).address;let a=!1,h=0;for(;h<t.bytesVisible;){let l,c=i.insertRow();0==t.elementSize&&1&t.flags&&(l=i.insertRow());let d=n+h&65535,u=document.createElement("span");if(u.innerHTML=(0,o.asHex)(d)+":",0==h&&d!=t.lastAddress&&(null!=t.lastAddress&&(a=!0),t.lastAddress=d),a&&(u.className="watch-span-changed"),c.insertCell().appendChild(u),l){let t=document.createElement("span");t.innerHTML="     ",l.insertCell().appendChild(t)}let p=0,f=r.Isa6502.getRegIndex(s.machine,t.sourceLine);for(let i=0;i<16;i+=1){let n=i>>t.elementSize,r=s.machine.readConst(d+i);if(1==t.elementSize){if(0==(1&i)){p=r;continue}r=(r<<8)+p}let a,u=c.insertCell();l&&(a=l.insertCell());let g=document.createElement("int-edit");if(g.bytes=t.elementSize+1,u.appendChild(g),a){let t="0123456789_ABCDEFGHIJKLMNOPQRSTUVWXYZ!\"%'*+,-./:<=>?",e=(127&r)<t.length?t[127&r]:".";a.style.textAlign="center",a.appendChild(document.createTextNode(e))}n==7>>t.elementSize&&(u.style.marginRight="8px",a&&(a.style.marginRight="8px")),h+i==f&&(u.classList.add("watch-span-index"),a&&a.classList.add("watch-span-index")),r!=t.lastData[h+i]&&(null!=t.lastData[h+i]&&(u.classList.add("watch-span-changed"),a&&a.classList.add("watch-span-changed")),t.lastData[h+i]=r);let b=(0,o.asHex)(r,0==t.elementSize?2:4);g.textContent=b,g.classList.add("int-edit"),e||(g.tabIndex=-1,g.classList.add("int-edit-stopped")),0==t.elementSize?g.valueChanged=t=>{s.machine.write(d+i,t),this.update(e)}:g.valueChanged=t=>{s.machine.write(d+i,t>>8),s.machine.write(d+i-1,255&t),this.update(e)}}h+=16}return i}}},3274:(t,e,i)=>{"use strict";t.exports=i.p+"7c8f85be0caa9495aee7.png"},1024:(t,e,i)=>{"use strict";t.exports=i.p+"121806c487996d63c6db.png"},9037:(t,e,i)=>{"use strict";t.exports=i.p+"4afd59591d33d0903203.png"},7029:(t,e,i)=>{"use strict";t.exports=i.p+"0f3eefb0d38189aa336c.png"},6576:(t,e,i)=>{"use strict";t.exports=i.p+"bb3e16ff3136ebd3b92d.png"}},i={};function s(t){var o=i[t];if(void 0!==o)return o.exports;var n=i[t]={id:t,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.exports}s.m=e,t=[],s.O=(e,i,o,n)=>{if(!i){var r=1/0;for(c=0;c<t.length;c++){for(var[i,o,n]=t[c],a=!0,h=0;h<i.length;h++)(!1&n||r>=n)&&Object.keys(s.O).every((t=>s.O[t](i[h])))?i.splice(h--,1):(a=!1,n<r&&(r=n));if(a){t.splice(c--,1);var l=o();void 0!==l&&(e=l)}}return e}n=n||0;for(var c=t.length;c>0&&t[c-1][2]>n;c--)t[c]=t[c-1];t[c]=[i,o,n]},s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),(()=>{s.b=document.baseURI||self.location.href;var t={179:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var o,n,[r,a,h]=i,l=0;if(r.some((e=>0!==t[e]))){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(h)var c=h(s)}for(e&&e(i);l<r.length;l++)n=r[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(c)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),s.nc=void 0;var o=s.O(void 0,[598],(()=>s(9273)));o=s.O(o)})();